package internal_test

/*
import (
	"bytes"
	"context"
	"encoding/json"
	"fmt"
	"io"
	"net/http"
	"net/url"
	"testing"

	"github.com/stretchr/testify/assert"
	"github.com/theQRL/go-zond/common/hexutil"
	"github.com/theQRL/qrysm/v4/testing/require"
	"github.com/theQRL/qrysm/v4/validator/keymanager/remote-web3signer/internal"
)

// mockTransport is the mock Transport object
type mockTransport struct {
	mockResponse *http.Response
}

// RoundTrip is mocking my own implementation of the RoundTripper interface
func (m *mockTransport) RoundTrip(*http.Request) (*http.Response, error) {
	return m.mockResponse, nil
}

func TestNewApiClient(t *testing.T) {
	apiClient, err := internal.NewApiClient("http://localhost:8545")
	assert.NoError(t, err)
	assert.NotNil(t, apiClient)
}

func TestClient_Sign_HappyPath(t *testing.T) {
	jsonSig := `0xf1399420e2206403e0bbc9bc96c0b1274980e4f48d80f0939ff98f3ff96aeaf1bade6e3c21a6b1815065cb9ec29fd0909c0c4260f331fe9a5c09463ff9c601de53b6de46f27fe3ff6688a8b692619f98749a372fabb220c9922a675afc033f2ca6f58301e372b573846f795610a6e31ecf09fb2ee1f2a1422dc87d8dca6c3aa78b4edd1c7c20e0045a187cea3d0ee42dd4c96ffbe6432b2c951628255b8321e24ba9cd16e14f3d6c8a77ab4e19f9aff8df25cb47f8da55addce4f3f9cfa1f7e38ddaf50f8838d2a9e53bf089c465763e724f80b86344c088be4465dfd3ffe2518618dd2b04cf9879bd2a6750a8b1e77cb29a8267a536d3749f8c5905055d1a36e4bd563ddfdaab3c37deb28cd0554bc6eb369ef5a0aeae79dc0248c2af7d070a415d36ae63ac4a047720bdfff68e404a78138877dd9c96930de468290a5252ca01939ff0307f2c9d883c7b37fa7953d04f961cdcff8035ea82b2e1df9d5f1f92c08a18f30d04c18eb2a4d69cd184b2f27ad9f962404c1f033521fef1034dbc1c2cdcb594dfa55312fe1f781fcaedfaa74527ed8f52298b749a5d62ab32f7f10c02a488fc5fabdf191ed2ae233824564124d12e0517eb1233756a0ac13432d18ff7a498979a307550bc60f6f58455f33df26fea0cd4c42cf1422d208da148b523e6087ea61080cf980ccd9bdad6d65e6639fce58a89b1db1decfb8e88fc78cea4989769e1fa39e10f593e07bbc39db91b03f98d91d451a15fa506723b6fceeb434e4ce8ee40166e585b8b5e80f533353394675dae258590fc49af3f85a28827a7732c25a364fe6df4ae7f5dc597ebbadb0af4de13b1cecb14c9c77a0f39b40bbfd56314bee0e2f9fd9e7720fea008dc2c33276eb3282c6104b2516d1a8848d6ce1ff5957472efc2832582da6a88430eba8159c468466a74f2e66d93c0733a4321e987e9406dc5332d83dba8959ed6ef920a0395a1bb54a2fbd07248c956be4fbc739f8bf053112ee4b02aaddc3c418ceeecc96e3213a871594f0e9908c6d1d2a520dd760d5812e43967676edfcae2602c84d17268e7748c321c76b2d95e6e0b6e464ef9199ab239857480b1a7fe0b4faa3af178fc581164173062ac54467523bdd7f9cdda4e1c41e80868ec97c51ba737efdcae561cbf7643bd08d97abfb30bccb642619a345ddc98494df53479712ea5bcf39247c1baa9b31b934861074ca57e5d8eb27e7efffae29eb57bb5319981755de974ef99aca18fba29426d61a33fc2ca66f34c9555cf8c79d236a9fa6a9f97440f77aea283e6cc3934a5b2aef8826fb57ceb8f6b49ea601dd42d4897d5d3a32784e942b56b6acc165521d72d405c9bf1ad5e4ca166256045587cd0159544778e43df4e0191f4b55a512ef75ad16d6c1bcef204cb912ef856df6e353bbb7f0fd41e0fc4c088d19d1daab8a505d2022b3223e68d86a80528680b1429b63c233529ec9a836d82edea5a537c1e98f18909766eac9c2bfffc82ee57c0814bec1fb3cbf237627b86231fcd4aa5db2b8d43bd9abb6a49e6a726727c7393aa9f1222b8ae5d00d05d1f4a3a54b6590ba67960a4579d4560cdde22de2784934a37bc43b2b6fdc1424e2c0306997ad528d9e008bd278448eaf655f7b33dd456bdbb974d4ec5064333b8162fe5ff39dcc5af8f80780c33e854a6c8ecb174ee5d1f965bb4f0d8cc337d26a0150bf151b1c604db5b23e3dfdcb694939126d7f4840347d5a402316fe7a840d94d7a787badc3dc9c273238d3bffcb8cf8fc072f6dcb2572c04113ded45425857bc53aebb915c5a3473bbb280f78edc791af0130205fbaa097d2397831685d935979480e81f919847b6e91407dbcaad137b2fd73a10cd69e634bd7c569b2091163ac7fb9aa690aea4161a13c390772fd8d56237c55ec653ae85763d69f27a021a897262540cd3d1c60767b2fd795a044ae2589ad1db3e841a718cf00694395dc986f0c4ab250f0755ad701d57a6d923de456e29d6a543f5b69eef69e26d0ea9ff29de2e0c957bcdbaccaf07aa2e565feb365ad761dc01aabadd059192092aecfc6c30c7513fce5eea2ea922d41107baa9975ff128465dda96b1d6fc243c372e781bf71441b6b58e0e9ee146b8b1107c5071069a9afbaaced6d8380c90f52246021715feb18f5a80bb67489a5c237febda11851cb3619e8cd7acee8ea33125653d1f6e656f545ee4b262aa92f4d3fe0d56e0ced18b2bce1bd3ef98b12802e1d3b3037702cad6dc8f2b409b9821ab2ae1badeb37300c0f3971f7731c8c48841ac128f4b563280bfeb12b9bb2d8991e23d9560f80770440b5b34adeba0c1a25db31a9873847649460ef47bc34d4b54d5320c47106411009400e73997a7b4238609454adf8ca66ca8051389a149160bd0973a74155b195f9430b98cbbafeb2b52b7e33c48eff1ec587bcb3492bf3faa5748f3a3b90cc1c35759db739d06e8a24fa58570b9827fb2fc006881125656845cacf1ec1ed84007db42bbb0eba08cde88d3432756ad1eae617c17d8a22f092e9556248d8ab96550fc9e8434aa3754ae2fbad3c9af482ac8182635fce2bef17b578ffb0ef51e5e1deda13ca3952eab6f899bfc1bb2faecd554951ee08133e5c27b116415c6cf1bd73de4ec7f52da4a55503a1b89ecad212a4a89a09e66514fe1d4a7891088be24270f790471a7d3837af01ed54a162734a5626c58d5135d6a41a5d27c003657f3ea3518354e7388dd25ec76dd345d110b05295eb2337ecefb457b6b209deab3314b149690b71410966c47dd2e01b697eefb6e94817ed6d24513171cecc028357f88b640504539548c404b858e495b172bfe72321a5b65b00aedab6f102fc0b13bcb2487073726b16c1ae38e762d51f1b4b37335892939e33036d0d88fb77ac9d94e2b6b0e2468b4305ecf62787eb78be21b6cc368e646b8baf0d872f01105011652583b764ef8aa359f06a4c7f108ae1dd8cd0511e08baa0d8529bf1891d6565ad9bb423af8de01fc3f5d5d12b5513d92761a85159096d67bb86c7daa7d667849f7d3f6a18d4c144758e29fe7465a8fade32b9f71b1a6a0af7486c2792b5b0e0e8d8c9dd9d91f990acdb35a9f27553e852604cafaf223e8c01bc4aac1694d913da795bb286772cc77b526719c3a0bcfcd718722bf6905a517ad408fce8fa8a19aa665c78065b1f8837cb23320e908e5bc4bf1a1c789e53580ffe9536414a0f0dec4fffcb36754d977014b7b73f186334766803edbbaaae68c25bbe9029363bfe97448a80dc118933e22c4d648a61ae63301cb51eddf0a1992d837bd3127a557eb2455956ac16efee3ab84bdfbe3e16ee0b02ba41894d23c90e3efd0ff2397ee2ecf1e5fcc5136eff36f78b54875f5dfbf05334cef32f51ccaec2885673680c0e33000cfe0f3bb925080b04864171dc0e82103ac9088c1fbb25aedf29052beaa6a863e9d584d9dafaeb3ee3633c5b6352fceab85adb6a5a132f6d101ab87a59b92c6ef8294ceb475b80754dfaf280d49fcb992b27e7256439b44129e23b061179fcda572ce1f5cc47d3ca5acabd7dd7021d171ad31e7cc4a9d38f435ce35f4148e0afb1fd171dda55d9b0ea5499d02c3d2ed898a71824f50f022acc966c57871e3c6e9e31a4c2b715bb2458627897fb424cc91510f1b1691b59568c7a9c129e8e3286d8d39e34a1d83dc9bc6acec76ae6ff5ef709f86a7e9e43ec268972388fcd1b974a4c0d465ab103cc5ffe4b8ef507d8db400fc55a06c23e58f700fe6c993d3cf49a3d6b07ce2abc3fc5e9abfe3b36b2d1a17423be68e363a078f853340d091154d7f8d14cd51039e0e0c1f2f5b095f79e74c3967574ada4de8cd4ddbe3c90b17a4b78770b73b907fcaa6023407609d1f0f790a7854d4c0e1991683a08cd21f21632bfff1e4e4819f82085f13d1c798072a0abe3af321c717f67bc37ca2a12e5b61c1167fd4e9d07affa8493e6aa83c995e88398f95178fce728ef457e41411f1d95297ed3a57bafaec523c0397400cff472f872cdd08dc0333217695b5115b569da2f1eb89433a8b2bc20765009d590413d63fca5389df995ff91df82f900448c960720243b35225390bb814dd372e774e5036dfadff017f5678690aabfdb5a1c9669967087de13d973f4ab1d863f1063b2ad9a8724bb9cf47180d8557e55b39b6c6d4a478186facf46c876f39202b0ddc56e0fc9dea6b35f6b8a7d34ce817a8fdecb6d0732b35d5bea18b5b48d61fcf35238b95b54e026dea5c6b37b933eed5ad3050a140b87dbe6644b8802447d9e67724e56dea1e121cb59d6f6c9a1a18951b0108c489955e35e09d5876d80d190ced59fd3426fd88427d1289a91d51d128cf0b4ed1733ac1848dfa4a4d1086eb4f4c3e56abcb33611e083c492a21b94b6d944954385dcccb54da0e58d51d5a501dbf148f860448eecf3dec5156d965932334488d67338be741692e5fe938e858c5238a13ae187acca7892ff27ab9a6cd09482e40c275b737e60e0a49f26e70593987648cbd5033ad79ee44236d7a7bb17171cafb53bf7adecce5b2f9d8ccec08b43cb594a3a895b2a778fe0f00f64879569acbafed317279a1f2b21268ba5ced3d47b83168d8b5984b68d485e9cf0c96c886b1d5b12ce58fde151d6f795cb91df3b09fca6f7b4986287a3be6417ab63f36d37f2b83d921d4a3a317a5458241caefe8911a77bbe489df6ca60c7c6a5577b886bffb759ba67774a05896835e6594afe626d37231fdc7f6d9f35a344be31bc511cbfb517e7d66702ef653cce6585f8c7008bf6c43fe00d85996dfc7f4c3535effb4fea959b3c2c07ee30a0f747a60008e756d596bf5b6141c8924c42d5c956ca8b3846614bcb73c0237c5c19452e22327209d7ded8c70acd9061c869d54d95380ac25047eddc293adcb1b98820c5004787b283324d1c75deadf43f4456cca70d74da2e5ebb9748dfb3d1ac3cc7192cef4dba640f5fbf8a4e8f35ced5e0b2b95a02b4ec7644c2956fb91e547ffd90d742dc7cf49ef2c984bb1ec99f3844e58b6ad3538af93b0060988d5110313d31469b503d73591213596a7f251fe305684a7b366884c9de09fa9a1e5285d7794cc9489fe986b79bdb11e7d81ddb89b8bade143d4f230b73fcbeea600ab04f254eb09de6055c1a12e5d5684193876f666afc462ee31dc7bc3ec4544aa88d7f12c634de81f7056e92636e025953710529721ae18a44c26697dbd955d9b33acfee6f118cb80f84fe8c71fcb01efc7c920fb2300d6252aea99a672a71e4e78e8fd512e38e8e2dc1c63303951f1b5c5e959e29bd9be5cddcb9093d0096fb47cbffcc58ff0e41e29bf6a2410f26a0d0650be8c5e9cce1c4c8c34af511ae86533ee95c1735306a5dd579ae560936522a1cae00759af7d67b5ef0159e8ae48f9c654e2026d52ee0b66adb5cf77f854d2d3abeed2c8870ffa8de06ebe5c8355119612799563405c76bea7c533aa1f1d9a0a867857850f8123d5a316566a4932f2eff13b090c7de4741969e27e82eb2e96f7cbeb5a7ac52ff5bbdc5a25877b6d87dedfbbe9cd5fbbb24aaf4febad37d3c3e95b174e609c603225860a6447aab3bbf7f528e02516d6af1b4062c215a6caf9b640b2db2609e9cb3ba5f812a36c9b5831ec1183831aef57bac1765394a65fdf4f5657b340db322e3c4b921923131f8d397804acdafab81c7faa2449968fa211c35429b3ac6c46f18144b266ba876c330db438b148c7b87a8b726ef95566797456d426b8fe714987372cae5f09eb9a7c842607932fe7e2f2794d3ea8347c39609ab88b316887c0c2fe6f0c610b8b7bbb39de7c5c587f30db5e54a76335f4d13308cab1363f38acb6b33248025c83832a393cc47094073292bd66cf562be756d3f30a9d60e5bd7dee1073c47800f46ecdf18476303f3d4ae8899032312341822142573af29ec5b209be04b97ac39973b7c512320b90dbfddba5430529f04f998d445ccd38a95d213cf05542bb459b95a3288a81ff661d3a400b718aa4c47fc3b8cdcf69606edb27b6853ce5496fa2d4c6a778c4855704aea07f067ebe9405f4311a56fdca820a9ac44716d0620b7e3ba0b1a589c80443dac710d5f82ef658e77c432e25953c5c7b440bbd68501692fd1aa999c16a7e51cf532378f64681a29712a8c1b3061be441b8959302e8157237ac1e052147926a0ed04e9f9124039a450b8a721bd5e87741b147d0093938c1f48f888afa14f5762aef66f3a7b99d35e4b2a787bd60a7dcae65af1c0f6c68606aa860228f091de383802f8f312512743794edb756950963ff420b9f21673f39569016f1857f6053a7d6445d517de8c52a16f5ddae5c0707f13ab741a093b81e14c65cbbe035441c3d9c76721b949dc311485583859096990b1b22247d848ba5c7ca000e153739434e69708da7b42d4c658bb65a094d787e950a3a4d5f6480959fb5b9cbeef7000000000000000000000000000000000000030b152126272c39`
	// create a new reader with that JSON
	r := io.NopCloser(bytes.NewReader([]byte(jsonSig)))
	mock := &mockTransport{mockResponse: &http.Response{
		StatusCode: 200,
		Body:       r,
	}}
	u, err := url.Parse("example.com")
	assert.NoError(t, err)
	cl := internal.ApiClient{BaseURL: u, RestClient: &http.Client{Transport: mock}}
	jsonRequest, err := json.Marshal(`{message: "hello"}`)
	assert.NoError(t, err)
	resp, err := cl.Sign(context.Background(), "a2b5aaad9c6efefe7bb9b1243a043404f3362937cfb6b31833929833173f476630ea2cfeb0d9ddf15f97ca8685948820", jsonRequest)
	assert.NotNil(t, resp)
	assert.Nil(t, err)
	assert.EqualValues(t, jsonSig, fmt.Sprintf("%#x", resp.Marshal()))
}

func TestClient_Sign_HappyPath_Jsontype(t *testing.T) {
	sig := `0x6ed2f6bc411fbc99562d1ed2b4e5456a474d383b61f6202960a0b7e5b4c76fd56ff517bc48bf26d5fe88356b0bc4b4fd6048b319ae070dd3a2838982f7bca2bae5ec3588b7996b4c3070212af98b3a1c498e8ab7ecbf078cd9ebf4abaac2004633a61bd81400d036f9eb54ea945beeb2f6a398db8fe3e1fa3919ad5b7a13ee10adb2580bfe47d0d4b0f0cfe9b5b4cb7c24df98525cce6e8e53d46c9cca3effb987b16ef3acceecabaf9df04382edcf1d21cae8de22acecc14f87f4ed5fccb14cc5f66434a25a84804a97a695a8737761e2517db7e03c22e1dd074fbc7a5d8baeb64dae9d35c0f1e3b3dd9eb7c870c6e395ac108b4a9bafd71674d19ae9da63a6ebc38e54eec8b6b7b377536a20161100ce0bf0cac2d985730f65a65ece6ee9b2b5b45f400c61759bb24c84f1712bc3e31e870dd78cc03a144dae220999101dcebdb078d280e772e4ac06fcf18b5f2ba89e3caf3eb89074a56bc56a615ba99c813863e9f1dabef11adee6be56c94eac85b502536ee3ae68eb97502dac003b8bcd2f7ea0d852d3dae6811bd55d4d21d78bd0d82426836f671ce8c656e2922e03856be6358a1aaafbeb83ff7a25ac91ee69de5a7bf516b3a6182e2e8f589cc52ac70544bcf26067613e272a799afc994bca08330e971eebe5f4895aa134a7322ce92c4680188492399eb2f686c3e54a6d8fe697d0778f94ce8a7295bf82690020b5a78aac436486fbe2676bbe02e074363b3194ce735072f289fdf7e18133fc414ba8fdb69af6501f682dc9131592e96cd0f325f701c43fbb8dd077eeecfbd5be360ae28d08df7a844eba44cccea0bc26071555d54a0b5496d2cbdc071e07d6bd8e98bff01310f88767332f4984aed74ef2c016d485c36dbf584787d7ecb5b169939c7318366e068fdd8f33265ea9c62db01811e8cd548c8b1d38501ed0a3e9cbea442f8f14c94d7496d7d26a2bbc6587b6b07aa7e91aba26adc4324ba730fdce5476329f097be14cc9c5a703f021b4ba1df979a9ce58366eb8aa7e16e3b43fa7ca768b107f5e6403c9e4f6ad9e89e074762db7824ef3e9ff24172b137ef67f3ef4a091aa76b908b90e16c93f2a22ac695ecb4570269cb7b02ea9b6193e26f109da978cc469dcd745f2ddbb918285a72b8a44071980f10ac530f60a84b2efee3a85faf96987483db24550b6ef0268e51514dedee972bbc0cc0eb41869e22f003bc91ca2a5ebff36a7c71b60835e62efa6d34eb8f6adca05a3840904dc7c5f81afb3bda8980a4cccdeb476f50084087b4f805ba5c0fb7af9cd42720c2d55c3f44bbd5c1d0c90b5d95b1f8db0023f4c08b07b6e9272353701bc8ba4dbd53af861e2afe1966188a9dc1ca17080a38fcbf9cd1a296e4e75501cfaab1d754b4ec10c5c1da4da3125bcbb68f7c133e4db2e296013623a4479e47e1b78a2b872ce98d9d8cbecb7ad0e061ef2245cbfe5bddbf5c292d1b9a8505292c0410b31dbf31514cac0a92069856c534932da6e8abc22db0b28a5db1f53e084c3b9cc3c32948dc1437740207038445a265310f5dee5dc560e1d9ee093c93135ce7120efd9f5dddd73fecd3e0b5df70128fa7e0666cba060e0deb004df8eaeb765e737899137a0f8694cb9b13ba72cf9d8571d34671d62afbce6331deb94b7904fc26ecf3fe0e959903dc6716a42e4cb0dd5ade5a51e433b06909f8e5ee5f0cc90570c1aa351f21de5f45eac7d553a1fbd7168f1e96d371d00b7fe47efb9f5460b6aca921f777f92e8ca9e382d3077b3de9733fe7d010613f453837976ad656a4d7605ec63636cfb2d62d9552d45b5e1446745ab336a66c96b2adeebffc1abdb18abf66c71bcb91ad5c0a98983dd05e781b6ce30571fd61fddc42660a33ce4e9c6ac82ea3c424f33373c75c3a473adf9dbe39cd3d07b2944b688199b1d3b56b81d87d7517da96fcf922825af8bbc47b6e86fbbb1c0333b6efe56fa78dcffe92e6f8bf005935b6ee52d2925c9952bc01a730f8e7df356bcb34599385786e96c972af22104ad86ee0408115bdc0be76f72f0ec4a714fa8f9168272a938ebc39d4e86b7bc572393e6de0695977a14e151f59cb73be5641db92a09cca42f804bb51c27cb173f8bcc9465a92505826d20232237222a723b649e89e2dd3d8abeadcde23c07b80e55e4f15307b022dcb55a3c0cdb9e99b1ad287d92f295cdd0383cb9a1b47ff41feff97469226b52457c8fe320ccbfbc32f4efacf0794661b1e76dfe553801192a2c9343a1f861116d96921c9b0792217373958e6c9aa01d476489275691fb78f86ac7d84645fb1217e93cd8473ebe60f4da58f73b6f57fe73979704db4e4d7f0b279c1073ca704892ce9cfa9f6266b481005e9bac12803d39e91a4d9692c649d57b3d9eb6fbc1af1efd99ef1ab1c645bb572d6750a5fbd010b5cbddba7a1134750687b30a338ecf6694aa6af5114245204e0fd39a51c9e20af73c3417fd89da87a1ea1c5a04dca579ca2a860fb2b58e2c4972c9cfece8a056eb620ddfee2e0108623d02d0122401379b3a5670d4c414f6f928a5832f5f5fbeb728d8f4aa3e4a60db3123ddb5e952263216372b19fdaa91deeee778d1e0672ce46983c970d4280289508bf3c064a427c431d4d8cdf13ed7dc3a7fba7bc63f1fdb53b2cf0e3107be46ea1a0b129b4783d8d7de392c667f9d45c353dad2f3bfd4268a19aa19b71f59dfa06fd9126d88e4178ee26506899e2690008ba4e4b6242236b54883820d729753b19d910c752f1621c42157b8f3736ee7de40ee560889792c3555c3d9c77f84c524b494a7120aaef9a9cf0fc4bc3dea6cb12a7593307d0cc5165e9bf1117ec25b641a431573ac9cbbd5ce9672573ddc7c02b4bcf80cc0e4dc65916c78da0723ffd4a3ddf368808cd5202a426e4123b6fe7d51a69bcd8a8aeeae0a65e93439aacbe3e393b8b33e6ba76045054cc49ebe0ed45e0cfb995a3332ea22217be5edff34ca2aaf260fa449f0a648340e4b2fcfc3785a3113c1d84257a7e0e751cb0ca79851ad54515fbe2071b3e40afc0d972eb5a421fa964fc2b156d5c44dbe52cadb87dda8855d4a93a9ab2f5dc655528d56094ab7b04405d5df67f62242e409b99d34be8b0e033938a4b3adf7f69fde1819ed21a4a1bf7e9c4a63df65ead76aa2f622fa2bd1254bca327889cede32adee30008a81307d1f77382fb6691a546a628329390fcf506a717d8ddf357c079dfa70f5e681718cebc54c0450d28d3f41688bbafb30703e7bac5cdf113cb94f5b53b7967c39f9f3aab68a14dbb84430bbb3399ba9e1cf82102df6720ae3b2cb2dafcb0841c6d81ef93cecd726a43f8cd0587bf55c0717574be4203295a077ac29c9d7f4eb88d58d75ff7a79e6aa813162565646719e74aba2c2c9d1d3ef532b3f64b06fa3a29fbdb0d97b3b9c8a7889f70f1a761fbaa4302967260859a54629c43771d071ced5404921da6c6b0e2c0196bf78ca9f0b58a65e692621a151c96f4a2d35710e87475d7853afffde6dc7f27bbcd26470aca9c985bbedf4d7ade994fcd909ed36238db6ec99630def2fc58aa136dbc9907105687f4503d0212621d8d60e6257193ae57580c6c14af5a5ca0e7d77fc1619259674710a6b6129a133498aa6e1d51e7bfcdbbfffbae996b35bdc48632924edda289fa301945b98fd10cbc5c7ccef4576ed792191bff71b60f48c16334407dc15e3729282e8736f818a6b91fb2c56e9ab4bba607e49ee9d84a959957b4a5a13283d1ad3e635184ab2e0f5c5d66b839721f86d6a707941e1cd9edbc47a9d3a805d6cdc5c840c79b44fe1d9d162bdb68fe6229647f19c9b56025af3971a3789a107521a0790c0bc9a215e8036f1d0b2e1c2e12bc5624ef1f17c28808e3e5d820bc5c6736b524c7373adcb0c029aa927dca3ce650c7aa2a3d3d282f174eca96dbb1206693ba751896cbea4675c98b47bcf5c8f8daa63f13c5583f3fbc08a2b257ebcf9264ae1589d1f33427c3f5d6c2f0ae2c44234976bebe7c7232cabc0f9409e407740707a1e98838abfde24186fba941917f8e7b17ffd84d83f6a924fcf40e89b7258d86ce1a08f472c6fec0b3897c7c96197904e52962765079314756ef1a0f213002afad0b4ce78a8ecc0badb2a46a001597a0d3ca58dd29274640247856f78f8798a9fb1bb99b298d461eb00e9b7703935d3b54eaddd982c0b939bf9fdf6c19431a2078cd97864431a7c66ef4712485da6ecdc4ab6504cf66f21a7739781fc21c3d654a644f809a9429b89a186f7f027b3993461ced9ded53cd8a7b06e2c7fdb4253ed76d4652aa33fbe552a61080c31ff6a6b3ec7f2d162bd427d2bc625a7ca17b684b5c6af0d569f38b4ded7d11ad9efb73143d15ccecff25c06c3460e573da5514cb1287042f936a2ed7d99b369383dbe5b4373b86ea476e3ccd0b2613d483efc219db00ddf41ab4d81f9f5a89ddc8d6475950872b674426c5458044cc7b25a200adc1db3415861fce685b2d8f711456a1214aa2a221c62e0fc919ce5b08eca4a65d2100c41f74f212bd49f1ecfc0529959c3ccf70b8733d28a5e781c278207193f1a580c8d81e29845a6f10257e75756ccc28f337f2021afed8bed78320fb47b5153a2abcf82386f716127d15ad3a662a0325ca6d766a8cd3ee95c529a03ccd31bdbe05845287981c1f385fed4c53e228ebfb214c528de807839d97d4af402ae95f5f1101427a71f6b54e51e754ca7a76e3c681579c109d39282416d78cfa6548e4c5765e3f04f61983850de093332c9abd8971c601f1ed6fbdd5db76cf51bba7d733524f3de149c81191e24ced81f6cdf6fe83799430b832827b3c28d826a7ddfdcdce4d036a79b4d6d4d96272b44e0f7cb211702a11bf82bb75f0b766325821e118ce7b045c66ae11a10e6d6b995eec791f968ba69b0fc7ce2bec8dae5cbcae75ac0b2f685e7240dac1f4f591697b0cac21ba979cf14f88971c1cd9d048e0fd7db2ea6e2cc0b3705ebcd10deca3a1204d6c93da5266dfc0b637060260339f08b55cd723d969c0d87898bf96fbc1114ac6f923b6bce0fba769ca02bc3d8eeda7e7cbd6329963872f12e39d87bdcd03c003e13417d1678f23ec02b920e7966d47b52824d8eab9d68c2f08af025449f55dd4a93cc658c7631c6ab04c9dea2242f02fcde75ff3c6cce880722b803530bc5cac48f3845a55dc883d99cc305ae565eb507de9949489fe8bb3f183ca46d6f786f657b39f1969268759261ee3720a49654f792b0ab3014ee28efa700be2cf1ea85dbdd95b0853d74f22ae9caa7d2a3201213337960172fe03b55c7c4f51a9919998306ec82eb76cb8904f2a7a7e0dd6b7c01524f7fb5fbc9b68de49924ee2786420eb839b87d467eaa3767aad0b211a170bb2dcb2680d7f68aa66cc1ab643a4a69332a043edca7a96deff21f702b05a58354dfebbe171d7380629d974f3a368498178f48fd6bc77c8353a5fd42f2250d08ba381ea2d296d84d041211d1e8afd066e596e0549a06548475dc93caabbfd4565354a108870540a1ed1d70f64dcd6058d16d2ffdc89b54bd94a072f11361eeb4cdd48af7a095993ac59017df25d7e24c3eca0b63f8cfca14b2bbd3e2f5228ef4cde08df3e3ad1a7bc3fca1f1202edcff12eb34d7e5b2935dd2441b58254ff7137495d8ecc2a100a4bc87c584c5be41bba805b2be1780823e44c0d729ae67db69310ce98ded361ab36b56055aa59654af38c5568b8b66d8d033ade1ae15cb65c303672114adb5ef301008fde6ccc169f922928c47c10bf79338c71e6bb4743dd40801e51fd6418572455bc46c0ab92517b9392c7a3c3ea7083fe2957445e708a5c7bb08c9d610a703961db9e5f9f2213b6793eeca7c8b64cb63a7e2f3c599a7e8f46f1fb2d16eabe4be0a5d6e948cc0bd6e4a7ae5d523a15bf58365b21a6248cbe00bb9a8cfc3338dad259fe0b9ba88952c30ea8b880813e7dce2ed9b3391e6fb9d3b3946f69d4f59cd277c2eed59225412aee3a1de783708e0cd4437906684831d35541ed4db52599280bc7a0193cee526c7dc090ba159dcec778f6964a4fbec601e17753b73380e6cc98d5d76fd59d6ce338002f86b529e010fbbb722ae1dbd4ced5eb7feda9cb9f757834a74ae21eccbd78745c251ad1ff8e5ae913276de512d55781bc512920cb3b643e7a991ea96a7f3945e510757d8139d24920d1e0d29f7e467603a562f7f029704e9b6c95b787347eed7d33e806cbf4026226b23aa898d9697b7012dc5ea546f8f3bd5b4d28a80d25cf1a12802ea25103392d7dc8a34bc6d8f9d9b513a77f26a76e677e01eac5f659f7dfd87638d4bf687d164e416fc04655f73cf8f005417078e02c11e17b6362b1469f133f185c2c2b339c40b3b10609faeee00193173747dcbd9fc021e486a709ab1f8ff001760657acbd0ddf67191b8b9e1e5023a648b9db2fb1226353a437f8cc7282d62759ce8f8000000000000000000000000000000050e1720262d353c`
	byteval, err := hexutil.Decode(sig)
	require.NoError(t, err)
	sigResp := &internal.SignatureResponse{
		Signature: byteval,
	}
	jsonBytes, err := json.Marshal(sigResp)
	require.NoError(t, err)
	require.NoError(t, err)
	// create a new reader with that JSON
	header := http.Header{}
	header.Set("Content-Type", "application/json;  charset=UTF-8")
	r := io.NopCloser(bytes.NewReader(jsonBytes))
	mock := &mockTransport{mockResponse: &http.Response{
		StatusCode: 200,
		Header:     header,
		Body:       r,
	}}
	u, err := url.Parse("example.com")
	assert.NoError(t, err)
	cl := internal.ApiClient{BaseURL: u, RestClient: &http.Client{Transport: mock}}
	jsonRequest, err := json.Marshal(`{message: "hello"}`)
	assert.NoError(t, err)
	resp, err := cl.Sign(context.Background(), "a2b5aaad9c6efefe7bb9b1243a043404f3362937cfb6b31833929833173f476630ea2cfeb0d9ddf15f97ca8685948820", jsonRequest)
	assert.NotNil(t, resp)
	assert.Nil(t, err)
	assert.EqualValues(t, sig, fmt.Sprintf("%#x", resp.Marshal()))
}

func TestClient_Sign_500(t *testing.T) {
	jsonSig := `0xb3baa751d0a9132cfe93e4e3d5ff9075111100e3789dca219ade5a24d27e19d16b3353149da1833e9b691bb38634e8dc04469be7032132906c927d7e1a49b414730612877bc6b2810c8f202daf793d1ab0d6b5cb21d52f9e52e883859887a5d9`
	// create a new reader with that JSON
	r := io.NopCloser(bytes.NewReader([]byte(jsonSig)))
	mock := &mockTransport{mockResponse: &http.Response{
		StatusCode: 500,
		Body:       r,
	}}
	u, err := url.Parse("example.com")
	assert.NoError(t, err)
	cl := internal.ApiClient{BaseURL: u, RestClient: &http.Client{Transport: mock}}
	jsonRequest, err := json.Marshal(`{message: "hello"}`)
	assert.NoError(t, err)
	resp, err := cl.Sign(context.Background(), "a2b5aaad9c6efefe7bb9b1243a043404f3362937cfb6b31833929833173f476630ea2cfeb0d9ddf15f97ca8685948820", jsonRequest)
	assert.NotNil(t, err)
	assert.Nil(t, resp)

}

func TestClient_Sign_412(t *testing.T) {
	jsonSig := `0xb3baa751d0a9132cfe93e4e3d5ff9075111100e3789dca219ade5a24d27e19d16b3353149da1833e9b691bb38634e8dc04469be7032132906c927d7e1a49b414730612877bc6b2810c8f202daf793d1ab0d6b5cb21d52f9e52e883859887a5d9`
	// create a new reader with that JSON
	r := io.NopCloser(bytes.NewReader([]byte(jsonSig)))
	mock := &mockTransport{mockResponse: &http.Response{
		StatusCode: 412,
		Body:       r,
	}}
	u, err := url.Parse("example.com")
	assert.NoError(t, err)
	cl := internal.ApiClient{BaseURL: u, RestClient: &http.Client{Transport: mock}}
	jsonRequest, err := json.Marshal(`{message: "hello"}`)
	assert.NoError(t, err)
	resp, err := cl.Sign(context.Background(), "a2b5aaad9c6efefe7bb9b1243a043404f3362937cfb6b31833929833173f476630ea2cfeb0d9ddf15f97ca8685948820", jsonRequest)
	assert.NotNil(t, err)
	assert.Nil(t, resp)

}

func TestClient_Sign_400(t *testing.T) {
	jsonSig := `0xb3baa751d0a9132cfe93e4e3d5ff9075111100e3789dca219ade5a24d27e19d16b3353149da1833e9b691bb38634e8dc04469be7032132906c927d7e1a49b414730612877bc6b2810c8f202daf793d1ab0d6b5cb21d52f9e52e883859887a5d9`
	// create a new reader with that JSON
	r := io.NopCloser(bytes.NewReader([]byte(jsonSig)))
	mock := &mockTransport{mockResponse: &http.Response{
		StatusCode: 400,
		Body:       r,
	}}
	u, err := url.Parse("example.com")
	assert.NoError(t, err)
	cl := internal.ApiClient{BaseURL: u, RestClient: &http.Client{Transport: mock}}
	jsonRequest, err := json.Marshal(`{message: "hello"}`)
	assert.NoError(t, err)
	resp, err := cl.Sign(context.Background(), "a2b5aaad9c6efefe7bb9b1243a043404f3362937cfb6b31833929833173f476630ea2cfeb0d9ddf15f97ca8685948820", jsonRequest)
	assert.NotNil(t, err)
	assert.Nil(t, resp)

}

func TestClient_GetPublicKeys_HappyPath(t *testing.T) {
	// public keys are returned hex encoded with 0x
	j := `["0xddc6cb97f9bd1e4b05e4f59c3f5696ad8f84d00dfb3187431dbdd37cb58d6e52a2b1e219a22ba42a8c690d81b6e0d21d20115d8a59a63cc9e904b2dc70e0deca7169e377bd5229b6984e244c00b9c0777878abc545166a227f8b000e1e6578f1813f58759e61568eb6707b3cc972d043b710353f5ab9d4819eb4a6ddf3e83d19b8274aee44c89318613d4f4130ef542c8a33cbaad3403943ff0f0ca55308bc0934032b081e58d7f33ee4ae02ddb06e7a8dd20294ad74dba735e9ab69f0b6e2c3b9d9540196136613c749a0fa57131e06aaaf0e27372e1d2a090d19f2e475fb281fee2f2f95ab9267fa9746a8163d975efddb8b1d8ddd142c6229e8daedbbae314f097ea2777199be2d737964ee8e6464545925d20c85b8e53b5ce4f4290e7f2c1d4384f3a0873164c23b22fef75dfc1ec1855ebbb3732ffbc9282bb8e292ba87bfb9c5dc99f581368edaa29161296b8584208d652661e89ca6ea9445fb34f6aae87f4f2f24afe3934b33357f5fce6edea2692a2937b126e8fb451d06286dbc32182fad11fd919a48cacfde6a73f282248bafc8d19406045e0f670d1c71e847751bd3395e5bb8a89196a78275c38a2aa976fbb44390354a6e3bc07bbb3b19f083f88f69c4af5db2a8377139dda8a7c9023e8439c2ae719b2682372149fc1ddc0b381c471963c0a78530d0d1144241612df9c7a119e9ce5ae105e85bdbe2d325a7ec6a5e79d7ff6de20bbfec57803ebf652988bfa6a300e8e7eb6e8cb966d72b028c109ccac8de887dd89a2c615766ad56cbf6c47677c015a3e4098c77c10530c18851b1ba261063e9eb844cb57ab9f7e24d47c179929cc541367805ad7d89248e2d9ade76536990345540fec27ef7e503840aa55454c569fb663f913d83120a2796f68daab97846fc1b70578d490a32b5c44b907ce7a61cc8ed5203cc9eaf8dcc0e54cbeb703bc64ae608cad8d3e0471f7d02127ff5bb188947c980b17886057ceece0f79901195f61f267a2c21586266bdf07bb537914f4b46dd6599e155e18a7c6542e0d86332f94c91123665db9a50a8619bb0a0e59349b44edf23e3598c95a323b4fab26a41630feda54a649b86acb4e0f207e242b860c1ec6e6830eb80fba85daaeeae598fc647a22a539bb3b5904fd5e75120c686304041ddc87f2613b8a8db302655b0dfcee897d51c724fdc1844c3b7adc615fa585aa49448433c40aa0f6c7e49c881599ee070fb5b7a4fed52bb1902e67e28ed28c0e927e4138858b0d6edb251fdbedc30871e47c176f9b22e89165dc5ff32512425bd179d58c2dc4b1d4e6781ec385ac95dac9918529b9f888ecaa63f87d7bdca1c660fdc91132ddeec3653232c3b5c10ced8ef8ba36c7bb3e4d41fa54fabd89729ca2a27e3fd677c5ec2b2abd8425ca5354df964cb659c08605f6bcbc307693ae65624f2deee4a142a3d2128fa06daf7a02b96bb023277867bd129d17b1c4e2ac39b5a14f200f116ab0cccf75468e8912621f0c280e9d59d8fd3039f5445d5242c5d247e25a59b0ab431385264fdd951cf7d05dc5811e900d575a0b18ed06eee22cd226deb120f3f6fc3841e06fca87821abab292ead5630abd4e5d43df82513e962c90890c17eb6ebafb7fa06954ae9e13a240f429f4c8c9631aed21a1dfc8f1ac1930bb2e5859ff20853ee20774d7bdd90295d9e22c093fc4e61fa3d4cf86cd005636b0826669b854d8339895a1ad78253a3908f28d59b16d6d219aa77f184d1860e3bd0b988a10bb37f64113182c1b47d8f6b2a6e9684276f331c35cf4c7b83452b8cb369525215511e4d556bd049e9bce3eb152a8d387229e105a0f95eb8c4d3ba2b8957248f61072b46d1ad7da121a9b1a2e2b6302426ef7cf209a91dbc3c22af49cd6bcc11b9dd067158dccb1b477751ce211d0f5568ad206bf32c74a5bb4ed111332e15263e96083911138d4e2d1474a7ac7fe0989e1f54c7c0d7aee1b53e916fb83b4b75a4f91fb364e1da950c94726de023060fa078863b1d5da47f0b43a5067cfe2048d377f73460691b93fe85525c4bd1b5a3e67330fcf81e6d45d2a10ad774b96c1ebf1e2705f3ba37ea60d68a17f2e6058ad0e6968d81e8822b5c8c62b724a724b27990c37043e96de2ffaec8e3d33372de8b8d73e976b42f03f77dff021c8d896822da0135ce9891ae1cdc53a6022947e8fd2611e5050d4486995f4ee89d2efb31ef3fbd59b11fd36b1d94e5b1f141db9b745f163926b91810f914c43a5d3b9142d4acee69571b794902176df68bc773bb22a9467dd47f0a52f35461b1f8fc690e0d40ea8c2270f9b24ac486074ff4bcec94e883fb80b24b0a9c1f0d2c08fab49cae64ea5f55e21a6a706c7ab5a6e58ba1e5f1dc6e0f2c198de08f2d0e29e4d32496f044878861999a6fc2a341f017f1e0d27e2766aca1d2ac8ed8a687c3cf30f2e30794dfd92501ff3a39915080f0623b5f75d458439c3e7695acbfd45e07247c018bb80205c80079f81bd176c900243b9ab69a2dbc8921199445c2d9db106065c20b9371b03fd0f7758ab3eb248a92c894ccc2aaf6d20775e669acaff5b56a7c7e46229de31a6dee16bad4257483a379a8e05fc8c9286785f2b73e6c6decc57fcca3ece8442032568f7020570dccdf5675274d2c9509b55798d24f2ecdcb2022ffd4bd86d1d77237beab34eb4cbe459d76ce5d878a6da003d14891c0b5986f1a6c4c3044a25768e3261ed758571c92cf0c7d165ab80097325066efbdf1a97d575a7266266424b04d67147963089468dffe7995697d111f07e3d39d024586e3127046f679693065ff0c4ce2ac28eed03834c884fa9fe3fd95a2a204b8e59646a2047d760fe3aa89a0427d1124e63540f1e532c0b9e1d0f7ebfb56a07e0415b35ce51f3423ed153d880db1bf05976b598f6348dd641c213230cb2ef34a71975b34667eb2ba9e407bf87d30f041f022848f4ebe53fbc27db58dba3a5bcdb5540009a11e07d7fb120d58a4c723b53ee9582e74676e57e87ce84d292b6ccedc8e5c306de7912578dfaecfaf8274795b151ba0e1051700ce012ab7751f202bdf02f65b5aaebc49bcdc59e8598c3792aa6f214f11f2af64dd334c09d5a86473204e9930136313f39d4931881982113ffac26fb697d3f7e1336e4be4648884ccd5a06c25ceba9e9a85f72c7363af28f189a4fcc8903e068460a682ad46561d3b9e29526498f8ab807e7f7ed585da7ab9b798b93f41616422166bbb72214f438230313a53ec93685fc05d6eece8e7e2168787b114bb1693497512c637ddff6935ea4c164504a776f7ad356f835421eb25faebb38d88cca96e1dfac55e12480e1d176333a7a481ffb0263b3ee9c93342bbd22bea125e0386cca9daea23983b65bfac6f244970388963f9efdf48af255ddb9baf74bd6a0f695dfa8eece84ce3147563daa4d2a57f7c518ac04a2a39504781d3c689b73b51cbb7bcd433db60c34627fda4c50e5b8fa0d59f809e7427e9e3cb778f1fe03105582532274b0f5a22df574e60a198adeec9824d5e2210ee017936cf595a0443a22a2f40b915f63a8bfce0479abbd269abf3896444cdf78fede985586d0f67582d23e1f010b4d0075153c4298a9410781f3f6ddf2d022e9b877b3d520482c12634bf4285c2985b5e9dfbd02f58450b"]`
	// create a new reader with that JSON
	r := io.NopCloser(bytes.NewReader([]byte(j)))
	mock := &mockTransport{mockResponse: &http.Response{
		StatusCode: 200,
		Body:       r,
	}}
	u, err := url.Parse("example.com")
	assert.NoError(t, err)
	cl := internal.ApiClient{BaseURL: u, RestClient: &http.Client{Transport: mock}}
	resp, err := cl.GetPublicKeys(context.Background(), "example.com/api/publickeys")
	assert.NotNil(t, resp)
	assert.Nil(t, err)
	// we would like them as 2592byte base64 without 0x
	assert.EqualValues(t, "[221 198 203 151 249 189 30 75 5 228 245 156 63 86 150 173 143 132 208 13 251 49 135 67 29 189 211 124 181 141 110 82 162 177 226 25 162 43 164 42 140 105 13 129 182 224 210 29 32 17 93 138 89 166 60 201 233 4 178 220 112 224 222 202 113 105 227 119 189 82 41 182 152 78 36 76 0 185 192 119 120 120 171 197 69 22 106 34 127 139 0 14 30 101 120 241 129 63 88 117 158 97 86 142 182 112 123 60 201 114 208 67 183 16 53 63 90 185 212 129 158 180 166 221 243 232 61 25 184 39 74 238 68 200 147 24 97 61 79 65 48 239 84 44 138 51 203 170 211 64 57 67 255 15 12 165 83 8 188 9 52 3 43 8 30 88 215 243 62 228 174 2 221 176 110 122 141 210 2 148 173 116 219 167 53 233 171 105 240 182 226 195 185 217 84 1 150 19 102 19 199 73 160 250 87 19 30 6 170 175 14 39 55 46 29 42 9 13 25 242 228 117 251 40 31 238 47 47 149 171 146 103 250 151 70 168 22 61 151 94 253 219 139 29 141 221 20 44 98 41 232 218 237 187 174 49 79 9 126 162 119 113 153 190 45 115 121 100 238 142 100 100 84 89 37 210 12 133 184 229 59 92 228 244 41 14 127 44 29 67 132 243 160 135 49 100 194 59 34 254 247 93 252 30 193 133 94 187 179 115 47 251 201 40 43 184 226 146 186 135 191 185 197 220 153 245 129 54 142 218 162 145 97 41 107 133 132 32 141 101 38 97 232 156 166 234 148 69 251 52 246 170 232 127 79 47 36 175 227 147 75 51 53 127 95 206 110 222 162 105 42 41 55 177 38 232 251 69 29 6 40 109 188 50 24 47 173 17 253 145 154 72 202 207 222 106 115 242 130 36 139 175 200 209 148 6 4 94 15 103 13 28 113 232 71 117 27 211 57 94 91 184 168 145 150 167 130 117 195 138 42 169 118 251 180 67 144 53 74 110 59 192 123 187 59 25 240 131 248 143 105 196 175 93 178 168 55 113 57 221 168 167 201 2 62 132 57 194 174 113 155 38 130 55 33 73 252 29 220 11 56 28 71 25 99 192 167 133 48 208 209 20 66 65 97 45 249 199 161 25 233 206 90 225 5 232 91 219 226 211 37 167 236 106 94 121 215 255 109 226 11 191 236 87 128 62 191 101 41 136 191 166 163 0 232 231 235 110 140 185 102 215 43 2 140 16 156 202 200 222 136 125 216 154 44 97 87 102 173 86 203 246 196 118 119 192 21 163 228 9 140 119 193 5 48 193 136 81 177 186 38 16 99 233 235 132 76 181 122 185 247 226 77 71 193 121 146 156 197 65 54 120 5 173 125 137 36 142 45 154 222 118 83 105 144 52 85 64 254 194 126 247 229 3 132 10 165 84 84 197 105 251 102 63 145 61 131 18 10 39 150 246 141 170 185 120 70 252 27 112 87 141 73 10 50 181 196 75 144 124 231 166 28 200 237 82 3 204 158 175 141 204 14 84 203 235 112 59 198 74 230 8 202 216 211 224 71 31 125 2 18 127 245 187 24 137 71 201 128 177 120 134 5 124 238 206 15 121 144 17 149 246 31 38 122 44 33 88 98 102 189 240 123 181 55 145 79 75 70 221 101 153 225 85 225 138 124 101 66 224 216 99 50 249 76 145 18 54 101 219 154 80 168 97 155 176 160 229 147 73 180 78 223 35 227 89 140 149 163 35 180 250 178 106 65 99 15 237 165 74 100 155 134 172 180 224 242 7 226 66 184 96 193 236 110 104 48 235 128 251 168 93 170 238 174 89 143 198 71 162 42 83 155 179 181 144 79 213 231 81 32 198 134 48 64 65 221 200 127 38 19 184 168 219 48 38 85 176 223 206 232 151 213 28 114 79 220 24 68 195 183 173 198 21 250 88 90 164 148 72 67 60 64 170 15 108 126 73 200 129 89 158 224 112 251 91 122 79 237 82 187 25 2 230 126 40 237 40 192 233 39 228 19 136 88 176 214 237 178 81 253 190 220 48 135 30 71 193 118 249 178 46 137 22 93 197 255 50 81 36 37 189 23 157 88 194 220 75 29 78 103 129 236 56 90 201 93 172 153 24 82 155 159 136 142 202 166 63 135 215 189 202 28 102 15 220 145 19 45 222 236 54 83 35 44 59 92 16 206 216 239 139 163 108 123 179 228 212 31 165 79 171 216 151 41 202 42 39 227 253 103 124 94 194 178 171 216 66 92 165 53 77 249 100 203 101 156 8 96 95 107 203 195 7 105 58 230 86 36 242 222 238 74 20 42 61 33 40 250 6 218 247 160 43 150 187 2 50 119 134 123 209 41 209 123 28 78 42 195 155 90 20 242 0 241 22 171 12 204 247 84 104 232 145 38 33 240 194 128 233 213 157 143 211 3 159 84 69 213 36 44 93 36 126 37 165 155 10 180 49 56 82 100 253 217 81 207 125 5 220 88 17 233 0 213 117 160 177 142 208 110 238 34 205 34 109 235 18 15 63 111 195 132 30 6 252 168 120 33 171 171 41 46 173 86 48 171 212 229 212 61 248 37 19 233 98 201 8 144 193 126 182 235 175 183 250 6 149 74 233 225 58 36 15 66 159 76 140 150 49 174 210 26 29 252 143 26 193 147 11 178 229 133 159 242 8 83 238 32 119 77 123 221 144 41 93 158 34 192 147 252 78 97 250 61 76 248 108 208 5 99 107 8 38 102 155 133 77 131 57 137 90 26 215 130 83 163 144 143 40 213 155 22 214 210 25 170 119 241 132 209 134 14 59 208 185 136 161 11 179 127 100 17 49 130 193 180 125 143 107 42 110 150 132 39 111 51 28 53 207 76 123 131 69 43 140 179 105 82 82 21 81 30 77 85 107 208 73 233 188 227 235 21 42 141 56 114 41 225 5 160 249 94 184 196 211 186 43 137 87 36 143 97 7 43 70 209 173 125 161 33 169 177 162 226 182 48 36 38 239 124 242 9 169 29 188 60 34 175 73 205 107 204 17 185 221 6 113 88 220 203 27 71 119 81 206 33 29 15 85 104 173 32 107 243 44 116 165 187 78 209 17 51 46 21 38 62 150 8 57 17 19 141 78 45 20 116 167 172 127 224 152 158 31 84 199 192 215 174 225 181 62 145 111 184 59 75 117 164 249 31 179 100 225 218 149 12 148 114 109 224 35 6 15 160 120 134 59 29 93 164 127 11 67 165 6 124 254 32 72 211 119 247 52 96 105 27 147 254 133 82 92 75 209 181 163 230 115 48 252 248 30 109 69 210 161 10 215 116 185 108 30 191 30 39 5 243 186 55 234 96 214 138 23 242 230 5 138 208 230 150 141 129 232 130 43 92 140 98 183 36 167 36 178 121 144 195 112 67 233 109 226 255 174 200 227 211 51 114 222 139 141 115 233 118 180 47 3 247 125 255 2 28 141 137 104 34 218 1 53 206 152 145 174 28 220 83 166 2 41 71 232 253 38 17 229 5 13 68 134 153 95 78 232 157 46 251 49 239 63 189 89 177 31 211 107 29 148 229 177 241 65 219 155 116 95 22 57 38 185 24 16 249 20 196 58 93 59 145 66 212 172 238 105 87 27 121 73 2 23 109 246 139 199 115 187 34 169 70 125 212 127 10 82 243 84 97 177 248 252 105 14 13 64 234 140 34 112 249 178 74 196 134 7 79 244 188 236 148 232 131 251 128 178 75 10 156 31 13 44 8 250 180 156 174 100 234 95 85 226 26 106 112 108 122 181 166 229 139 161 229 241 220 110 15 44 25 141 224 143 45 14 41 228 211 36 150 240 68 135 136 97 153 154 111 194 163 65 240 23 241 224 210 126 39 102 172 161 210 172 142 216 166 135 195 207 48 242 227 7 148 223 217 37 1 255 58 57 145 80 128 240 98 59 95 117 212 88 67 156 62 118 149 172 191 212 94 7 36 124 1 139 184 2 5 200 0 121 248 27 209 118 201 0 36 59 154 182 154 45 188 137 33 25 148 69 194 217 219 16 96 101 194 11 147 113 176 63 208 247 117 138 179 235 36 138 146 200 148 204 194 170 246 210 7 117 230 105 172 175 245 181 106 124 126 70 34 157 227 26 109 238 22 186 212 37 116 131 163 121 168 224 95 200 201 40 103 133 242 183 62 108 109 236 197 127 204 163 236 232 68 32 50 86 143 112 32 87 13 204 223 86 117 39 77 44 149 9 181 87 152 210 79 46 205 203 32 34 255 212 189 134 209 215 114 55 190 171 52 235 76 190 69 157 118 206 93 135 138 109 160 3 209 72 145 192 181 152 111 26 108 76 48 68 162 87 104 227 38 30 215 88 87 28 146 207 12 125 22 90 184 0 151 50 80 102 239 189 241 169 125 87 90 114 102 38 100 36 176 77 103 20 121 99 8 148 104 223 254 121 149 105 125 17 31 7 227 211 157 2 69 134 227 18 112 70 246 121 105 48 101 255 12 76 226 172 40 238 208 56 52 200 132 250 159 227 253 149 162 162 4 184 229 150 70 162 4 125 118 15 227 170 137 160 66 125 17 36 230 53 64 241 229 50 192 185 225 208 247 235 251 86 160 126 4 21 179 92 229 31 52 35 237 21 61 136 13 177 191 5 151 107 89 143 99 72 221 100 28 33 50 48 203 46 243 74 113 151 91 52 102 126 178 186 158 64 123 248 125 48 240 65 240 34 132 143 78 190 83 251 194 125 181 141 186 58 91 205 181 84 0 9 161 30 7 215 251 18 13 88 164 199 35 181 62 233 88 46 116 103 110 87 232 124 232 77 41 43 108 206 220 142 92 48 109 231 145 37 120 223 174 207 175 130 116 121 91 21 27 160 225 5 23 0 206 1 42 183 117 31 32 43 223 2 246 91 90 174 188 73 188 220 89 232 89 140 55 146 170 111 33 79 17 242 175 100 221 51 76 9 213 168 100 115 32 78 153 48 19 99 19 243 157 73 49 136 25 130 17 63 250 194 111 182 151 211 247 225 51 110 75 228 100 136 132 204 213 160 108 37 206 186 158 154 133 247 44 115 99 175 40 241 137 164 252 200 144 62 6 132 96 166 130 173 70 86 29 59 158 41 82 100 152 248 171 128 126 127 126 213 133 218 122 185 183 152 185 63 65 97 100 34 22 107 187 114 33 79 67 130 48 49 58 83 236 147 104 95 192 93 110 236 232 231 226 22 135 135 177 20 187 22 147 73 117 18 198 55 221 255 105 53 234 76 22 69 4 167 118 247 173 53 111 131 84 33 235 37 250 235 179 141 136 204 169 110 29 250 197 94 18 72 14 29 23 99 51 167 164 129 255 176 38 59 62 233 201 51 66 187 210 43 234 18 94 3 134 204 169 218 234 35 152 59 101 191 172 111 36 73 112 56 137 99 249 239 223 72 175 37 93 219 155 175 116 189 106 15 105 93 250 142 236 232 76 227 20 117 99 218 164 210 165 127 124 81 138 192 74 42 57 80 71 129 211 198 137 183 59 81 203 183 188 212 51 219 96 195 70 39 253 164 197 14 91 143 160 213 159 128 158 116 39 233 227 203 119 143 31 224 49 5 88 37 50 39 75 15 90 34 223 87 78 96 161 152 173 238 201 130 77 94 34 16 238 1 121 54 207 89 90 4 67 162 42 47 64 185 21 246 58 139 252 224 71 154 187 210 105 171 243 137 100 68 205 247 143 237 233 133 88 109 15 103 88 45 35 225 240 16 180 208 7 81 83 196 41 138 148 16 120 31 63 109 223 45 2 46 155 135 123 61 82 4 130 193 38 52 191 66 133 194 152 91 94 157 251 208 47 88 69 11]", fmt.Sprintf("%v", resp[0][:]))
}

func TestClient_GetPublicKeys_EncodingError(t *testing.T) {
	// public keys are returned hex encoded with 0x
	j := `["a2b5aaad9c6efefe7bb9b1243a043404f3362937c","fb6b31833929833173f476630ea2cfe","b0d9ddf15fca8685948820"]`
	// create a new reader with that JSON
	r := io.NopCloser(bytes.NewReader([]byte(j)))
	mock := &mockTransport{mockResponse: &http.Response{
		StatusCode: 200,
		Body:       r,
	}}
	u, err := url.Parse("example.com")
	assert.NoError(t, err)
	cl := internal.ApiClient{BaseURL: u, RestClient: &http.Client{Transport: mock}}
	resp, err := cl.GetPublicKeys(context.Background(), "example.com/api/publickeys")
	assert.Equal(t, err.Error(), "failed to decode from Hex from the following public key index locations: 0, 1, 2, ")
	assert.Nil(t, resp)
}

// TODO: not really in use, should be revisited
func TestClient_ReloadSignerKeys_HappyPath(t *testing.T) {
	mock := &mockTransport{mockResponse: &http.Response{
		StatusCode: 200,
		Body:       io.NopCloser(bytes.NewReader(nil)),
	}}
	u, err := url.Parse("example.com")
	assert.NoError(t, err)
	cl := internal.ApiClient{BaseURL: u, RestClient: &http.Client{Transport: mock}}
	err = cl.ReloadSignerKeys(context.Background())
	assert.Nil(t, err)
}

// TODO: not really in use, should be revisited
func TestClient_GetServerStatus_HappyPath(t *testing.T) {
	j := `"some server status, not sure what it looks like, need to find some sample data"`
	r := io.NopCloser(bytes.NewReader([]byte(j)))
	mock := &mockTransport{mockResponse: &http.Response{
		StatusCode: 200,
		Body:       r,
	}}
	u, err := url.Parse("example.com")
	assert.NoError(t, err)
	cl := internal.ApiClient{BaseURL: u, RestClient: &http.Client{Transport: mock}}
	resp, err := cl.GetServerStatus(context.Background())
	assert.NotNil(t, resp)
	assert.Nil(t, err)
}
*/
