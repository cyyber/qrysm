package util

import (
	"bytes"
	"encoding/hex"
	"testing"

	"github.com/theQRL/qrysm/config/params"
	"github.com/theQRL/qrysm/testing/require"
	"google.golang.org/protobuf/proto"
)

func TestSetupInitialDeposits_1024Entries(t *testing.T) {
	entries := 1
	resetCache()
	deposits, privKeys, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, depositDataRoots, err := DeterministicDepositTrie(len(deposits))
	require.NoError(t, err)

	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	if len(privKeys) != entries {
		t.Fatalf("incorrect number of private keys returned, wanted %d but received %d", entries, len(privKeys))
	}
	expectedPublicKeyAt0 := []byte("2e3bcd95f5e30d0b7c5577b66c6373c567a6151ea39a75e477fb9b979276efac8952fcab3b1e671c1903063c08de679ae4fdda1e3f2cf675364a0f9fa5cebb7a6d69dfd6fd5b060dce52f19c3d95337ed388b53ea8d9340860cdfe449187d617e072979f84d7c9bc1a7169706b6fbe01e51c6c8117be3d61e79c046827d095a6f88d4c452da251910d34c7e77e773d667db344535b71998d33920d21d03f16c8b60d27448d24dbe239771bb312be22ef881e919a8bb2cf63108d6122f1ccdd3dce3ccc39a4bf06bfc8acdfeac9261cb061b64e1210dbd70d1da94145fb46e114fd61111c7e28f96a8023b4b3d2b705e347d9d5f629e0c64a533eaf0a84095ccb609196b768d1212db3d957fbf5df67fc8a14c72fba9659ae677647c24dd9d121094ac1cac39f14fbbe5e8624808f004e970b3530c5118cfbb1f041308eba8c8a5bec6ac20805790eb793c21eed3908c0ee74075ebe0f8367d46341f548326a9dfe96dc237a7e103010c5810472d071dc86a3f12936e8f3181eb8de498719acafe20cd59f8291b0313fa70f9843fa65a49712e92516accbb9d2c30c341b5341d618db57299937b7bbd7d51ee9b5e1329cfd725988ad4d8f01389497bfcfe904bbebfd69e9adaf1afa15136f2fe355d4e54aa4c21a4c41bf1a9172535504058d7aaceb9776f16e5c209204b755de6a978cc9952d4bf45b24718cab949e198fef31bc14a09f8474ee0037b758bfb952f5bf0a5f2231c02dcded4c85600a447b80ffd39d6a07c9dedd7efdd45b9c855d9a9b6a88f1f14f405a7608c1f64cd815df316a3ad8442b75df79aade1a9156eb917ad18251406a277cf38f9870a7902b4422931d73406f87e0802e96965773935d2639a649863198d83946425c40a84413d2b1bca109573dc6298584b8c589373be2ca7732478b220b1a214182f96a26c5a1b45dda66d2385346301d167d30202b4fa6167cfb87ecf0377d33a7cac6f38b29ff384481c4531e47a94197334e8ff9f77eb868813f9d5ba5249d9006a2317397cafdd206375d9654eceff93115a530e84ae55a7a25d02d44d737f42da58486c7dc3e92f3312ca80dfe2a9e87a52c6cfd852fb23767a9e551455ce7f2629855cc28c56e83cd6f2e1d4e3f05058b6a748fcdce270decc01149d96a9ab1f4f8ac1c72742f4fb0f602144e018697134d9ed2a5771bba1a8702ce94fc1732299080616348bb6eeaf7ed985e881f0a2a407b22e3a8426d4a4e2ceb257d4e635cb12c1706edc0fc77043652f3ccf3afa7d2b97c3b60bd0078d7220de39fd1e822e37c6827b870d1ce431015b03b1c8e2e88283bd8d7c6ca88673f7141d88c702d4f2bb35aa8f953249f429d7f80a67ed4352d5b2b79694f545f89d23e7e4a96c98647236c55bfe2d02f1fcfa254f9089baef4a5c8b9ecf5936cd6102500d67993ed92143dfca9c60caf49b25096c79bb9661839032507f99e8770702fa74babffe16da6b4c66fdf47e9fa03321ec973582dc4492c3025254037f55bfd47bed448105445ff7d9f0b2fbb84d798151c6d1255982dceda6abe534c1a487b9f0a2669faddce68840651c57daa54664e2dc11084867d98687a17758ddacbf0b2088e46f1c87deda65a904020c187e26fb22053aaa4daea57caaf9df6119909e727447d483492c961f72918e4dd8a7e543aa490b39c1f45e05b22f3e9023bbcadf0f91b3fdab1ac16aae2d6f13729219d5ae70b2ba8b552f23a25e56bad561d06c3c33a6578a966b9a9e8971c6008ad5791cd87ab2da27690b3f2868191a65abb6add5f72613a6ba333b1cbdea995cad79007eacc931061cb6c107b55973a87d15bc9c95d2d9e4dec237ddf91672251a05853dc97fe3ed27196814cb6e84f1e28954693475d382b6ec7ddb594613325d2c82a7dd9bb6a429ee0037cd8af2f129d871eef4da33966edecd011f0d271e527fb694430833bd7acc3b2944599ba3e13aae3a1213bf265dccd53123b8b285d9158d072699fc8c68d461550abe4794ff7397d1fc1adde7502be6e93399cc5ca0963d38be6923b033c6873b9ce8d05c0de899fb116ffd20822d8d956d1dcdc823f5b3682cb12491d462c1d98600f2b48ad02ba7090e2833c8b8f374229074d21f13b3d9c0923f78624e8fe2caa8ec57d7b321494d796f742e93c9e049cb416b05a17eeba52799113cb42274ea07fa7fb8405f5ea726eebcf15da0173c344f7f85da412589dd30c9a9b858e1cb3d36fdf3bbe988ff83ecbcaae06a40a7cde8225b5e02edd615a0c89126bead1380a4c8843ad313cb94b040dbda8a354dd11e2725584d500fb61adb7f785f253e153998838e5b87374f1c759e48da79f1d3e44c3c0c0ac3b13473abad9cfdf60f5b572387c7bebaa4a419d8a0cd26e73ec58ea92f80de3f9aca31f1faedf94d82b2b35f2520d4f6167c6e886f84620d79d7d8859f8562bff408f7fb3bea11c3ffdd8074748e10b22ed1bb5955daf6122c8daeafa5541364845f149c67ff83a0f8517fc6727b4c997d637c3c46bf80c76e9e8858ea041cbfee49fc135fe8ef082fab0dcb9c795f81add8e0d7386bb2cee496948b9c8bd22d3230d400b0beb119297097a73e41760df8ae3f22ab40d0402238833c5e12d90fecb1ce9c88c68f281baaef15cdadcdad4670ab0dec84b14adb9c0325fc63a05bc66fbff3bdf45a114f42c232ff53d8bfb3a474ce5c4f71841ee198336d4eeec82d52df5c4098f25bcc88f894a091cfc63203d3d50b5d456143467018da3795ee9d84508027a503550a813be30a3151bc1ca3768307d381e9184df8a3d00b20cedde0d82a728e2e714d1461deefa6acc067397ce836500289b57ac535aa19317dcf27c20460803ba777e55b8e29b9a678b67c6d6ef7abb82fdf976ef56eff535664dc28ec94b8b78193843be5ff58c2180b9559fb14749e9b7139d83fe2cf9fb375f134dc51e79831d932aefac40aeb83e006679952f95820882de19027172822cd6365be331fc7a54bfea837277410c0f81362518967dbafab318c820212ec5515b4e7354d15815c080a52f31553a5e9081bfc38ce19ef227fde8e05d042146b2dfe0bd4cfcf927b73cf3472ea8718d7d4c62753353ce24e64f7cb330257498a44260d92e64968e3d89a55c33a93dbe1df6220abbdf6f675febc8bba04e3145fb61ad6f766625535826681ae969635b55f12220339d5fb644dbd9ba8b00d0a4c28b58ccb7df5eec10b93472ed0fe31f1d22be4848ef8b0e70c636a19ff2770fe5e7ee691fbc44820b71cc826a5a4d3995015a26f31ce0d0e2512d29705ff15a1faf7d88c45c7d67c10f5d38672ac69c2442cdb602de3f8553b077c07e39a3fa09a4588667b766133b402da1a77bcaf6eb2df58cd9b445e9eb1537654aff9e8c882e2a1a3e5ed46efb782515c0500056c422994cf8f18edd8c4422944a7fe16c1a59c2e098cdd7afc965af691f582142470953c0fc2e3a9ff2b8c87e483d1c811ce3a92a20341e7c1ead94448cbd49121d96258c657add51d9bfbf10b28710ec4d263da0e1d9b3ae8f09c462b9868e08097be87853408245ebcb6ca11fd2a3a088a50b5583f6938268ac37bb295edc096048eb5631b6a6b40dff8cb7fc21b76839aba5b869689fb6bf0cc19957962ac2d494eb03")
	expectedPublicKeyAt0B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt0)))
	_, err = hex.Decode(expectedPublicKeyAt0B, expectedPublicKeyAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt0 := []byte("00b28c1f21529c9347460e8898cb6dac9467f010801fa59d744d757353a613c8")
	expectedWithdrawalCredentialsAt0B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt0)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt0B, expectedWithdrawalCredentialsAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}

	dRootAt0 := []byte("95fb59d72545fa8ac798882b9d5a781f81130bea58a103707a7a87aad4d087e3")
	dRootAt0B := make([]byte, hex.DecodedLen(len(dRootAt0)))
	_, err = hex.Decode(dRootAt0B, dRootAt0)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}

	sigAt0 := []byte("5b96edab19535cac217485b584fa9b2c4a20b4f9239d8ecc89c03f3d83fc713ddcd8ee1d7ade5ede810aa19518ccaa331f4425f27dbedaf2e6c005e4f986c8637be537f96e4f02d4c42cd56558d8e9bb754327ec8d9f1b606148368a8bb8a964bca958f20ca04e1243135d0cfa4cbc2745b2be78c4163d9487bb7d8750f0cfd53195df4e26ae06f640b7eff8548bf31941eaacb8ec2195080b85a1bbe4407eef6ca2a95d24cd68ad745eac2c688110414ba541237621d79b6037cfdbaa377890cf94a6561915d78b7431c75b06715ffc4edbd19f951dc044f2770c05ad94bfcdb6787d4a864ae505ce50c92dee75b6edd556b34b5906d7ecb8251a868fdd8bef6227902b593569a6867d75f33cc084c10a4a46606ceebb9f57a132d9a4b30ea443c3071ad43526ed9a4470ee37d22bde2a68a5c83ad04899fe0323e7dd53bbe9f3f82c57748f91f9462ac713dd0e9baa66cf60e7084fae78b0fdb13c2450c37a8096b1dd9e9e95edf01ee498df4773c3835bbf6500fdaab3de2e93783b5bc4613a1405a69594efeb0fadc10bc6a13dce8f462edced7e25494a2dfab49fca69f66f22e500b66cb6842f40e6961ea226a212b3d61b3e4f7b3438de736127459ec722e02737e04ec3e45ffea79df7b1367ba1444d9bee2fb9185b7a7fb694d2d56c98094fbc80437d067cceabbea4fc1d9c6c2b7bb1909df75110ec50c2323110ead9ec543191ab3efd4b815e2f5dc0c899e1c0158a98a26fe75ffed86e8dd31a913aa110083dc513e5a24dab16849975a4c389d52a81601a96642459a72b87c060a000f2e55c723564819fbd822994bc07b464f8c79cf0f10a9e989f47dc056455b56995034cac40702ade37ede4c47b33cba3c65e10be5d20a538833b964aaffc6438e761a4bf699ecc80b0b6124e51ba706bd83cb42f7b3688dd052d533d0f7e0421317600c07d94ed3479e141a0a780a9f3444e3d380736319756ccb95366da3411442248d494b4bb4ca41393a010c1efecde69e5d7c87eb638c6425f96ca13707c12c24a2c598a7208e5ee71d90fc622d477b43b85a2863fe2ff3301fb853b3456eb481893f468906ba6e734f13db790c452ec0fb8cd48adcd220b671592262d366915a6e2af20a1584750d3bda4d894e5389dde870e608f9add27dc5e68dea738215ab3630032e71b3814aea26cfc97c7d0df44e0aab36be5670568a167428201bbffab4a61abca1245e574343261b656e2cfb6d69b1de789051b7d731cda687ca8bdd8520c12b798231445ee61214d0375f2de2d059a15fc928c5ea8a83e0bc2f58b27102cb79c7135fbb0193dff9fa60baa04fb99f0adae1721b233aa1468a2dce6dca3cb80ca8626c7fc864d18ab3cd90fbdf991c46b21a286ebdddb700d32ab8b8e3b0b86809ddf0ec926ed23a3effdde29bf79cd1187946410083675a7cc2eb87837991bf56043401fd991f9f285e0f7fa3588d4bbea6e999902b8c193402a16bf342aaff212dfa3ff23dd9bbee2b699cc8612555f480088f5b381991299382f7851a31b2014dd0ae3b16bfa687ac3cde287aa3f64fbfbb414050b871dc76b31739b6b523f6eb025cff17243a1e9749c67b56d63ccb1162eb2d0482333541f5adc2c93319f0b38f78e0e13cb150220c07aa1b7ceedcdb893f70c8315551477d7590be6eaa5516b13b6f5f4a63859ea21d7f1fb418635ab41046a4da5af6f7bf694ea9392ca98b096164dbbaf43f414715027df3f32b59a6c5c17da277e93a772c547c21e22cbb93cadff70c4ea7e8a0838d2ac8a99e5b44e9761fa12ee517c8a22e3687c910345002056ced1406bbefa4a39c682e993e3d82236eb3be5dcd7ba8dc58f067ec0cdfebcadb1fdbf23318e64a555fc2e4297603e5e40a0592973de3fbfaffe86ab5fb4a06101387578778789d33fa79222f08d97f53387d95d26527ade5bf916ceef836012f8c38b5fa9d72d0a2bc3998e57f794852c638549c30160ea8d57806b0248815eb6f15271722476b182f75d1c4bb19b13700a969a2e0d95aa0f97269cae7d770dcc8172c756766ecfdb2b311caa68f2b74163be62c573e38e01d19cc5dd51feb01353654d1a7218383bcd88a047e1ba887d3ca213cd51406347f9cdb6726b3c262a68add56dc3d7b99714b7076aa8c77ee5695ce0142b7c59af3a108fe69ccdd34ed45990bf3181da3bce7e9f7dc0003edc6c49e1f8912fd874c8dd2b9126e2f9e4b53466fdd42063ad7a388d86253ed7908bf5196e56cb706c46b1aa6b0cf30bc362da9fb67efea1ddd6f33c9427dac338eb8a2c0b0295bec949581198be334c66a5c86e7ad8be271f4043033aab78ee455fc227975e4cdf61315d29e44608200d571683b013c78410c1bf908e55bde83580d9a97834062d68e089bee3cec5de99a5bfd1d1124481775032c39fbd1afdc33ae585a6299ed8e9ca8606ef7079175a12c1400c550368b7b5ce7bc19e76dd386574cc83644a235442c328e9a8f50844d7e23cedef52e2598c1cfe2339bb1658c1f80c99c947fc7a2da2ef0c8eabafe821b715bae61e6066f185df9b7c9f17232b8a06aa61a39ebddaf106127e92392138506238d7cd0580a63364ef94c7065d09211e8bca48bd11e9bb8daaaa1f7d5ebdef837ed64fff5b91d23e96c1fd1fd44233d5bc095b702c9332258eb0db9be42d9c2136ecc1131cbfa45cd98de5f43822e44027f3c1a40eb73070476b39a69b4896b6b80b102b321b0f97fc1feb563291f878e70455515c9b6edf2516baad29e4e71e2b81cfb174064c3a925d0ef4654a465f0ffd62ae27de2efc26a00bd4b093f735e0b0f7c82c2e1db2bc026bf88c488c7f2aed2d9c3fcf5635003f16be905dd311da3f66ee1626ca3ab9581920c1e2bf459d4d56210a361ba4b8e983163d005a7deb00628a8e446ceea712c5eae19bed9131e4390f0faec5b51a3e710b885b7fa6da351cd3dc80468ff975dd3316bf9053ec9e00b7372d391e0c6b9fdcbf04abf3d1a6bb146177db512c0a62708472f39946fee17f7424642f384b16672c62266d9c1c408072b07fe98d9689ba0ea86e42277dfb7b42748c51a5b0e5c5d55423811f86ee1df67ddc42b7a5057deb7a9c84ee3817b8b05bc4e936b8a7ca540bf4c31c5c7d815c24f0db76dd389f3111996dd557cef353c5893c95afa9767f7f5c52f5244c1111b902efcb13f209c088161fb380cfd9e087b6aefae386278bd149ad6d35b0a7eac76a1f28c4a5b95224645f85a537a7c3d167f39410bc6a74085a800f2d237110b1aae27582d896bd4fa7736c17e4a78ebe3b33c4bc4b00a0d01b99de1e5b92530969f6b8467f0f5441f4d2a558543c5b8cb79174f192d1ed162249370eff921897b77ac1933241b40f50e9172d317c716c00af0f3d1369f11bb13ef9bef256b7debff8231c69e096df35a3bc225c5efb9d6e013ef10672c65c0b5d9a0446d2d030fc2ede50d1335d3c14740de0b1c3d343584d06480f38e357b09f03d6147711c78714db8b6721821d711d1366b9e47d31396378918341198faa446fb4bb082431a8cce10232707f72c897536bccc95bd3b0c9706b29271a701ee939e0c1e8eb3494852170dabd3b3e2cf3b2a6ea92fb32e6144eea9d71f4595053a3fa2d87aed98917f29f4ccee3da6b810c5c5fe66dabe9cba6a96b55d68f097773f4286183651407443c5415857a4acf4e7c91a2309cecd80cb298a7255d006d42f06d4df4ba08d795fdd7e818167dce6c37f4a80b75e5a30e11c2eadd21a5e2ced18c848a92d71311f2291cee003d19f7c9684ab6bc37b497a84c76820f90185696564e7cc83846705e53462b73b94c68eaeb7ad88dc11db4f80113280f125abe356f43563602cafd2d6c0b27546422e2860961df330ef25b7f689881835e45a35c945a0dba44be096402de2f9ada758d521ccc91dee66e2d51bed92a3609255ec4ae0444ddf6150a50b4f4d0e05fcc3d9e5e1d032b58fd13ae751fa2edc1e8d6d1792075d4607d7fd626b7caf685e40318dfc95c8d095c26886d369f6785c448d72264a846e1bdea0bfd92cecf437c7338bc2b9175d1f12252ee0e89b828d2005317081b7a56b14f6ad5eea46e01fc59c37691bab3789ac40a56f519cb48591c67624f35e1383b3e09783d78049acdf61f8b13965825ddccbde7f58cdb6efaec320fc56c106dc18fe1fa33f651e08e3bfc7ef418747839221c8578afa3f334f29902e5a7a23f67c255cd579e818f71d2be85edb261fec27d8d4e344c6d289b14ebc3e5583a63bffccf32f1caf195e6d953f4b2202954707b2f9720951a51d88a64eff2afbe9ab601c18669de52e9831292e67199f1a214cff44901eb64083343192af28a07d60aa143b412b8416181c5a5ebf67c23122c55a7a8b5a1ced8fa4c0a85d21ad52e0936c5917694bc4350d2297d99c87cbd16cd2f57dbb96a2278d0e503327d6f14db5071402f72089f45848df1f2f56749e423ccf0315761c1c0dcc841a9dc2416faa522751fa50910fb17e2d2d63ab861a3e792c35cf935d7f1522f873a911cbad404d04ff72c5cea1c2a8043792027f4ec3464b344f6eb402865975d064c34f4fa55d671c83d7d1d75233bc7bdb8cf6efb05d783c7b950914fdb341e027a04c40e9ef9bed3b815379ed2bda539899a82606abd18a757906da0d8c81c9c008949423aae1ad8821cc01072ef406e770448fb42808aa8e4e175eee37ffcf87807cbed133d15f12bf67f28a41c0b547737d0c56f05cbfb6f79f4623aa4046a1d199cd8f234d90866159aec619958594485ab86c2ce2763294be5835d273ec9d52f1eb092642cd52b5015356bed365b4da74ead468d4d51356ebb48d5cb85f464af3682a6f5c130782c50939fd4df74a47c7d00196b065d8fb940a98960704b8b612cf595f7aace92a8752820845f7022978b655b4d528fe32c2f0c99df146a2df594a48e305a8b17919a266442fb87194cb39fb88f7d65cafdbb6c1c79a3b29f3824756deadf78d0621ff81b7ed69b9678615df935dd10f09b71e5c768e3ee600a69e8c25749ed2b9a037d08edc0c2087d6d1fde927b09101b9c41745b5574c60f45d12793d510327ddfcc1b3276c50ae683e11a15ceb5c9b775fc627e36fa25c36972f11d0d42bb43dbf9ee6a868121826bcf4014248a55f33fb462347f6841a0020d5140d8d94fd302014befd532ee8fa01f1b5e7e52d8abc93628f8da68b7f5ba2f496d7617c124087e0fa452c8a3a60700001941febbb0e57838bcfa9610b5389540f057b451cbb76c47d6841a50fa6866c73c2265de218a0668a54678df33e1cc307aa7d897670325f2718a0cc983cfafdc8fe558a193db240bef09486171f9a7fe0ce344e61b1a2ada251b02a25a2aeb54f743e30e608a9c75811fd27626fc4d8e1bf96fa5aa6c74c638c911ffb7695db3a775bf8bb1eed5ebb61d86f00cea17d7269d81e1277ab481d2f86ce4fc357d4841c6ecedf43a46d5021eeb7b07b07b7f1f9de7cb2d206e0838786e53a9026f8d92319695ab21244ab69d5420306834879ea7e9f5d698b3bb6b621ddc667ca6caec57a7e5ead775f9544158347c8bcbc1301a6994eea494023830080c5cea0bdb4aeb7763a3824e8cc141d0c19d5fc39f95124e978a7f938a8e29a95992e1308e9b839a0e853442ad45108de58b9129af11971ec9eb24dac31ccfde31de9dd19b7502b47a9561a75c5b0429bc59f0107eac0ffdf52fd03fe3d09db6ba45a01d1a6a0732eef6dcb28c79d4caf49d854efeb113812f7b08dce2732acfc902a22220864bd5af4f04d9278603176b2b866c85b1553cac28eb1580640a5b1ee81eca25d68c44a75614aed35ef8bfd4229fbf911250bfc6dd0abe864ac31004b25ae66f5d54db7f5a9d3e0bdab11a3a9f20b8add3e581d90f62b3579c0710df7a7d5c1e14208e434275c74cddd682e60e796afc2bff61a6b3048345a841d8e2f87ad74902df3d476cdd16a7095ae2b136f59db8931d75ec927d9aa7d9e7a5d19bef51f8cda712953585071ab47535723db6bb0862a1c3f311a0db1520328ef16123396f6222a44dffece89fc112d5fc7ee9ec7217f5d53bc74742862d345341669064026c5c297c2cb16baeccf886da8344738c724511445bc0e96464b2f8f9d8c51718fbe96fa730cb135f8dd03a59a18f93dc68c012f39621467b98a039144d9a9f63e799ede1394c98f7b0409f87b02e6342d1b65a24d62b6344f4a8131d1f2d1932f54433fff769b02f203b26395be3c7c1343cdb2e6e96cbd6a51621c781ba6d93f8a6f1f39680acbb3681b25ef8ec6cabe21b620d86cb740b65446172edc2384de7c359216972edf87fec92c04c5a008bbe4de446d4e86e036296c3dbc6297cec00a2bd72072b1dac3671b2caa9ac90daffc0c8794a598ea8db00588fe5f30518434a5468a2a5f011669394b2fe131426505e61c0c3d6ee234e8f9b373b488aff0eaaadb0cbd6f6000000000000000000000000000000000000000000000000000409121822262b32")
	sigAt0B := make([]byte, hex.DecodedLen(len(sigAt0)))
	_, err = hex.Decode(sigAt0B, sigAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}

	entries = 1024
	resetCache()
	deposits, privKeys, err = DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, depositDataRoots, err = DeterministicDepositTrie(len(deposits))
	require.NoError(t, err)
	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	if len(privKeys) != entries {
		t.Fatalf("incorrect number of private keys returned, wanted %d but received %d", entries, len(privKeys))
	}
	// Ensure 0  has not changed
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}
	expectedPublicKeyAt1023 := []byte("d7d9cc6f6f93a535bdb3b18c2daafe7449b4f8766da05044a1af735983aed8d7023d15a7d9b279e62ce2d4f1ef021f986fded4a718fd6043e0a5f60253f3e196913b5090329d2867b49473ff3c52dd22c55f481e763a27ad4b1431dc116a871ef36119295c6171a38583817a5ee246a29f730d76b68be9b6a3cded4fb1104c4ca5d4620d63e4dada42be5e027bf1d73af19ca6bed0df3057bb9ed15f072ff61e391bc43d89692450b3ffba273dbe7aac1b6fb85405344fa9763dddb02d0a46d559e2df47032bc90b797531e56364b4ce6d6712dd6bd92854614053a98342efed93178b05132370924f17049034c079074330326c5f4378a052aa3e96200eb55582e923821d32fa8ac67fc59c0b51f30d9748907e661b0f066085cabecbf4ed09699b3c7879306f82dc23bc8fa6d065e5c9efb6bfc812259ef6750fb3bcf1888c4b1e44fd5ad4e3fa62cc0ded3d1415b71e2b5bf79a5f4cd2d4ae2981112b0499de2e9bcb3591a973dd79a5b1ff5727cc0e1e57d7cd93775f4424231949c50106f9cb49a2200ef71378dbb5932d4be211738f8138c49f1ff0f716e3ee9c7c54ae9248cdd7c6522072553b3af391a331492ee3471afe566a58f84d906eab10a5ec5d28b2c2ca5d7f26a861b41d15976417d11340559bd1e56d527a02bd0eca42a8d8417878ddb63cd06b554f897518d2b7bafd51dde9d724f76cb338d59b3e077dc2092efd4494ef566f9530fde5b04ddc497acea8efacbee290c2228c270f8bd27cc2e4c17b59ae731d268ec67593723867f9032c7a0bc184dbad9b7ca2e5db80d2bf1898401d6fcc63904f50e50041d9a23ef760137106f6e150f8a12cc860d8a141d5c74bb21c2e0ce5770b4fb8f2fc85bb5521114b3fd24720775e1c880f96a4c9a941b6d136b4bb2d48af64104191641a67360c67fc9b666922043625c0f508ca5458bc63f847da906a89ebd4766a6fea12a985407dd61b94ea586e3ff924a2969546ebd0a052ad61d8db0a2532fda08e6b922371b1c56ce2eedf95d14fbbe68a5b3ae2c24d03352143a27ac53cc4d8fd7bb4eb4e2fb7094f2cdc996dc9c95fe38d1fec36490a6370ec7b5d7e2b5dfae30ebf0e91b6a0f328b811102dbeadf3ea43a09747d943974b4d7b980e262fccff275d6b46edf124269b6abe4d300a7cd50ac1f1a7a1bfd6a10434d56649d67b3cefea9ac826c11da4297e935074432bab3794bc6d7076d5a7c37014b6bac95daa59750babc1b1691e04dc78fb02e402dd3d2f54a1808886358aa9d8c1044a05d94d6fcd5d7693a478c77ef33ac98539e2fd78f98822d7220dd3e2356866d5493bc0fbad97e4edb94bf48f57951b15509c7947e95bd50ebbf9633f3707e6a1e41189a5175a5f23319c9112909ee78ef9ee12c06a6bd7cd2fd014fec6c701829db916367c2534866bf2b06999e377c75de39b528de0c99e374fd41868da53d2f8a2d49905bbcf74c8f099781894df4c7830679e0eae560c38d67679c206bd50aea6565c23b6793e7c7ba1732b055560f8238371ef3aabf503602fb29255b1c03b292859b6c6221faf2d26eeb28781e9904c64da76c9a0f31c7641eb10224bc8bfad7aa4929011c9021ce9d2220fa5213ebf4525cc6d3e6701d89375b5937355a76c6808284614322c76442aad7706a7563d79b32c3f63d274bf78a090b648665517ee53957415334d92e0213f27ce56fed5931e842d547fd31f030c54c1cfd7ea29d034fb74a9c347168406d86c4811ae8310618e3d3a943d0572b0e3a0aa5e7e83d28803086075c539aee838715a6c04d1ece3c711d981445aa64b389edc01a76ca2519bd9dd3e3bfc6596550ff49425a9938f6767788207afde2ff979448dae2f8b6a4ab1c2cc216a187a35c14766841917cd9fc032322b2c5cf2ee0e77bc76368f2c3c21a0b09557e1d3f2e67862f4a820314aecd05886589a48680b5af2e62fb4cbc963e8e111ac3f0443bb4cc27124dd8f9cb2bfff27ce5446d8dbf83e592b5cb90f452fd8feab733d54c0f2bbb91d97b0bb82e7506661b90be6aaba3ed8e2b4fe046877903b5eb3c685c7a9a6c987b631e0290362525829df54fdf01a20b99483ce0e0175907bf16b1b0f0436fac3890a383e1c4bc70c7aaea2cb2b1605c8edd49c9bda5cf38592eafeda5a5a8a623dd74cb1e05a9d305ebecf41f81127de98ddef0bcff6af27f053eb07fca593d513679cecd62daf19701075137208ac8da1fa001e87a40777b787a30fb2d8c7e097c1aeb593bd70fee895aa8769a6430695b929acf2f079d05e42d5c183d49f346f120d63429920352d8a844d34e7d045419389995e530eaffbbef107fe2f334cf7a2ef055d603ee30bb651ce635e00b7f6502b3cccb7caa5d139b2a21d740d5f22b68375b11f21785efcef340d30dea2b81a1520dd1b453b6e48eb84a6df60ecd2848acabb33f15efa01b2f340e18dfa4c685fe9593ba6accc56b373dc1ffe3462e135dfe2e05c8f0e9b0a9274607de493a5c796528f76ec6c7d19a064a6fbd0e851a35720aa7b7f298f89d0723a3172517a537235c3209a09bb496cf6985dca357c4956cb777f8a41a4a271313b081076c40d47be452b9ce3ab968568b2f6f2bb7cbbeee4c448b0733c4f147e2ef4bce0054e84b3664d810b966f9e47d365cbc45cd6ed76732cdd9c735b2c9fb2e4c83a6bcd234eef54178bb50119f9df15ce0ef12b47db9da98c97430d3437a23c847929619a4f2e9d450dec4672328206abf5cd0a6fd2086610babd2e133e845b819b11c896f89fa0ad55913259ee778e3461abe010bc0215c06c09f330a4de022efa3ce6fa40f46fb3b4da4bd6bc08a76386f3cf1c1c79ba282326eb08fc62943358dd215ee3245b4d96ecdfb883a49e30052854de7c5f68c56faa1aad3ecbc6d891662d181930f74152dd66d691a4e5df829f952ab3c9ed99f4e045bbbbc73cc78f7f516dd7343f8a4755901ec20315764dc52de88f91143827f85b72ff2dd9ab3a19eba81381b53c6881e201ae324acf0d14fc6877da88c7c1ff9d931a459d6af0af43edf4e693e0462d5e66c08e9100deeaf88143d7a987ec3be1b2f17e3c4d2f2a6e4dd98e24859ba46b363cef8aac8629d5decc2f162971b9ef9dc4a4511b0fcd26ff8b383eea630d1ca75830d9973301015de99b82a372b747354dc975e010c9eb69bc8939fbf43ad59ed5065ea85582102aecca7b9c2b3011e71b3618902133858c69e3393067d1d4d8aee62ddb39c5d84107528b21853c72fe7cc48c189dbeddb4d355328209800a39f94f97fa2e6ac607e85450c2ba3aad8665f18e9e3f24855d0d6f8577d7b46b291316913299a2c219c8ef9eb05f1b3622d73fae3232cb8b7f795e76b8201632e1aa50c2da06474228e3654a07d4ae39ed12293271589ded65f668f94a44d52cf8716cf2e6988d1ed6ddec46457d38234ae5b3a863658d7305aee0818f10cc39e1f1c6ffe5c669f2e875bbace3f96f07d8ad6036512d2f308c8511952233ff7d7c8a32d611e800d1f78064635af0e0de0b11e24a6e5b8a442857b6f3199ec80d266d2d50814780d621acbd3143cd26b2ab26c23ce1015cc5c2bffc0b8d72b180834cffcecb5e2a2f9892a5dd5596572f72f9d9fb962fe8a324948f4ec21bc5234afcfe")
	expectedPublicKeyAt1023B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt1023)))
	_, err = hex.Decode(expectedPublicKeyAt1023B, expectedPublicKeyAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.PublicKey, expectedPublicKeyAt1023B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt1023B, deposits[1023].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt1023 := []byte("0038906e54ed9aa3a4c5e0adafdafe7d203d4c8fb215c1b395aae866dbf2f04a")
	expectedWithdrawalCredentialsAt1023B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt1023)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt1023B, expectedWithdrawalCredentialsAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt1023B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt1023B, deposits[1023].Data.WithdrawalCredentials)
	}
	dRootAt1023 := []byte("78c8e02dc81bf9c0b2b068a7271b4c488c54f7080ebc474cd9a1441c4968e322")
	dRootAt1023B := make([]byte, hex.DecodedLen(len(dRootAt1023)))
	_, err = hex.Decode(dRootAt1023B, dRootAt1023)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[1023][:], dRootAt1023B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt1023B, depositDataRoots[1023])
	}
	sigAt1023 := []byte("4f9901c96d837cc7aa124f56d328bd2676dc664d9f12d8a8b89ed8332b219269691fa5af7d16f0819f7e229e9bed79b78ad7acf77c953daa3f28b305964b5bb94826761e4c05170c60e8583ca175c411b2c8ac950609df8516a6c461f557a52cf898014df072c964968ce29fe3a5bd0642763b868ca03b182ccc21afda152f44dd61dc5c54a25f984fcc8edbdcd24af8cd95a02602b678c37b5279bba7edb1914212044e17f9df7c195143d92b62755778ae7c9dcf60d34c0f94d4b9b8f99fafb95e6d2b6a5cfc5b54d67aa09d2e60165f67092dde222813a3fee2c020144e9fbb40ee74268dfe8bcaad516f13dc82ff67fc6a42794a3dc7e730716ea50446e4badafadaad4906b8967461bb56e8ac7e3292cd62b3d0687098c74cd78da1b4dab425e3a7abf0a0fca3f0d32c58c964c837030b6ae32d710cd157cdf24125a0ba2ddc4a4d71b43b3f349a4685dabd2d1fb1b29021c780f87a90a9cedecc7cc8065d89f14e509b4100a4c9fb47b0e8a28cbe2d46cf1f87f3f28155ec0e9b43a9d2a019240aaa20a48c318b58a3a6e97bc4db18efe2086626c7bbdd28f3be2b7eb3f2d33d93df61ef5d1540a35d364df02c6b3f56acad75102c85b8281215267f100d94edad7c4f2b4c730b5749c69df1e521e921c9f44d344c18fd0290bc823db998b3ff9e3c8b1160aae0204c0a3a83c462baccdfe3c031e5d21b92c112d3130a969b9d778dc7a9eca79106dd20dfd14bf2fd48bdad0227e5e34db775087cc4da4fb8891dff0e26662f8d93a9ec764b46bba7d4e0c4fe970877c2da3a0f64ccf20657b576bb928488d38a78a8c06f2aaf94719a61c661f60018f03ca3d2151605550138ca93084d1c17ee9993f553485dc8cee92cb2633195f90e465dde910c03e23fae84e8db5f68e27151c76cd5c1c0df2f5983e66423b9a8f409c25e68c137083455eac4214cdbc62014d394408ad19128a67f43c3b1aacc318e05df5053e7ba07e4b47bf91e826da7b0d07d55d6ecc5584e34bb98c41b481e3173b048e894629f85434b322c0ad14eea984a01d30e5e3af7383de1fff298eab02fd72bb74253b95bfa71dae61ebb5f2691e6e54b6106c2a6c02c097d557cf07f7d965b832c292e122ed4ae5f07d6e2b9b5c554dd097e984e6650358ffe3e1c8aa4eefdac1554efaf3b0bb489f0961c4d5fe45423bced9c78fe3a469166dc92abceb33ed68f3b6849dece0700d2889d83c5d1706ccf7ce1c4a68e5d649191cf15350d600c2f7cdf74bc6bd33b8566c7f1dcfae5e151c27a014338d01812f6c844eeb86c85df455787b22b9c2c8ce672acb8a336a3e76df161d0b50bc24d0a39bf25606330d058c7692c594e57476947f219e79681cc2fa41b24f416a9168c2280ae17e81fe2453cce3c491153120dddbaa1a040348e713dd7173e14c833179b32c7f8ff3be92fe438c0a325720983b7c35f51f7bc78feb1bd5a1a411006ea2a03135dd4af3347a5c4e43a4e15043dccad0ff076714fb0e68b039a5b9cec0d35b64caf00fc03432807252cdba89094f224a5a447dbb2e074f1213a84440744dd2546dbe062946d3e31733cfd3ea49252e7a6805afbcee0e046549ef605d20d11090083b3dad871b31627a7faef132dab97ecd60f1a4c67f407c4776ba4ff95c78f50ad848dcd8d96c77e5e7b16c6e87f0abe70b5fa876720eb848db8a00c0e21c9ed89a6b94457ca74b67b13eeeb28d66f6ff03ad83d7fa77531cced906b20bb69c87b49ef913d2c60c4bf3f9040f3735f0bd25b8458e3a5331d53d1860299d3e918d1bac2fc3cd39a19ac22205af16705f0af1f8bcca6d9da9e6f873273729451718bf61204629398c6c3b1e76b2919ddb36159c1cb7ab9e1585ed6e6634d052ae220ae27a67373d010197dbf01711ad7239f5f54cea91f9a626a2ea4fbd4c50eb6225ade512eb1094e3e72ec637a8ec45f68ec5be5ad958669f82aa335529e517e0a23dd5e8868c4b13ca9e081cd302263f7af4f3f09b2a26d9ef88a86fce9690f2f99c29388ec3a37efac4096dbd64fcb35473f9b8cdfab68d5ffe3b7dec2a3c23f7e731aa9147682af4f1a6f19e6b05f89e481bf39bda313e1a51468f6d837f69b89da96384df49913aa544aa76c0ae8e7b68fe7a80539a5a6d919c91daf9c384789b371fa7d69e4e79f1d5239e237ecf29953a8205b2c4e574efdfd3c98a8e10457e21738196a42474da2d1f2b6cc7450106b12edc078e6458cc34d6ee49dcc773b11c1261290a7f0e108fe4d1c67e7c1f81c7e315fa6c84db0fd7574850c44746fddf9f638dc367f6b99672addf83536940390b8fb316d52c0a8c5a95431b38c6a6b0915e37daf23e9345a1b462e94fb289d524e75a78d9558635b9d9d14cfce84986091c804064bc1f4bcb14e243f5af4be6cbe8541c87a6d48bfe7ca70180aa945110198030a79335c8ab421470101b3f012d247d6f44c471ac326ffb9d3732be3b338f30e9512fdd29205a10a51027d8cee354455387d46d2af6c691b3a35c93b2817d19981ff78d0cfecb45e4896d145798471cac2dcc2688aa9c71644b156363b531141909206f71f7abd484eef8123cbf7af3b0d956d51ebb77a25ca7471b76392fe4820eb120ee67f95cbf65f320df349ac658a6b799c9b41b6fab90b96a771fbc48c39d4e2694c7f92849077b9e5eb613fafdea996b05f7f8ccd6c3ee158fb2b56ce82f60960a3fe087d119ca55b4584a3a716ad94001ce6843f9b30e4c22f18ab17f7319ca5596bdbee2753c080c656ac8828a2a768d33f1f025d4df1d6f5cea7607e03d57365e992be28aa5329e689abc8b792ab129583368efb13f4fdddefb2e5c0751ee3562deba544e603ea6b9134ec2e12c61806243457656ebe414cbd95d707f6a21c80c1d3b76efc340f7700148c4e6fa4b788588229779a251e49b65d721146e81781a468b27f5334b793374b721e6ec2d8657670c458e6df22c1ab39a1f8de452b03ef2989b8c8590377c7c38cd54705151c5ea52b84550db635f7992a94a66c87d766ef4eecf20b8559e0b6f1e7899aa5cf0a20fc9a31eb910045169d6152ffdb8228472d7fe20f99e9e2ce222811d1a6dec7940a68b9e2444fb85718e8d37c00a014b4959911a7333675a2649c96ab0b790ad409a4b1b1192443fa62926fc1f4c19b80ccfdf804f0c76de3d40389791aad152a9c6b6a1e82702a33303714a5260e067cfaaef40c3054e1ef75f2ccc09692e7d6fd3899e47def5cdf0a3f7ac2fa0da65e7babe4fae3c000ce54c2ab47fe82fbcb5125fe087c36732d015e65ea0e319f682645423a8ba5e8a10880569f2a667d0b4830fe7dcf8968769b14cb4e8e031164d9052917b1da1d0abecb5c41c91c45dbb373a8626f91cebd6c92d79ec74187383ec0018286ec29e325efc2e63e749c9adaf4df3212f85c212a6a2fa8798ca2b8785594317208d546087aad69278e1dd6f1972e10324dd40a2153fe0950fc7bb1a1f3bafcec2d904c1a54f03f86959512722d78986eaa953f5f7e23c975e90d5505d2eba1af0bc93d8a14efb19e1b70d5fe432616e93acebadd4ae7ddcfadaebe2ef53acd6ced9c479b17dcd6b0539965ae0673fcde141f6296c23cce946151466422b116275bf7b1b67e63913878c5744a04d36d813b818863cb03d9474f9f9c4fe0a00f3cbb87273ebd410268b7f2ee3fae73c944567a56c1d46115a998f00316a29f657eaa355135eacaa83ce060383b98431fd5be8428357139f59d8fb3725b731f2778742b48910b675071963a67db72f05f28fa556443bf451343e67b7f715cfb6dd6ec3a7ac72b56684775634b9296fecc92890c750228789e86626a1c84c5ba7d63bbb627fc3e698566a653d05a987b03b6b17a5725e77afa00fab411028437542c2807b664036f059727a86d820c47515134349f407c7a65bf29d05952795669c46344bc8762570887c15dbe643b849fc60a402a5d7feae7a4433ec9b3407e514a46b2dbe29cd4d77c67320b98fddaea6e12ca912b0fc5eba1e0e2506dca11a27fc1dc1f53ca1e86a3d6148293893f8cec9c9e35c63099acfe6cbe4b2f6e0ee4556071ea8bff769df79cce87ce38227998bd5c5afe41698644969c5a5345825c66426734f3ed9a6fd2932e0ccd4a24dbceb68f208db6eec182cab8314e1376e1bfc6dcfd86bd8f1a793c56f521f232f1c888090d587c7eebce19b8f02308bd1af89b867a56b65789cecf7583db59b441e119c5d4a793e3f57e4f83f1a85093aa2721edd74489dcd88487de25d3a418f5809ad03835ae21d39d5f44ea0784dc4549c6d564ddc2ad2d5eb76c09b9db543a3fc5bb46e3f7dcdc7c95627271e6e23d6ea9f63428395f8a9fc147537f2add8a92aca7d41188db3484c847077ffc21e153a4581981b5bd36e51a846e044c55c0c15b6b459c21afd13b62c208a2cc40c834bed494b616f5466a25436d53c3191546773247d5e6da5a19610ef9e80d7d6ef3f626a6ffa72f70096f55c21bcb1616d2fb442b32fe6ba528de1858ee55250fed744e282c1a8b795875eeaeda87f379d2a75a075e4ffbd5265ab01e6069405390eb231631c1a4ebfbe5292792c4f92656a0de755a7f33105116303b3caaf2e8ab0dbe5f9f51115f45d50b5c7fefd7a8e09b748f3f28e6f2ceb7997b1b2dada1a20ec030e7dd70873fc53da62a474364cfbd547b8783485ad67d5f89783bd4df377e8643ba6d6452a040824d5d298e877b86a1795a7a6d10cb5d27009c1121e52afeb971733e887068ea941d8f29e11953888987fbe9a72efd3bcf0b3c8cca8fbca771ff936a2bb6a98d2e103fa8e15b9b62a9360f91ce29b5bef600be27fc1ca7df3c62a78b90fa9e58e0c7058ab0b36df593e08d41de19859a05fac25a2a4477204f8c28ff1f8c1250b5a7ac3a5ed757a3fdd05d0ac98eee77e2f13366ad982caf28ec48d237e6f30369092380db53b5e57fb859394db7d6d6669af7b2361492b4f7e5d26a948a565f380d872e911a596627264c73b93a7be244447cd3195a7ab3bceb1bf404d9e06d29be101ec6adcdaf7bd6e8fa4b1fb36183488545a6786fc93c4720a59a076b30ab8c599964038847469fa467ec2bef0d15ce0a0dca25d2c55b2235ce3fcd4597f970f3ba3c0ecd194f7f29ed807f8e872321e2c2cab13878a5eb0daa77096d25e151c80b10f845b81a9dc2c48aad89952139eb04b6517d7fa92d8bc2c842642023273d1513cb02a35f0fe541d7c92285694833c3b81ddacb76d83b005e628ec295e89b2a4b3608be3ef2006de31f49dc2fca0547baf94aeb95136402a2083c91453617b99a70e29c0b3f8292fa16a74f99ff929a9f889a1495728de4621046dd583c8bf25db48f97133a0ef122b4386d2bae125777743ec32b5eb8a541bf6756afb038c30dfcc09e24d7003fe6202ce021efbbea44875977544743db6f33d0a4418ea72562b5f664884721e7d2465f41adba9b350ca64fad0b514833053d18dfce76c14123359933b527d7341d0abeec9bde4630f3f25b5539d389649af99848aa066a79cab789ebdee4dbd8bb97f003ca2cd04a7e7fe86ea1b465b0dc6f2860d29c7972a26cec3077988025d4f9e19a44d338d9915407e1ce84311d6654c9c31d42f02bc32c92034237b5920081cb52ed51f33f2cc216d3e3ece209f7212d6d1f072c472f3e5550adaf6652bd17833ae5c1a8c430780341b0f22a23d0ab27b920849cb2fb98e896efaac62a193905113618a6052543f924466be83504eddbdd011280992b1e53c3d82bc21e2b899c481a704f9f3cf5b6d5f3b9718e7fb4772ae65bbbcabc11d9ab71ce6a35f19cf908b3abf79d4d9de86ac720bbcfc7c26de9285e6ec6793e0ce689516b3e65fa511567f45122b3d2bb70757274619904cd28f9b7db9e347d61fe94ad0107fc8b55e0bbdbca48c66e773e5c7f88e8a9afac9e86ae1ce7d8f3607c7c95310380823d1bc84baa51c5d9600459e04b82bf48e1c5ee7cd046a8f404096fbca69a2839861b9bd40a2da4aeab7c3c12d1ddde88263e1d20dcbab618eb6eb625add238e778db8baf66d24e8a800d5ab835ce73443c80ab723f4a636bef4f1fea5c2b2f09bda87cfba8eef17061a31c4b43cffbb49939c393e5d696c527cb5b0b6e84c5deb10227bcf5b71d7797153caed1a1c08f453d5c71a3fe436daf7ffabda1767614469a609b8a844be47484226620a160fc8fead6b052d82ede997adfb268eb79c072f696610726e95d6e5510a0bf2afe61c7d5100cd4bdba177b83887ee96e5ca66bd64ece5f78d4af570672e94b57f8609df1390f878513ddd7b1cfbd667aa21cbc2d53f134a64fcbbd0ff9021ba063f0a013d2654692be01e483e5799a9e9f30720c344ffd9a74fbd2d028067bf98a72b6fcacbf07e489b16b8e45607f81bf273a6394ced5e2fc1619617415262c9596a0aeb8d6ea0d515a8384a6a8bc06071b2b96aebed60d24313c43c1e3e5f22a42d3d8f0fd0000000000000000000000000000000000050d111b232b343a")
	sigAt1023B := make([]byte, hex.DecodedLen(len(sigAt1023)))
	_, err = hex.Decode(sigAt1023B, sigAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.Signature, sigAt1023B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt1023B, deposits[1023].Data.Signature)
	}
}

func TestDepositsWithBalance_MatchesDeterministic(t *testing.T) {
	entries := 64
	resetCache()
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	determDeposits, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, determDepositDataRoots, err := DeterministicDepositTrie(entries)
	require.NoError(t, err)

	for i := 0; i < entries; i++ {
		if !proto.Equal(deposits[i], determDeposits[i]) {
			t.Errorf("Expected deposit %d to match", i)
		}
		if !bytes.Equal(depositDataRoots[i][:], determDepositDataRoots[i][:]) {
			t.Errorf("Expected deposit root %d to match", i)
		}
	}
}

func TestDepositsWithBalance_MatchesDeterministic_Cached(t *testing.T) {
	entries := 32
	resetCache()
	// Cache half of the deposit cache.
	_, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, _, err = DeterministicDepositTrie(entries)
	require.NoError(t, err)

	// Generate balanced deposits with half cache.
	entries = 64
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	// Get 64 standard deposits.
	determDeposits, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, determDepositDataRoots, err := DeterministicDepositTrie(entries)
	require.NoError(t, err)

	for i := 0; i < entries; i++ {
		if !proto.Equal(deposits[i], determDeposits[i]) {
			t.Errorf("Expected deposit %d to match", i)
		}
		if !bytes.Equal(depositDataRoots[i][:], determDepositDataRoots[i][:]) {
			t.Errorf("Expected deposit root %d to match", i)
		}
	}
}

func TestSetupInitialDeposits_1024Entries_PartialDeposits(t *testing.T) {
	entries := 1
	resetCache()
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance / 2
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	expectedPublicKeyAt0 := []byte("2e3bcd95f5e30d0b7c5577b66c6373c567a6151ea39a75e477fb9b979276efac8952fcab3b1e671c1903063c08de679ae4fdda1e3f2cf675364a0f9fa5cebb7a6d69dfd6fd5b060dce52f19c3d95337ed388b53ea8d9340860cdfe449187d617e072979f84d7c9bc1a7169706b6fbe01e51c6c8117be3d61e79c046827d095a6f88d4c452da251910d34c7e77e773d667db344535b71998d33920d21d03f16c8b60d27448d24dbe239771bb312be22ef881e919a8bb2cf63108d6122f1ccdd3dce3ccc39a4bf06bfc8acdfeac9261cb061b64e1210dbd70d1da94145fb46e114fd61111c7e28f96a8023b4b3d2b705e347d9d5f629e0c64a533eaf0a84095ccb609196b768d1212db3d957fbf5df67fc8a14c72fba9659ae677647c24dd9d121094ac1cac39f14fbbe5e8624808f004e970b3530c5118cfbb1f041308eba8c8a5bec6ac20805790eb793c21eed3908c0ee74075ebe0f8367d46341f548326a9dfe96dc237a7e103010c5810472d071dc86a3f12936e8f3181eb8de498719acafe20cd59f8291b0313fa70f9843fa65a49712e92516accbb9d2c30c341b5341d618db57299937b7bbd7d51ee9b5e1329cfd725988ad4d8f01389497bfcfe904bbebfd69e9adaf1afa15136f2fe355d4e54aa4c21a4c41bf1a9172535504058d7aaceb9776f16e5c209204b755de6a978cc9952d4bf45b24718cab949e198fef31bc14a09f8474ee0037b758bfb952f5bf0a5f2231c02dcded4c85600a447b80ffd39d6a07c9dedd7efdd45b9c855d9a9b6a88f1f14f405a7608c1f64cd815df316a3ad8442b75df79aade1a9156eb917ad18251406a277cf38f9870a7902b4422931d73406f87e0802e96965773935d2639a649863198d83946425c40a84413d2b1bca109573dc6298584b8c589373be2ca7732478b220b1a214182f96a26c5a1b45dda66d2385346301d167d30202b4fa6167cfb87ecf0377d33a7cac6f38b29ff384481c4531e47a94197334e8ff9f77eb868813f9d5ba5249d9006a2317397cafdd206375d9654eceff93115a530e84ae55a7a25d02d44d737f42da58486c7dc3e92f3312ca80dfe2a9e87a52c6cfd852fb23767a9e551455ce7f2629855cc28c56e83cd6f2e1d4e3f05058b6a748fcdce270decc01149d96a9ab1f4f8ac1c72742f4fb0f602144e018697134d9ed2a5771bba1a8702ce94fc1732299080616348bb6eeaf7ed985e881f0a2a407b22e3a8426d4a4e2ceb257d4e635cb12c1706edc0fc77043652f3ccf3afa7d2b97c3b60bd0078d7220de39fd1e822e37c6827b870d1ce431015b03b1c8e2e88283bd8d7c6ca88673f7141d88c702d4f2bb35aa8f953249f429d7f80a67ed4352d5b2b79694f545f89d23e7e4a96c98647236c55bfe2d02f1fcfa254f9089baef4a5c8b9ecf5936cd6102500d67993ed92143dfca9c60caf49b25096c79bb9661839032507f99e8770702fa74babffe16da6b4c66fdf47e9fa03321ec973582dc4492c3025254037f55bfd47bed448105445ff7d9f0b2fbb84d798151c6d1255982dceda6abe534c1a487b9f0a2669faddce68840651c57daa54664e2dc11084867d98687a17758ddacbf0b2088e46f1c87deda65a904020c187e26fb22053aaa4daea57caaf9df6119909e727447d483492c961f72918e4dd8a7e543aa490b39c1f45e05b22f3e9023bbcadf0f91b3fdab1ac16aae2d6f13729219d5ae70b2ba8b552f23a25e56bad561d06c3c33a6578a966b9a9e8971c6008ad5791cd87ab2da27690b3f2868191a65abb6add5f72613a6ba333b1cbdea995cad79007eacc931061cb6c107b55973a87d15bc9c95d2d9e4dec237ddf91672251a05853dc97fe3ed27196814cb6e84f1e28954693475d382b6ec7ddb594613325d2c82a7dd9bb6a429ee0037cd8af2f129d871eef4da33966edecd011f0d271e527fb694430833bd7acc3b2944599ba3e13aae3a1213bf265dccd53123b8b285d9158d072699fc8c68d461550abe4794ff7397d1fc1adde7502be6e93399cc5ca0963d38be6923b033c6873b9ce8d05c0de899fb116ffd20822d8d956d1dcdc823f5b3682cb12491d462c1d98600f2b48ad02ba7090e2833c8b8f374229074d21f13b3d9c0923f78624e8fe2caa8ec57d7b321494d796f742e93c9e049cb416b05a17eeba52799113cb42274ea07fa7fb8405f5ea726eebcf15da0173c344f7f85da412589dd30c9a9b858e1cb3d36fdf3bbe988ff83ecbcaae06a40a7cde8225b5e02edd615a0c89126bead1380a4c8843ad313cb94b040dbda8a354dd11e2725584d500fb61adb7f785f253e153998838e5b87374f1c759e48da79f1d3e44c3c0c0ac3b13473abad9cfdf60f5b572387c7bebaa4a419d8a0cd26e73ec58ea92f80de3f9aca31f1faedf94d82b2b35f2520d4f6167c6e886f84620d79d7d8859f8562bff408f7fb3bea11c3ffdd8074748e10b22ed1bb5955daf6122c8daeafa5541364845f149c67ff83a0f8517fc6727b4c997d637c3c46bf80c76e9e8858ea041cbfee49fc135fe8ef082fab0dcb9c795f81add8e0d7386bb2cee496948b9c8bd22d3230d400b0beb119297097a73e41760df8ae3f22ab40d0402238833c5e12d90fecb1ce9c88c68f281baaef15cdadcdad4670ab0dec84b14adb9c0325fc63a05bc66fbff3bdf45a114f42c232ff53d8bfb3a474ce5c4f71841ee198336d4eeec82d52df5c4098f25bcc88f894a091cfc63203d3d50b5d456143467018da3795ee9d84508027a503550a813be30a3151bc1ca3768307d381e9184df8a3d00b20cedde0d82a728e2e714d1461deefa6acc067397ce836500289b57ac535aa19317dcf27c20460803ba777e55b8e29b9a678b67c6d6ef7abb82fdf976ef56eff535664dc28ec94b8b78193843be5ff58c2180b9559fb14749e9b7139d83fe2cf9fb375f134dc51e79831d932aefac40aeb83e006679952f95820882de19027172822cd6365be331fc7a54bfea837277410c0f81362518967dbafab318c820212ec5515b4e7354d15815c080a52f31553a5e9081bfc38ce19ef227fde8e05d042146b2dfe0bd4cfcf927b73cf3472ea8718d7d4c62753353ce24e64f7cb330257498a44260d92e64968e3d89a55c33a93dbe1df6220abbdf6f675febc8bba04e3145fb61ad6f766625535826681ae969635b55f12220339d5fb644dbd9ba8b00d0a4c28b58ccb7df5eec10b93472ed0fe31f1d22be4848ef8b0e70c636a19ff2770fe5e7ee691fbc44820b71cc826a5a4d3995015a26f31ce0d0e2512d29705ff15a1faf7d88c45c7d67c10f5d38672ac69c2442cdb602de3f8553b077c07e39a3fa09a4588667b766133b402da1a77bcaf6eb2df58cd9b445e9eb1537654aff9e8c882e2a1a3e5ed46efb782515c0500056c422994cf8f18edd8c4422944a7fe16c1a59c2e098cdd7afc965af691f582142470953c0fc2e3a9ff2b8c87e483d1c811ce3a92a20341e7c1ead94448cbd49121d96258c657add51d9bfbf10b28710ec4d263da0e1d9b3ae8f09c462b9868e08097be87853408245ebcb6ca11fd2a3a088a50b5583f6938268ac37bb295edc096048eb5631b6a6b40dff8cb7fc21b76839aba5b869689fb6bf0cc19957962ac2d494eb03")
	expectedPublicKeyAt0B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt0)))
	_, err = hex.Decode(expectedPublicKeyAt0B, expectedPublicKeyAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt0 := []byte("00b28c1f21529c9347460e8898cb6dac9467f010801fa59d744d757353a613c8")
	expectedWithdrawalCredentialsAt0B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt0)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt0B, expectedWithdrawalCredentialsAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	dRootAt0 := []byte("5292e59fac2b07f95abdea09c02c364e2c3c95f8ffee80a77d7795bdb40c2c8f")
	dRootAt0B := make([]byte, hex.DecodedLen(len(dRootAt0)))
	_, err = hex.Decode(dRootAt0B, dRootAt0)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %#x but received %#x", dRootAt0B, depositDataRoots[0])
	}

	sigAt0 := []byte("77d2a8764a94fe53c4aa7a69261bfd147f290949a9bea69cb1a754c6cfb07f338eb94dba1eab95a2b35ecad4a8a02b7208879a39ccb54ebfd79a365babf1d701785d0679c8fe3f532cba27c486656d97e9d2fba93a7409b1d54202aaf1e93f70430f6735f831630a98f3cbd5c4b4144b3e3e7ff03886cf565b324eaebea45f469db0ba2bcb4264e28a62c85bb2ffed16043b1d0a29f320151e44b10f57aa0e01398eaffffc7eee22a58543b4dfad99c8269a3d43b8efc3a3e5b9c2b31e0a08f256bfcc6b434f2d4d5781e3433b13410ddd3a5f723b35a10cb8fdc2d69817982e72f49ab3da9b7e0abf2344fc008d775aa3d9e70db0e31df99caa1c69b4755e71f8d2f08e138251d2f51a48067723a3cb9a8d2d2b9d199a64fce57804101550071966bfd0d5b26e986e0fb2be914f27e94c98cb2f32ad4e314feef330985e33c714366148d5b796b4f83bb38cf94c622e64b66625fbf2fd54a6aad58652091dc2125bb93f7591dec6f6a249df834ae4f958beac363ef64736fec15a477051577924de8328fb312dd979c6bc9b4717d7eddd9c3ed3594862232718b9473fa955dd98090ec75b9abdd6f899be0464960baf94c1c31dfe7331d3ffd89dd9a6d60f21647cbca50504eb92bc69788e45b1dec294cf90d7966bd90aa7fa2fb942209f7c1e229a7b80317c78ea65c9cacd3c86fc5018f69b1ea7e91bc0957820879d0e7f743180763af068c9e08a5616892ac461b0b7d466d2383f9d2d7e21feebfb08fa7a64389f4844d97adaa1e828bba22ede41b78959e0b73aaf69d016bba80e719e5e823225142a7ed56b4e0c4f0f1e412f6a5d05ccb5a424e6a0ce8872b0bac4d2300ecf4bf367f013dcc995263df9d9ea1c55f033e4efbcab5ca0b4ff300feb2f19604c439d9a6010edd6533e822bbb45aa0ac529b8e43681e486c3bf58f7594946242619614834cc2e3e3fa6f966eea8d406731448d6aafb7588f7abd7db072b69e44312324c46a62a1f517060a17c16c79b246b48a0b0a1949c5b16ca39de59b7f6086fb3c41fe4d73e5ba45c5fd4f3018a1564c1c2de2e4ef2d032135bf774294455c65fd12994af37a21b547fa1bab03ccf0962c4a472bfd12221a9f96383e129fafb9fd60ca40978df66d98363e03abf4595209c731b31fff9be384fff8a57678e1072caae1dd9b2199f22f873fd009a2e1316b8ac92723ebbc83365e3d5d8b9e888b0e1323dd5b9480a36c605ca3016c830410092913ada76baa6bc72309328c81282e72ed4363ef9e754ba6d3dfaa902fa1496b50fbfe10d4304a7ac169415da4122a25a6e1577f27355013e13c231f9ca3fa477dc6b61b6812b03b738336102f056dbfbd654404669faa638dde2e9a569827a7fcc5120f4d6b42b6d8a93e09ade89fa7157a5050796bc117957a0ded565e23aa31547e2a65a4d4cddb07c3ef98d5d8ad753239d5d3f9d41228f2b9a3f35269aec80a92752cb17bca1e8e4e535e4c86403eccb4f4c6e49d91dcfd6978d227cdad1d55735a54ef38c37fd58f3f69d5ca150032dddc481ac26fcbdbaabbde23fe8749d59b37274c35df638518977ed87f830a0194e0d3edcc4463c85c63dc4ff017e4fc45b064834acf3d85da746f6135818fdede37d4e3ad1273ef3506d155eeb2acc7f9dfdbc7feac4a11a5146801179855b235762471a74d84f6dfb2cecd28582e62c1a94c485e75a192dd827a87c3233c87603a6c7004a7a46e04765b8e61a1ab13b230cd683ccef8d8ab58bde746501d91d2d92848aa3ea17906ccb24d6897db1de05cbe7fbcdb79d96c5d668986157da7e7b6251d324e18c92aa35ea39a19da91210ddcc0ca3c997d9d4c99d7ea962b473d53d2579c8a2c19bda92c5e2dd1f01f83197f46175ec161f720e721cff3a33aacfe8a8b04dc0d03e7d02f7ab4b1280bf9cc6545cb7c4cba030bf49aa9e32707239d5b19022f8f734ba22c9da5d9f754af67e2340c56a5553b233c84b3f76355bba56e81aa2b1955011d42d9fc721fe0c8419e9f92a39be45e19c1c00cf0520e23dd800d00ee07a2266c37567525eb08df3a80ffc2cbd04eb987c45ae70a1019a4339fd2bac0b27b40266952bef7359af6f94c2f4ef224fcbbfd1910b792ef0e21b4264fb28daa3ba991fb8d7a95fd73e62bfb2fad6994a092cf21ee8f02c1b52344c4c81963b5865477aaf347de975ac3caf242f219725c428d4f7b973d33a2ac72dfff0eeef821572e8c3174bb0fa50c6058861b841985f244ebad05be24a4da14157a5752013af3c01760ea8404e4fda7ba9f1001f6d144529d3b5644b643b0cc632bd9b58ab61e285b700c88d97c009dfbe174711b03d5f59892da9b36cc3921cd93177b9e8aa08479dc36fe60e617a1ffa57bc80a8990f7e0a51814bfd4a4b5f3ad733f7f0665a35a88c7b239960ff187cda924a65e922cbf7b806d89b83c1ba0a038ca1f57ac0585b5798c3dd70d35975c6cfdd55c0d0e4ec44696f71e55428cb624cda8d7dc47e3610293efb89d0c7fea53ae871077004d0aa8b6e9c774a52d8f8e7ae6b409054ef2328b98c38051b041bbc8da0aed5740303368057725230491b059533506f73b09337557635617208411b2491b5d5fada71c497248c40325d8cf25ad5360ee25658091a1b760cb2684a2145a7303e57a9cf50e749e5325edb10569e07364ff089688e08238562c1382959458b450ae0bde650fb29921ed9dc08ffaf03e376184eb5f10ef79cb5450d35a13d9032e9a494b663cebf6fc4ad30c127c742cfa6d5daea065fc3bae2e2bd21615757b4a1de3d08c51931bd302735efd2d3c8d02e654c4e8b2dab276c2bffe97743e26d23be86008276c9798a70c292006ab96a976be4e97f580bef8eddb68ca400dd15db6450b128308f7bb8214ce245729879da35d47efc83bdee7d75bb891af3ccea0ea9fb8230afafa8a956d76cf7142cd4047fcccc3efc8df6337f8f14904dfa46e57b66c9e2cf6525df0b909f5ac3b56129d27413a95b8f3113ea6e11355d5386f0460d9b2c1ebe853ee9e95f70749f5761eb41f875c127dab6b2e6ecdf3a7a3650e3226f438f06d78d9c2829a4067495dae8226b92c7975be368439c71ac9f1375827f61fa950b2f7f0f1acb57066bdf9e193c718502628757b610bca2ae3b86df703307ad206a53b8b640921efc0c1ea3b022050315a92e713541bd520eee7edd59b8557d2355c8b60584699b06b8926997148982856c24fe291ffa19580015c6ad98915c4255b63b2a78dc4c476b0775937f627628077033ffbf2fe330bc5aab67e4568c724cd9568012e56d9168ada74864d114699832bd1b23d906cfadd8a018fb90fc8ee283ca4df08f93befe998ad64cb561455f2b2516f85e8ad9d4d67b245a3310f9338196da87334c0bdd34a3cfb6a0768ed9f0ea206cdd7f7620d5d60598edafd3c8bd9af8c6531fdc4acd43789fa065339d366abbd566abf194b22932a5e0d675c25cbeef75dc185c20aaf50669692df362424b908ce44685d020ad36e451fbdc89389f2602404bd13312cf57a93f4fb5ae80dba377ee41117e45c4c34066be2c0909b313a9151c2ef817b0d638948efd023c30cf5c4e4585adeafc3f9cf52e731d1c77e0fad24e2f760f2f109784f0ac5f038502a4876a2a68477e52f96900753b3319eadab9fd675f8206f15735309de81a73c37a8a7843b9f8fb1c798ae9908c841fe7f86a397aa571dec0db5db52f7165aa4243e074df1889072306ccf5a5560f5f82f1d2eef834a96857e0037c37dac9fe7ce24be44fc66670897e8f898e8b1217fddcd1fd3d1ac1414be52ec18e63805b1d553e4a6d909a41c513a9c5536f835c5a26ff579a78644f450264e474416e01b81fad4848b110a17d2da688385307721c9bef8a4e447714cdb1eedeb354012980096fd85f76b6e46fa258fd5319d514306c20ee71be5e4a5b068f74e2d25dcd5b87c3f3e5a16a2a0a86267240fca2701ea3ac1ca34b540d123dd4b9c8f40b0c0919a9c9aeeae9ca535ae4a43aa70964e4c2c036eff70f61d1c0d1a72de70f691565200ee08f79be3b25295f54eee1f555dc7ae80f8cba6084d1e5ad5d88e83cc5349638afde9c35babf51e8bdf6e30f9bf71677ec3ba7673e8aeb880241461b975ce26c95ed1b3b5f34e4193a4396b7062405165137846230f0d6c8047b0eed059790d6ddfd98429fa270d11256de0098e4af5869a862cc8a7bbab84d8821f8432b11a999201e728022460e86cfea42d421e976d8d08ca4c2f3d4c779f1bb13f0a332568dad39d7c50430387b2ee237efb40a5fc2e346a9b4cf7364288340e4ef519eb1d9591a0a23f1b3450c6462e8530d125eff91f9f6b18f98db08c2b2c052534d9b0372308b8c3ea370cecea8361649cb5f132ed263afcc8e48c9112d8240d7b9b4d2a68d9a6d84dc0f8447217b514220dfb7e2d1028c4425cca7dce240eaf2f30a84828e7a68c3903f79cfe744040240c3326324626a5868555f20d27780d8ff2466e7a2168ca322da56e01049bba0f6149326c7af17c0707ef7abae5ea196bea68b32e7fd749dffe636e929c372fb88fb43e855d9d9f6ff4d1935207b93eb996133a4ef2176907ab7a336460234edb92f17ae0f3175b37104d42f2a92bf06ecc82a78d9e8a3f20c3165116699822a9709b78fbface639e9e0e0f7e009b043604f552e69e9cd8a1355bc0be29f02f14d80f6002486e25ed3950c23bc07271022307be169a5c2f094ac2ff060610261c80ff02b9068e1c34ee5c6debfc2063bb83940635ce20c9a0514e0da9b2f7f8ad96e9fc6b13597fd8f56bf49ed220071f77a814599094b655501aaef39b5564eaa6591c28c528763855efc723ff98f3f3847fe935617a1bc0ce0dc728ebc77e2dd3dd5918b237800159fec4c1e1420f05ea5eea0664c5919393febc07dbd94562fa2be13671c14273da184d33359800ded87835203a5a8266d7d6e0312d1e00f2d999531fcc21b9c51f6fd0a39a09f50f3c205f5443b84487f9a0c948c6744c3f1be9e82d7815e7023967628b77f3d8b7a7021261b694d8ea6716d526ea2ccb05b12af19b1105430af06adcf2532a2ed0ea960ac05783225037f873f887276fef0392a7b6d02eccdff15a2b3216a103856f615595f88ff9c2ce9f8b9cfd918da2eeae36864a0bbc59881cc5145761efeb12ca0200360a50dba6937cc592f15e0f866d4f6c6ccf20926734f5e0948b5947cb6fca2afb971c89e830eb3e1b062ddcfb9760792b88a9cb9fccf104b78e8c1f5754a60171b767493d3b5027cb772aa4a790b4847aa3bc2c4401a2e800ae4a92e475cafdf4ace0ce5e3b69619e8b3282e69c4229c7428a87aba1fdabd7a42557ddc45a5cb71e474f988f89fc3bb5fa8f8b53b274e316696d1bdc2813732c5e559354c7402554e8bf71c5547bc1ae0f7adb321f657cdfa02f330922b30c0053b2298074162782c62dab7dc98f18fb79db6932e2e3671f8ad88d8494f799e8c01f6c89ed9e70ceb30cbdcfa374587b324c1226dd4f05d733fa6e35f4e45c42331999217faa958d3720c6ca81015ef9101812d76e2fe5953a84360d98ec12b45018cdb878c51d11ea1900af8b67306fe71f4b616568d8707346d3177e58e02bc2dbe58d454db1f3d5e56e80f87a02f6634fa8f4456f5c4e123d40812416128028827d086cf01dc2724a02ec6ceb16861a34db0fbedcb7d2d32f29f8c91237c667a44fde49625507771504afbd5626c19459a6c57eede871b066b389170b081bb32b6d096459a7f4d1d3bb9ed6918c11bc36fb9b9ca4ed9e51413ee149c97d777964ac715f0af49fda21afb273d47ec24a307f1b10ff3e54b9ca694b069b71f6442aeabc4db55ecad58fd5b21176261431633ccf7b60314021d23da250dd23b1a76a49df1bd848d4221d03bb7fa6f2fef0f1c1e7ad6cb498541f99af58b25a456325ccf1d172c1833733648dcdf003eb71baae072b6a4d5427ccdc40015355c38df72d15639aa187e2659171b42aad7191634383b96d7462673dabb4f8c14178292e05b53cb422c1bb538a246228e6e392589f57f8cba4ddd05575500f15affb2b7bab24f430a71c05cba022dedee36dc062ebea0fc0ee1bf743129c2411b2f79390892489e625f3c3faaa5a2ef5aedaf32f30808cf2bb06b3d565bb8087742dd77f2ed7ba6bf59a0b08210645dea3d31f343d2dcb5f75b96c4f79aaa34c9aeeb1f68fa43bf215d937856a4d9b97eada87b86711754965ec85b27c7810cf12ec34113786f7856ffe5119639c3b8017efd3484fb385b0047e9bb6fbf3d4372fb813f535e70d0ac997a6a60fff813c1d8f58f514baca0affee4ccf3a0f49d5cad0323545a14603b13e377d6bb25947c0bd9218ea33f33196eb5b50be8bee3e54a9c2774473b780f32a1252d5d6e7a9fa3b8c0446d7b828d1927ad347782e5e6f7172a2d5b9cc8001c2398a1aabad7db0003204d7f0000000000000000000000000000000000000000000000000000000000030c11141a20292e")
	sigAt0B := make([]byte, hex.DecodedLen(len(sigAt0)))
	_, err = hex.Decode(sigAt0B, sigAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %#x but received %#x", sigAt0B, deposits[0].Data.Signature)
	}

	entries = 1024
	resetCache()
	balances = make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance / 2
	}
	deposits, depositTrie, err = DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err = DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)
	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	// Ensure 0  has not changed
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}
	expectedPublicKeyAt1023 := []byte("d7d9cc6f6f93a535bdb3b18c2daafe7449b4f8766da05044a1af735983aed8d7023d15a7d9b279e62ce2d4f1ef021f986fded4a718fd6043e0a5f60253f3e196913b5090329d2867b49473ff3c52dd22c55f481e763a27ad4b1431dc116a871ef36119295c6171a38583817a5ee246a29f730d76b68be9b6a3cded4fb1104c4ca5d4620d63e4dada42be5e027bf1d73af19ca6bed0df3057bb9ed15f072ff61e391bc43d89692450b3ffba273dbe7aac1b6fb85405344fa9763dddb02d0a46d559e2df47032bc90b797531e56364b4ce6d6712dd6bd92854614053a98342efed93178b05132370924f17049034c079074330326c5f4378a052aa3e96200eb55582e923821d32fa8ac67fc59c0b51f30d9748907e661b0f066085cabecbf4ed09699b3c7879306f82dc23bc8fa6d065e5c9efb6bfc812259ef6750fb3bcf1888c4b1e44fd5ad4e3fa62cc0ded3d1415b71e2b5bf79a5f4cd2d4ae2981112b0499de2e9bcb3591a973dd79a5b1ff5727cc0e1e57d7cd93775f4424231949c50106f9cb49a2200ef71378dbb5932d4be211738f8138c49f1ff0f716e3ee9c7c54ae9248cdd7c6522072553b3af391a331492ee3471afe566a58f84d906eab10a5ec5d28b2c2ca5d7f26a861b41d15976417d11340559bd1e56d527a02bd0eca42a8d8417878ddb63cd06b554f897518d2b7bafd51dde9d724f76cb338d59b3e077dc2092efd4494ef566f9530fde5b04ddc497acea8efacbee290c2228c270f8bd27cc2e4c17b59ae731d268ec67593723867f9032c7a0bc184dbad9b7ca2e5db80d2bf1898401d6fcc63904f50e50041d9a23ef760137106f6e150f8a12cc860d8a141d5c74bb21c2e0ce5770b4fb8f2fc85bb5521114b3fd24720775e1c880f96a4c9a941b6d136b4bb2d48af64104191641a67360c67fc9b666922043625c0f508ca5458bc63f847da906a89ebd4766a6fea12a985407dd61b94ea586e3ff924a2969546ebd0a052ad61d8db0a2532fda08e6b922371b1c56ce2eedf95d14fbbe68a5b3ae2c24d03352143a27ac53cc4d8fd7bb4eb4e2fb7094f2cdc996dc9c95fe38d1fec36490a6370ec7b5d7e2b5dfae30ebf0e91b6a0f328b811102dbeadf3ea43a09747d943974b4d7b980e262fccff275d6b46edf124269b6abe4d300a7cd50ac1f1a7a1bfd6a10434d56649d67b3cefea9ac826c11da4297e935074432bab3794bc6d7076d5a7c37014b6bac95daa59750babc1b1691e04dc78fb02e402dd3d2f54a1808886358aa9d8c1044a05d94d6fcd5d7693a478c77ef33ac98539e2fd78f98822d7220dd3e2356866d5493bc0fbad97e4edb94bf48f57951b15509c7947e95bd50ebbf9633f3707e6a1e41189a5175a5f23319c9112909ee78ef9ee12c06a6bd7cd2fd014fec6c701829db916367c2534866bf2b06999e377c75de39b528de0c99e374fd41868da53d2f8a2d49905bbcf74c8f099781894df4c7830679e0eae560c38d67679c206bd50aea6565c23b6793e7c7ba1732b055560f8238371ef3aabf503602fb29255b1c03b292859b6c6221faf2d26eeb28781e9904c64da76c9a0f31c7641eb10224bc8bfad7aa4929011c9021ce9d2220fa5213ebf4525cc6d3e6701d89375b5937355a76c6808284614322c76442aad7706a7563d79b32c3f63d274bf78a090b648665517ee53957415334d92e0213f27ce56fed5931e842d547fd31f030c54c1cfd7ea29d034fb74a9c347168406d86c4811ae8310618e3d3a943d0572b0e3a0aa5e7e83d28803086075c539aee838715a6c04d1ece3c711d981445aa64b389edc01a76ca2519bd9dd3e3bfc6596550ff49425a9938f6767788207afde2ff979448dae2f8b6a4ab1c2cc216a187a35c14766841917cd9fc032322b2c5cf2ee0e77bc76368f2c3c21a0b09557e1d3f2e67862f4a820314aecd05886589a48680b5af2e62fb4cbc963e8e111ac3f0443bb4cc27124dd8f9cb2bfff27ce5446d8dbf83e592b5cb90f452fd8feab733d54c0f2bbb91d97b0bb82e7506661b90be6aaba3ed8e2b4fe046877903b5eb3c685c7a9a6c987b631e0290362525829df54fdf01a20b99483ce0e0175907bf16b1b0f0436fac3890a383e1c4bc70c7aaea2cb2b1605c8edd49c9bda5cf38592eafeda5a5a8a623dd74cb1e05a9d305ebecf41f81127de98ddef0bcff6af27f053eb07fca593d513679cecd62daf19701075137208ac8da1fa001e87a40777b787a30fb2d8c7e097c1aeb593bd70fee895aa8769a6430695b929acf2f079d05e42d5c183d49f346f120d63429920352d8a844d34e7d045419389995e530eaffbbef107fe2f334cf7a2ef055d603ee30bb651ce635e00b7f6502b3cccb7caa5d139b2a21d740d5f22b68375b11f21785efcef340d30dea2b81a1520dd1b453b6e48eb84a6df60ecd2848acabb33f15efa01b2f340e18dfa4c685fe9593ba6accc56b373dc1ffe3462e135dfe2e05c8f0e9b0a9274607de493a5c796528f76ec6c7d19a064a6fbd0e851a35720aa7b7f298f89d0723a3172517a537235c3209a09bb496cf6985dca357c4956cb777f8a41a4a271313b081076c40d47be452b9ce3ab968568b2f6f2bb7cbbeee4c448b0733c4f147e2ef4bce0054e84b3664d810b966f9e47d365cbc45cd6ed76732cdd9c735b2c9fb2e4c83a6bcd234eef54178bb50119f9df15ce0ef12b47db9da98c97430d3437a23c847929619a4f2e9d450dec4672328206abf5cd0a6fd2086610babd2e133e845b819b11c896f89fa0ad55913259ee778e3461abe010bc0215c06c09f330a4de022efa3ce6fa40f46fb3b4da4bd6bc08a76386f3cf1c1c79ba282326eb08fc62943358dd215ee3245b4d96ecdfb883a49e30052854de7c5f68c56faa1aad3ecbc6d891662d181930f74152dd66d691a4e5df829f952ab3c9ed99f4e045bbbbc73cc78f7f516dd7343f8a4755901ec20315764dc52de88f91143827f85b72ff2dd9ab3a19eba81381b53c6881e201ae324acf0d14fc6877da88c7c1ff9d931a459d6af0af43edf4e693e0462d5e66c08e9100deeaf88143d7a987ec3be1b2f17e3c4d2f2a6e4dd98e24859ba46b363cef8aac8629d5decc2f162971b9ef9dc4a4511b0fcd26ff8b383eea630d1ca75830d9973301015de99b82a372b747354dc975e010c9eb69bc8939fbf43ad59ed5065ea85582102aecca7b9c2b3011e71b3618902133858c69e3393067d1d4d8aee62ddb39c5d84107528b21853c72fe7cc48c189dbeddb4d355328209800a39f94f97fa2e6ac607e85450c2ba3aad8665f18e9e3f24855d0d6f8577d7b46b291316913299a2c219c8ef9eb05f1b3622d73fae3232cb8b7f795e76b8201632e1aa50c2da06474228e3654a07d4ae39ed12293271589ded65f668f94a44d52cf8716cf2e6988d1ed6ddec46457d38234ae5b3a863658d7305aee0818f10cc39e1f1c6ffe5c669f2e875bbace3f96f07d8ad6036512d2f308c8511952233ff7d7c8a32d611e800d1f78064635af0e0de0b11e24a6e5b8a442857b6f3199ec80d266d2d50814780d621acbd3143cd26b2ab26c23ce1015cc5c2bffc0b8d72b180834cffcecb5e2a2f9892a5dd5596572f72f9d9fb962fe8a324948f4ec21bc5234afcfe")
	expectedPublicKeyAt1023B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt1023)))
	_, err = hex.Decode(expectedPublicKeyAt1023B, expectedPublicKeyAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.PublicKey, expectedPublicKeyAt1023B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt1023B, deposits[1023].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt1023 := []byte("0038906e54ed9aa3a4c5e0adafdafe7d203d4c8fb215c1b395aae866dbf2f04a")
	expectedWithdrawalCredentialsAt1023B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt1023)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt1023B, expectedWithdrawalCredentialsAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt1023B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt1023B, deposits[1023].Data.WithdrawalCredentials)
	}
	dRootAt1023 := []byte("de97036d3c6bce627279d4115b885392480593c51f759b490bfee341287d66ff")
	dRootAt1023B := make([]byte, hex.DecodedLen(len(dRootAt1023)))
	_, err = hex.Decode(dRootAt1023B, dRootAt1023)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[1023][:], dRootAt1023B) {
		t.Fatalf("incorrect deposit data root, wanted %#x but received %#x", dRootAt1023B, depositDataRoots[1023])
	}
	sigAt1023 := []byte("20a73d91eaeb6976afd793b535a8e90d84d23589079131ebbe331885765df299e19ea2ca555452561da28ce646371c29ea001e9ab4eb5a6d838fadb20cf6874869ba3a9b0ac222612df678c53ee3c08e29101a38a8fa30909a39a2f95756700aee850524c4580e0cd86e7c7f55971a9f2e58f3a74bb761c89ff1b28185cc1d2b33a5101f7c9c6cb208abbdb54d897e430320a0ff07adff399641f61d07e19653614362c316f5c897f1e7283e1dc44fe484575e2fecbc280ad56a5b09b1e848a874c378ff8323c4e3c69396231e7cc6239513a0c2cd905cce100c83074bab7b2d810735c085231af2f3e433a08b2cb628a7ab316cc007aac4ac5306280ed1ebc44a01552c350ff9385a2777b57c80837d05af89b1decc74426cfec074abf732c25f1c99fa6759a7432f3e77717068cf17382c2dcc7aca63be9a2c93b9748b7a57e835d4e7fa4eef15017ce40f385f84671d83ea1a9c5a0d4f3ad3827856adaf1117e304d63302dc085b5c8631246cbb5e8a228f932756e58fe4da7481818e27e7d17a59a82f356e2a9fd3d674816f454abf3eb5debf7b2c7bfed750e39559bf691e0542ebddb1767289697c57cf69c52913713ec72ec13db4ed510497dd56faff0afb4e6142781b9640256009f958313c782e12d9edaddc810e7b5e2835af8b9dfec82f90a2f5a2a2148f006686eff5ba9bdbc79df991706c90ff2009677096ffe96df071dd611704359ea73b8eea3a4feff5d5cdfc5ac6ff9a1a4a2845aae957a11c391876bdd23c71265b4e2e4a1d6ee20ad3b7f282980c32c61d3e51ad1a81541b8c0a3bb23d7afad143f91e6dc92a6819357e88594465ea79c73d55a38904a3e20229c2d61d40a5ba4ee826d2810797cc786dfdfc28155ec0382f70180833a86fa5943f696f61dccd296ac9f46c491869c38684f0ad87eda7281856a71ad709d1c2cf8af53a514acab57cb21523eb3ffd242892aa0cd5e6cbbc5e7cdef1c4f6b326e3f91f65437f69394bb7acf7caf04f63252fe8db17a08afce83b4a02ff0aea13ca0f28feef4f0bc062e2c7b11fba9c1d3ce1d6516e92b742ecd2c94ac7861343b96895e2f7bfe3d4fa0b1c73fc01f46b9c31b3c290f473b0f3f19132a85b69ddbc03a2af6f4c273393150fb85b3763cf265f331c7c87383fe44b61892ee7345b08edf215ea2f54b04eafcec6f3d38451c0b556cf35e09c30555bcdd9b85b02c8f60e4b95981b3241a60a84dbebc19ddd70d1ad5c2e7c889dc8ca2f5df7ef06b1edc93b49e141e81a89655757d38226e4dc977e62772d70ae3502a9a9dd6e6bdb5d7e9942ea5d3fd07e165e2954613bd934eb539a4e4f75884359d0dfbf88c585ea54d0b3feedc613a7ee9fedd751f283d7a3f2e57e7785b4eae0c554fc95f3cb82da7dd24ffbb8ac2ac8ef8896f4ad4a79a4c510d533ff3dd81b83cdad8008103fd667afa12b2a3067e15b699960a743e67500e603914b3e8af0219f37e196f88ab2c44a72f46594519e63e6a5e429e0bfa5e396df8000321e276c21168b69c14cac35cdf75a5b3cf1a8d1b5e08a880572a219ffb669a1ef34fa431bbcdb5b9140f9d96f46c173357ae795c366b7deafb1759408df369a8fccdcc82761f34c69cb6e5c4f97524e0c163dfb767933b08142c943055afe942401306b1da16501beffafdbe3cda6f98357852c7dcd13a34bc722724e8b8bcf8f69f0be4c586b9a542fd83fea03428de1858eb4a3e00b70452ff3db91bb559bcc6c45ce0a7d690dc234d02bec5d9db8f6c50f25ff12a80dc579f6aeefb9fd944fd095487a27c05b5946dd54f16258c894e47e94af9e10023163a06313bf22699b2dfa80d08678f65bc6c337714b06d077037a6a4b0856672a4f73ce6a301a3f21ea00f835a172f5b9628d1c13cf3bc396d4420f650cff3fc6cfc832e0b138c8017b0f67b22adb93bad7f85734f5b8fca864cec692a1a2debce19c2d518117d2979e4ede8c65d6d9b3867983ae16047e94ced6779806b441a3d391dd015cb0bec769e27adcdd67498c53f25e4de0219059e7307baa6cfd78af5a0654d724e346fb389f20ed0a27b3b0753b44797f2e925143cc43a1a86aaa5fac18be3d21c0b345f8585a5c80562aa39669b276094388a2a31351859360cfc33a6a95cb5c6ca972fc244b69f1f7f1efc0760d340899020a356babb0db515d07c46221cf87926c16f44ece7a9e2796a4a920c8f54556c826941044b14cdd41d3661397bad2a872d2778c3acb8d723bcc3f4303593a1f4e321b9803c5468ecf9cb247886b9bfb10a2f7df84fb4f9559cdfd051501d1c4e57d6f8313d74d95b9e3183c8c879278910eaed82b3e7cf10ddbb8830921dd5de5f444125d8780cb49eaf4e2e2ef8af683f59861ba8461efb5c02b3fb142d69b6de0e5236f3e62d75b3c62c113ef66c4b45a289f325869709454e836242122372cf6f5ee5d8a0fb238d87ecc2bd399db8327615c476c868c7fa8a37d1bec8c2db6783d084bce28aa8b8b251475f04bf9af121ab6b6a98b82362a678bdabd6eb574fc67a13bc8bdbf4292e778d935bbac240a5713e2fa87d613bf9a9f7c51d6cd21a72cd01503a88f1a946843dace89ade4550bb29b5e941d5b24ec44b4026d71e096b96bf0f85f8bcfca15609a5f58aaf9816fab51ec976417d2646d6518002fa471c126e81f5081e1b1d66f8d2ab85e331847fa5031eb46cc6ee0a0d4e3532dca38dbafa99076a9c48aa874dda0dd3ae07df3ffba579f8891b472784d10a38576e7998ba2238d66b2c3694c90bb744b39dc763283adf1a737c22b849608e999fded0faa15221c9b69f3760878fc3a59dd7dd33d593ff14bee48ed42ced202b2279b603e8682fe42cc69a8cf1a3617dc6af63f5f64e22426a9d9464bda5bb05345ee34765e1800d1dcf7a589bbe9c407509803a725ac463be044ab5dac392451e4c296305641479277b466441c6e23b15ff98fa2f4f2e5691faae1be5f0682aeeda56a0d01f10cd06c59609dd14222b093143d411f016b2fa24eda0b35ec9074ed492a83bf0ec2140bd33564dc5a9e9027bc2eb8721934b48d79b1a23c64fa82582792c73bffc42e4862eea3e60e24933ead3e3f7812af63ef54a2c1c0ad576535eea9e5ad7552f3e11efb87b052c034c33298ae7bed084a71c952a7cde1cc0348aeba524534da7596852eb0768aede71a2b8bf9d2a9e4d694fe22df96d2dbfe12c65aa90e78457034b6948c84e446aa522c04dbf1f2e0ea2d65d2aae25fe0f749852c614a194c0d04a8b17cd9fe79e8af7e1ff875a973e05bdd5a0f5dc1ca32f446aa829efb356a0d599a7df2e57b0336b7642f62aec90c717b17338f5cbb9431c44df8893afba6ab8433188b70ce3f26d6c8873248ca2c8f37df50a3effed4dca528a9f875491c778f418049cf3d39b8b1e4ffcc04f0b88af1f9fd98c059edb7caf71a89725d281e3310b4e8bf9da8899de7f42de9567cb2094d31b2b01f0b20a9973b1128bac80aa65daaa5fd1b0042eddca8791bd333714f776b719d0a234ac44f4671c97ffbf35e7408618d7bb1d3dd76551a1d9bbf909d6eeef36d7520ab7a07ee19bcdf83545ca8227ae3244b30d23fc3c127c3a168891714a74515a2c45bc00c612a04267ed9089603932670511a0e56494970a16b2ca47703501cc2ecf53c21ebd045b0e5c426a622a93d5846ad48a9e638c9683b86f41c56b4987bd7d3f404e7128765df11b5e42fa309d80b845317fa13bb6ab029dfd5ad5d96559f15a1a4619b7aa50310f86de8c875cbe0167dc0f9cfa8120c3b8a35a859afc4ed24eaeb7be4713b03d29af8a7e33275a25a48bc5994a665d4190868a7d2ce3e471593d19fcc05b4d43019bc07fed04499d29515bd9b53d468ce4b03812f01e9d20409902560a04c986b3ad43d40ba2c1513408da1c15e69f47fea0d3a568a70c549abb062378a191703aa43c28b1dc56d790dfcce882688e2eab243539cce32c0e661fdb02141c3b15d8b5c01b92a927654a93017c35dca278fa8a9307d6e0e81f44e0b932df82ff5b9736943144285ef62569e6f476de1a0e1f66226d71e4731e3b36eab93b62f9f5ce6c0287beec554b5a10384b9887b8e4576b7332dd449e819441d10d98c4dbeab58ba63ab3b592652fa8c44a6865e8b901afaa8d76ed3912279dbcc2b9dca2be2eb23d491abd23e027451af02f70ae06ec5460351f162c6ef24d1f5764cafd3499e146fdbd9fbd290b196173abe4090446b73d1e7b5a5c4ddac8f3055db5dd45e5d07e662e8b4fb936ba025c36a1bbf951c3748d471c81a7abb968b94bf461e158e21551b8854bc1e02f5e3e5bc4102d0b1c2837e4eeaed71a1e5272ac9822dc706402052576d01970d2086cf114f45eae674e5bc0c17769c9f8d1110cf1a141496d80830fbafed1cbfccb8bcbf287271d403966e62f8b1e3c9483e3f6148bfd5aa19b4a8e9c438d6b70bc27cceb6b45a859d2333917e7ae0e57ce78eafeb6130334f171c5c20a98e97f6eef09a64cd29da00c911c19a72db84354abb7e0bd0b9ea31376a6fb73106cdb43fbd757297b07cb434e70dd622f02bcb580d9fb7d2da718321c42009ab164551d4cc042b9feb592e2c8e3af2137e5021461b1d4e4ea04b8d4083463395a663d18e46fea2335aced4661770a6171f898f0a4a03ee2a7d62c1027d6c2b5f97ce42bfc83c403cb2dbe74cd3fd6e4696d3727f67e038c2afef22113f81c6249216319a5bd8415837736a007bfbf748b24b3862075d4f9d0cfed347b31ee9417e49f4d8b14d9265fb0f0bab11da465e0c6ff70c1c8a3df2908a76f546807405c5a833dabe9aeba1b84e857e64ced1770fcc3b474517a43defd20bbca13ca39f88fbb486bc50098de897cf6f9304cdad4106dcc72cf4515be61905540ce85943798f3fd3c474c21e84e7d291c444ba614956278b0c6a129dac0444eef43bd62319f18c664f8acfc6c12cbb95a3ccd0c5eb47d19e3bdc7be043f962132c11093d2bc93aecc2ffb26d7b5104113431cee9627ce48e8843bc0452ab7d921e77b9830051590653b6ebf98a222052104a2ffa06df8fe0f715af674d2882465b2166a9c03e51691fb01a5e2e10f1bcf138701e6ed02559eb61691a71c66d04096db751b7e6fa05e612f79e6bdc24d819679be980596495ba812fab112b12ee5bbbfeaae1f4081cf97b700a57f0f59361a13c115d7e829db33542a750a163d070b22f6c41ba23f392295567076b8260121fc1f5f1d048050fff383053b32d04dcf42254279e2aab41eeec85a9d412cc3587eb97b0a11844b0b6b1710c4c04812fc528ba82a96526ef84e1291ac2a6146b8f379f6657d96ab65a0371aba64995c8491c3448747d81b01df9661cb816f5d3adb35f4b7c721a779529d7ac27aed48b95213a2bdaf7392eacd538f27dcfca1a6173839c85825d22ba84efd398db9af8c581cea57b238df8b65431ef736b220409e498e8987d739789e57c23a6d8e43d4af138a0f4ef2b9cf2cf4e523cdad48467db1f56d6ec35eb0d34834e8f527d14f6ee34e157ce1ea399117ff116cf1d05738455c8af69a16984b7d410d2a9a7f6b90dec87ada21fa50bacd24268872710c2d97fa1b5f4a1baf4c956f653886e33f11ca9075f398df23fbeb048f440c496c8ac0951907f55482e2d355b97953da897ad71f50e84c3b52ddaac255f816521c7f7dc998c78fcb572cfec2de71eda4f4e89db159f0c4757474c7c065b1748ac72be8b20cbdf48020d416ca846ac5ba0a962645096962f92eae85b7a81e801fab42ed3624a48dabc5e6a7d4f62d941fc7b7993057cc8b6c0ccdc52bff87bce69f7c6973f80c16f1faee08133c519a453c7054a6f7832288da8e24dd46c229a92552277fbda9db3030081940c636ff15898bd37fa72ef1fd634304b6d22a4247047bd619b0ed37474c36d2840473954633a01793a6be28f7734d176f8ca5a5cf9e7a6b65c65730257d3086ace43e08817c778ae904100a951af8169e6068b40cc6e1974fc035a00b88cea0b7c640be441e01955eff1236b9d97fd80fc7b7dad5b4ef134aee8d6f865364f1dd952011c3d2db919aab14c56109c64ccfef61389710902cb34b36eb68e0e41ebe021060021e3bafdb4bd1a11940de6c91cb88a80ce2974272b46cb43faf72962fa8464ff035e388824ed5a9925b96fb82dc5d630ad8c7415264fa107a7a480c4cf8bd74d3d18efdc14201b129ce57a54cbd478826050d2e015e24e77dd80a788a80774a8eaf3a77a7947cf276966912573feaf1fc8e26b09189bf4c4e0e64190d1967b3d7565af86e66ee373d951855c3fecaa1f234a0c1521524c49b6e05932c69719d284c1d8c919cd16d5e1b3eab1deac944cfb6b40ee8c289c57ba2b7e749ccda64ddab6eb3e80d2e0eb1e3d38486d788999e7f91b41a6b6c0ec25697ecee1090f273d5257738693bad705256b718993d7e0e289daf0006c839bc1c4da0d26565a5cf00000000000000000000000000000000000000000080e131e272a3137")
	sigAt1023B := make([]byte, hex.DecodedLen(len(sigAt1023)))
	_, err = hex.Decode(sigAt1023B, sigAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.Signature, sigAt1023B) {
		t.Fatalf("incorrect signature, wanted %#x but received %#x", sigAt1023B, deposits[1023].Data.Signature)
	}
}

func TestDepositTrieFromDeposits(t *testing.T) {
	deposits, _, err := DeterministicDepositsAndKeys(100)
	require.NoError(t, err)
	executionData, err := DeterministicExecutionData(len(deposits))
	require.NoError(t, err)

	depositTrie, _, err := DepositTrieFromDeposits(deposits)
	require.NoError(t, err)

	root, err := depositTrie.HashTreeRoot()
	if err != nil {
		t.Fatal(err)
	}
	if !bytes.Equal(root[:], executionData.DepositRoot) {
		t.Fatal("expected deposit trie root to equal executionData deposit root")
	}
}
