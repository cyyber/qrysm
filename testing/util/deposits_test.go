package util

import (
	"bytes"
	"context"
	"encoding/hex"

	// "encoding/hex"
	"testing"

	"github.com/theQRL/qrysm/v4/beacon-chain/core/helpers"
	"github.com/theQRL/qrysm/v4/config/params"
	"github.com/theQRL/qrysm/v4/testing/require"
	"google.golang.org/protobuf/proto"
)

func TestSetupInitialDeposits_1024Entries(t *testing.T) {
	entries := 1
	resetCache()
	deposits, privKeys, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, depositDataRoots, err := DeterministicDepositTrie(len(deposits))
	require.NoError(t, err)

	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	if len(privKeys) != entries {
		t.Fatalf("incorrect number of private keys returned, wanted %d but received %d", entries, len(privKeys))
	}
	expectedPublicKeyAt0 := []byte("b755417ac7b0a00d7a04ccc9ba74c5bf46213704ae6c366176b5c92dd6c209331a23b29e4c22f8db4b4c8f90c69a6e6a14c0ecae5abde6f6e6f03a41154ef97d49f55ab23e1e421f7dba88182c8ee507cfa225ddf6fbb7e5d5331dbf21995313bf40d127ca8889ce06fd10b848f83bf6b0b7412ece6255b895833c17309c39af542eb6a12c61aa788dd1dd054c8c6630e80e34c211f107c7c440342f3a434698d6abbc68bb80e98694f720e996872bd049ab12d263ac63fb63ac100c5122e1b69ae2bec37850c38f9db50928facb0a7bb39a4205eb1c7f2fdabbeb32edb17eaa9fcd68f43eb56c66e829ce95bbd86545e22f138df8b48816543622bfdb0fb36079ac56cbbfeffe6b33781c410f51dbb2188d47c924e0d4c2c8b55cf37e749d28096df5cf12256b0d62324140c4bedf3fdf75360c6a00e441a77e57e5f26e9a5786adb75b10d5d8265038eca3fe6f52568ca4099deac108604f932f793eb6e8962ec4372a49e288c488f94096b2fbc32365be7c24588dbcf83a963973a3f1ebf151fe3a36dad00bff7e72af525bfac2422a0431988289f10530c8d069c7dccdb4ac5b68981f7909f15e5faab4546d53855ef12de6cdabc1006ded7779dd91f0615621b9f7b2a5945dd044504e7fdec80c62c68b16179ff628f9f6c59398d9dfa35fcc2a40022f9ed19cb726c3052076502ac5b34ae945065191a0161526e750942f4a4a7b05695fe7f3cc7f4c22a7254063f78d80f5da1d9b737a642a59ad16d955e118a1b1e68e7fc83d198780cb37a84da1095a96c1bef28e3cb8561c4eaa05647a523df7b1d39695cd5a47e51e4e75d865dadefb2933404f684422400de0158c1a8f2dabc8b87ced747de591a68bd0f9aadbf90911cdb6b08f77450454d005129c10a9be844be3ad848b0a674356c0d31b9f19acf45a9781e85bf1a6a2b88999313bfaf816637b239d4fced92293082f649dc3c48ff0443505e63dd948f53dc867fbb523faaa9b6f95e6193b18b0bf3150b35564acc654ddcc6c8122fb134c4acb45a6f583ec5f8374b5b118153271aef87b4986d76f2e6996523cfab3dea3f794fe62c1ff5736fdf9d13295c8d3b29fddc06200aae6383aa3b3e9581eb48131d27b834c0e903e9d1e553afb56199ea789fd475da516b428d655ac86662dbb26a85da97af5dbf166a31cdb6d6dc0cec8137d75ba3e892a3217beeb4e3de845f2e762ddfd7ad1c1cc846dfbf0b75590268347a6a5566599352661e25149058957b0363e82e0e6b707d72d2ecb4f7742333586aaeed28a52f905a111abcce4fdb3950b6ee09e59ef42d5e156315ef6c3a0b3de5d0643b5c5b020eeed54d2a8e619fd15e35ae182cda8415292e40e52af5a6434187af39ee73a5ddf70d3db69de5c54cc24d1e42071f39ef150803d37550a34a4de0bcbfb02e668f7323ac7293e0d743a383d9d6120df38db45b38542e0eb3fb2d73339d523cc2f2e35f6fa2de260de4c8191a242a67cc08f6ee7ed4546c8c2c8883516f1c21e5432a56850f7c1ab67fda639424d5d5ab5ae5fa6b54879ea669f9933874077936d9a6023ef21a270adfe2ccef04ee076773e0aaa09af869dde0b2db2e7a2ee9172b5b39510e6bc24e8b4efd3c80162af808bf8fbe42ef4d2a222f825f64ea313db470905f93cd3bd944773354645845880eadab41c47f2a40abc3d1e1b1095e601a11ef1a2e00edc52b500c9cec70fea2d863bc7182f276bf0ca8b9c3bbd4e8cbff8eefc62b8bef1702681967d11c3178faa42baec7752f3bc9837b9e7b2afca131ed01c8cb54465c79261d4a7ec9407c1779457f1e5af2a76d98f0e589f70fcedc1b6a612000a4224d5dc3abe7197485c5b81e6cda403b0a8e974e1ea3c0f327f55a87a7ff063b0391ecdcd57ecef81d3f66063223fcad66fdf79c9f4bb823cf52aa9f7f141bf76ba05e6a8d2e5cec872a59285a7e90dbaa2c931a26979c60f6060e2f5b458f44d16c637a7d4508ca233008232ed6aa9c0557f2ac51fe706abd45e04f5b812b19f427870343c323bb1e7a98ea7fac273444b73777956b84dbb0de64d623211598a7d1ff169c4445469a4b0e50677ed828f60ea4f028b2aed7bf5e56a6ae7607ed6c9b291a3c3d76f1ea5a0419f59cb91c89f07d9706ec46c42fabd47b280c7685355f74b58ac10599e927ff63d5015f2a8e5471e3b5afbd208fa761f8106f9293e821d483b1da1b298a386ad82459db140ea87e1a3a23a6426bd814385a28c4c3a842a44e2024e486b0b4644658d73236ceed421de204656a11182f21e94d66ea9c290249fc9e374cedd4e67b0969acfc1f4ecbdd401ec936353309134becd14db6784a51283bda7980292cde6c8cd35ba0b3a1109905ab8b8a2f90e93c6cf47dd16737894d04426c9e3b85191debeb9302511faedb31a21ab3b22a90aec1e22985757e6ffccbe751f9c6256d69bad6d6e1cfe989202e87cf2d54f1b4e4163902d6e0df22f3accac0e28cccb4c0ed17652bdce8c5aaa3160ed20ef1bd455119e00e1c3832e6c838a6b7635723c4e078b8d2df66f9c3ab7999cbb6dea42f35ab3ea13b6d0a0a673615337da54f2ab1bbfbf3b0912fcc1b73798a883281a8a831938c02e226533b38d426204ca082e9a39ed8736d620465954ffd5a5645aff6684702a08569534713ce8b9be795a979a947f67225a2dda27d20e4f906e39738a413233ac8b5c7da0cf59caa54ac89b7002a0b73997ce1879949f3f5d37a82f49047e6c6487351eaa5e7a8145120fa77c2383278ae7f7b2b169b64c8a4ac6e6e6ae8c78b5e755d42e24621ee59479c0603736647480f944c90545038ba8fb048dfd475c739fec820c792010b4e9203d1c18b908e9feb448caa815bdd8e8363ba793544ce67ec4ecdac3b0cea2acc4d51aa5fc2f38168f4c9c83386e9c5fc2e96fcab0a9827f6daf8eb1fcb8c391a7cbbbea098b6946ea5111f63f1a31455d49a45bdb48f999a3153ee37b12917e564778f7c574b3925f12a03190b21b8bb062cd7663c377a396cb99cef834eea667d19ed20d22f11e8564c3cd670fd3b020e764118cc22cabf2f967776b0406cc67f7510e10b35d7779031822b6feab45735b7121d628160783c40f3e3cc2cccebc623d77e8f4d3c9de88fe0660a137aa5f5811c873ad57115200468aaac22a768f8e227c95faa7324b1d1a81b03c81a76bf6517a9645f5f53a8f5865ea278d95d675b25c1def5d818fbdb2a7d497bc3a0645d4e362ede1b4fbe472e6f4968d92d30ed475e55205fedbdcf2ed46bc7386d05812a7cea540aa6544525ae423bfeccad82a6d1269c9c19b8c58ce6a1565d0dc54853d32962912f3c7508276e7189686ff49436dfd80c36d9a4d8b41e0845082ac538db51b5b11e2fe23756c2360f1dc4fcdbd7d2ea2e714795baad4c7aba58ac00566b52c36951be76efbf083628a20fdd828a15e0781faadf32262f09f017975dc36b9639bb705fb9e0321a05efeed7186e96d3004b7238efc015503aa15d81db812a9876870564d2a81632d30d4e09ad3b04b8cef2801c3a095dcbfe6b321f187a55a57eb42ae495d89a9fdecb91e3795c24f57f4b45d050847462505ba32e0de293f228d7452ef8cdd0495b4906047473a38a900d471930b29c1649829b030c025")
	expectedPublicKeyAt0B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt0)))
	_, err = hex.Decode(expectedPublicKeyAt0B, expectedPublicKeyAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt0 := []byte("004734bcf98f6f83c15ccd7d6bcb5a17667dc307adaccea712932231aa7079b3")
	expectedWithdrawalCredentialsAt0B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt0)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt0B, expectedWithdrawalCredentialsAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0, deposits[0].Data.WithdrawalCredentials)
	}

	dRootAt0 := []byte("f91e27ad241ffbd97cc2babb6634259e3e4461a8d6eebf679dd1267dced2dfc2")
	dRootAt0B := make([]byte, hex.DecodedLen(len(dRootAt0)))
	_, err = hex.Decode(dRootAt0B, dRootAt0)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}

	sigAt0 := []byte("42d95281d4d4e3075576611cf95efb45b3f1ca86cb9599b4d4658332d96f6a4b3c5dfc52d662a7deaf31ed517d869d2f0b966aed50d9a81b9ed93db3c3ea057aa64c9db437073c5077177a6b493c5c204b8a5a52f01645557ccd08a2910c055fc7fbf38505b880c9c0b06646019f05666d7ff3884ea610211f83a6c5127729d95427f8c5b1f7112379b34920c94ec7bd56c3604806967f5daaef9e720211a49e1a31eebe252805bdde3239e95e6a0c29f5838532838a58a795b637e07f2e6f962e334f02b120429d9dbeb57276cd56216659afc4efa461f60012295e569d454925b1ac08c7190628828d213dd882e25d7220cc81c35cc9591e3c7fd3b439c5993aeddc6cfbb4047016359c2fdd11f2f599df19e135b1836a948e175d5bd3af2f1e9ea2a6a8653dc008a5e5d1f05aef1ce8d8dbeb41da6112b567a5e6d6f3cfe3542e9b263fb881af2a9564c5dfe4262fee3efbb468223fba67156c34797116b30ca7b6b2a90aa8bcc9327386312dc6efdf595e067c0e7c9f13a4b7e84ad7b6ad7be191a0a86736528e3f781a9eefd01de4c65606c35ad35d5b4ae149d85a295c6148cbf14a8a6ac8620661952eaac76d49f8d4ec967fd14498e360e50989e9975012b3c81dbdb952960b82822c3a26e7d84b2ad3db4f4ce24d1e8434bb7d3b1a120bb4da84450ad7777e6c43aa9f142cb4010363ce36dc6537087a8dbd1727c1c376605283dbc5902a7ced72ad01b49353d1667612e0e445c5a106f63ac210033d0339edd9bc220053eb9a666e6839122f7f55b38e50a8caf03f4a8c49476916ee3cff29ab53cb3618fa9acafc0b7e4973587835aa48e58c143faef7a709058477f719b3c1da84fc61037fb44a668a939587bbcbdb875930d11e37bdb89e4b72e4f4b7acefb117a8de38b2dd299490e78e964c96e851dc765b80fab03ab061dfd11cf3ae09a1a4a2e68a8dd5cf3134590375f0dbc1499745aa6bbde3f63637e910594152076d3f12d51fdc6942d754b15c1ab0189278353f0db8d26c4475b78206c5f05cdf51845128a3506fa3fd2a04c3d335cd34152d1225481119b0561e8e4bcbe91fad3f869f8d4ec83d9d727b5466cdacdb6ec6725c1d17a6c981fc31ec1ddf0f790f66ab5c9e51c796d490c9d6a8ac0412f3e7a6f005d7719bf62571ce9e22c6afd771c25fe1deafa3f87eba2d60ccd4c491bb596bffc6b321c3c7329d6c145710e53782d9935034b64bd8897cf679b57e2ea81112742a0f7928d753f4fdf69a3fd5e6ea2423b3eb953eddcab257036bd2a85dc9505d40c1a21ca60b6a8c6a9d482692fed82ade1fe0deb263d42184d9d48debb0dad0a6d39dfc7472e353003c9b851afc9c89ac62937801ea9de3a4e39929a029747661cb29de4186d15a9e6d475a655559f017548d8b552dd5a8ad8c7bea85021c07cbbba903302aabf8798799bf1401e70bbd8bcb5e4b489478167836d9ca1535011e2c2906f2935cb7b3228a4c7bc32c2c8dae8c4146b79b6113e55bd221f2cf4f5512e7b5c3bb200422a23a353fdf9704756f5fc5e1caec39e0fd6c2d6b7544ec285ad231a1c16a970d12f8d0dd1d0d5e8e9aec166dd4e0d60adf5383c28d7b7b97a4100ca424b707f90663cff8196422b48023365ec4bdfdc0a9efdb046abc185f1d3c3d2d7bf427f27cc2885be3d991381ad799480176d41bb83bcd835d930e42d0bd5d826d2b9cfcdc7f4e53639556d23d869e4b5a3cebac639980e93997c5903b4f0c7d1ca2e6c0e7ff54adfe6939630e1f0123cff5c8f6dcb4053ae7b4430ba3a568685ca7c0b5676510af792d24bbcbf96ffd4bfdceefe45c1614fea846f288e6a4b3dbace2d8b4e1ce988d0942f1ddb5341b51d9243cbbb9ad6d281ff3c1ebe433b6c392f7d08ab1b4d8cc151e6b2a7a7043f853ed468a7917dd6dfa53692bd4bc819856a18652c55c7f94e9c525900e53bac9ccc1218cd1dfc6c5fc98f6e6f33c88258df92e013b56b99c2083deb4c63bb38ef1ec8ee33c59090f2664b13f15e4c30aa650424c2792a9e12545f13187d3ca08927afd6052133bbe661f9b23e26c9891df11598168c903f440ff558b3cf2403af25d1eeb7343e7dc7e2e58c0841c826010c71464369533b0b37f8d23e59456a7514682e35969700328bb958d9b322a9086df9d70dfff7fe97a7c6cc6f4cba1899ac1e3988a76844a0772c4a7dd360226734d745cc854627e9cbaad437b1240ee71638f2f349d5c22a58527d441a047cb41b33eb0f99e7e1f7026985bceef27fceccf9c06141c6843e80fac7712ec2053e8793f1ee9b276c0d0aec8ee9df190a4647d54f417413d6e3ff3f1f81bed1dd8b94c165d39d2649bdbbc04fa594d1a8b686f40c3226d100bacca86c6e860e132fa14089ab126ab9f1ac7fda2d3b79903a8ca35cd0ada9f68edefa6f5fc3c9706d89f286a6e0c4fb47bd1226c637355fe86fa8546ee4c8ce1db32ec74381da464f1dc5074e5ae5e3417a561752f8f1ebe860532c615f503ba514f6495cde3877e4032a75cd0276f8db311afff31c4554590da37b0729ce553de346ae6ece079ef3ca43cb4dbb0e084f90c0014b83ac60def8394545cffb4d60c57a566bc793271cdadf71a48691dea967211209da58075939e310eafb09a839d45577ec14ff29e1112b00e10e50c24f36990750a4c8d45b2fc094f6a3cd330abbf30de382ee828d4c59d36bdd867777aee97cf1452ed4b762bbe97f2d47fcbfca4c4d4e0ee1eb3e12f8e6bb4126294a292e64bc43ef72cb6065804b91c1e1dd5fcc0012b5fed04b68c887d886c7028d9a147b6482fa7e174218f051ca653776185bcf3f1f114efee640801203aee6e4519ca3bcec05d32d4d402dba22ad5943ef8a65365f134fcc08120d76daf5fbd1310782acf862d79cd966a3c61bfde7a6e09599b49a5874422049976d5a72c48f0e2d015a507d91ea0ee6d144e7e5d78a78ad4c3ec499b125429df1728aa67c9a419c0ad3f951660a81e0cc7a5e940694f1e0e25c359c0a44465d0169ddb48f2fbf09fc411aee4d8e590bd67605094639b05b71651757628707d7daad40ea01080ef672843a9874248bcaa9a9deaed984dfe4d3e6a349ed6f6454b67341cf78929fd728a5228fe24ac4ce4f4a2fac9d5cc0e093b6c3bbe26f04455974d6f90ce45cbf3a400e2e5123657449cc227b28c2c9f7f14ac7b76054a28cd110068188e974bd0b1afbae6ce48cd1c31f7e81f1636ef0dfa8799ad36af236db2d5cef70f005bef67c366be3c4e990a2dc5c2ab44994d2e31fbf105fe8bb282e557647647f48017be642588255fa7628dfc19b6afcd514ec5e499fec54e2d47b4d33b8e6ec190142054f62925c9367407948eac4fe6e1ee05c8b03242199f95273d6c3f38af4d7c9799eabb56bbfc886c21a2abbf367da9c2ba5db8f29e0a83a0bc3b9b1435df69c3dcd47a69d08c432fa986ea918c3708944e3ea464f96a85c5373a4804e85f16ef959e45d206ec6650c6c42203999b26cf536f6e3cbb3c224fbb47501a8fbcf9bff6744e1c0777465f6f897b7c25743fbe5dc379c36e2d00b5ca6d5c1d06c741ab6371374803e0a4bccbf1cfda544ba9d0d6c9bece8e045dc9171624e7e316bed780da17621b6b826b4261ee06d794018933353f92861485662c13f3caf5702b1743abb7056a47dec83bec2076cc20828ec2efdae8e019fbdbd54c86feed1a3363284a6e544a3d168c268b78c2e3a0af6c8a54a434cbdbdd9ff0749820372afffab34bace21408088017b291ae873b8a6476d961225b4494107777f2bebdc25a26953d54a3598a06a96b5653606bee30c2bd748ebb6f5055fcac4353f77e65995aa3f07b17a3fcd85bea6e25e82c80178d9f8ccc9639cb9eb52f0c63f78c7828b0946e28e5c38a5c811954ec42b12bf1a8bdd827dc565811a1babc4e61e8d1e46b593b7b6abd9b99a4473314311e50bd9324470ef91933be9dc9ba2f100c61f29dc77f0493fc047d36ac993afeb1d50a423c02fdcdec268d763233559e12cadb1dd1dc8be4ffe14b7b19d3514ded84ed22e37a25510ccc82ab7f4557e84170016145eb599a03cb743cc298e2d36e8493029ad91510f4f24c905ca95b1021d57fe17ee5bdd54ba6806e5c6c135c6b2425c9d0f04b9fcfb906fa68674aa421dee750be0050cd2995c033029867fc10d7bf3f5450059ac117f675ce6e27edb2404e6990ee8104bacd8d2e50debae072b2e418dc2343ddfd7fc00a97b590dc51b72610a60235da6c98b7843e676c78304a0eaea1dacad0d772147a9e24c03bec103c5cac6d0beb9ffc5fad991ac0e09f9f6abf9ade44764b6a092b4ff2724b30bcc1a8cdb69a8f8795955af33e3057295747c9daac3279063ddc9d34043528fccf2484e7a0d869d8ca8938ea4ab273410f28df84d1af08d81efce17637ceedd8884bc313e09aa26622a1232ad14fcd4dc3924f4a712c40b01eca187f68c3096796c5e8333d9715910f006fe72e92be171cb141722e75acf3423a5b0aecb0338eb8a4fd0173975450c465776b714e5a338611d67a4bf2a9624b5baeb4234402a64d82bf49f8751b8ebccf2fd08d8ccab72eed28310309f9da296574badb9bb6c505c7d5e0317a3503df59e09f4124645f4b0d1ce6f473cce1ce8968ca90e4caf6212d7e8cc101d34e41db6b9aac0540f83ee26411bcdb8bb7d022691946f6b7ae6905cdb003addf99e9b2931baa3c38e341009a172fa0c6b83404160b35c42f60b79c3136730daf95ca69d5332ec1a73440ce6a3991ca3fa12444f62893371a0c258d809b02ae45c65be330f1983a4e5dc1f79cb3625f8d28576734e591a9cb1ed282bee37e04ad5fc63cbdcf6908464f8509fd59d3599e09d0221dec3a8666bc37ec91404364d0a32a9d4e4146a9ac3fd70c08033fe84d3bc5f4284aaf99c05b0b6a4c338bdd6e6c678079bbc0524e39dc91fc300d1e8d1700ba44efe3009df01b71e59f5a6fe6a63d323cd838df2eeed6071fd0524602fb63e784f4316ae42c1197419ba1f742bb40e7d299ae1ee5f5d259856baf7c36d78a52757552fb2b6d6354ae2fac333212a8b88d2e047acd232689d4dd5b97666abb3796e790a7381833966e423dfe859d205857d58df4377263b3bb8911d9e459420aa2de88d1485326bafc0f4d7d6de9340f65eda759db7b5bd28d10ee05f061b6b657bf60ed8afcf0d5dde8aa82821a6e637c3c21024d7a880e7f66e2827564a46fb8574f10765e6e650e03e1f62add5d8c6912f264dd40b074b695f42073af94af40ff87296f25c984e53eee7ee883bd7e9d953f4bff65f660d26ee3cfbcaa23900555d93901378133cf60ae1b6f2f62df07434df9b5db0d7a00650e150bb6bebe16ea69cf65908666ccb47a0162982aa09605b79ee2c579949fb94f86a74844e5c16326f4e898ccfe3150f782b67d96c64324cdb177ffb3ef08653127bd3e6b9c8061a3fa346eb2a3af7328bd2fc9d5a032bfbc5fd049d776109a5f7906251c7e09422d27f1927b21235c6a7861bd12e92f2f92e84c66c67bd93a5251a2a7a0ced11fcb3564d9ed1b10e3a69d9e6d1d9ea795daa7ee3ca3e9b52862d59941346707ff47b9b13a7457f682ad715390c7e4d0bf37e2a3a00e4568aa6ff376cc80c3db0f1550e5b3399ad2922833a8cdfc0468ecabc58f6e1afc8968a1a80c372884363c4134e46a2c3d6c88a6bfadc1c74e5aa582d6726d3b38b6672e5f61f659d940902d46a39f5db876877d67afa9a682214faf52c3ab868381afc006c285bef2f733ec4f128ebc19e6a6b2ca76f42a7758530824b2be235fa83f5ee0b993b6d601ded4dda9b334d85ce103e707f43123de26bc8e90c79fa4c33374bff890df4bf13daf42476fe1a212bd20df865abe399165bcd7c319a9f5577986eb2564abe294edf6041cacf0c6f91f697a509faed43153c4d5c235f6307098c93d4817df1e9dec1e1ecbe95a47a63cf82f2a75ca016652c6229be04146939a28b9a2ec8a94eac20d42581bd7a77577da1d39c7dbc666d7cb800f04ef4c4fb828064c5adbfa112aaad121f5baad195f2d4ff35c41ae92cf9ebcfdcfda029a1476ec097b3efe5a2281249c67419ef8e9b8c4f41a6680c4ab465c747c5e69d56aa6e14d4eb197e35ed12e0145a2cc18499c5d934762802207cc66433770fe65416dc0b4dfeb9f89ccc6e9030e1c4ad27b6c87f5b9908e74e100f97385c6d3e5d6ae6a3905d7a48cfe9ddb2cafcf707c5a8ed5b32fde798338c1e9ec0caf3162a14f769ca0ab9d887260fc57c3ce005e074ab743e46fa346b51eceb0d3aa5e77e33dc3a08617c955ab713c9acab41e2d2b9ba0b1766872de187d9df92faa8e9cd1c9b1910e30495a86a2d4eb0b19343f4e62638cb3b4b6cd024c4e7cbdeff0040a75ec06143c3f7ab1fd13225f7f94c3e15d5ecad72188cff3000000000000000000000000000000000000000000000007131a1e252c3034")
	sigAt0B := make([]byte, hex.DecodedLen(len(sigAt0)))
	_, err = hex.Decode(sigAt0B, sigAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}

	entries = 1024
	resetCache()
	deposits, privKeys, err = DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, depositDataRoots, err = DeterministicDepositTrie(len(deposits))
	require.NoError(t, err)
	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	if len(privKeys) != entries {
		t.Fatalf("incorrect number of private keys returned, wanted %d but received %d", entries, len(privKeys))
	}
	// Ensure 0  has not changed
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}

	expectedPublicKeyAt1023 := []byte("5de694585e91d95c86a104a9f66cd685c48b60fe9c79403b4979c1707238980bdf27893e8be214313fd4655ff540e206b820ab741d859d3f6182e07936aef4615b78d5d03d89be306203c3314bb2bff2845b809457653b7c9fe268a0df86bbf84ee155a2917236a445ad1b494885e1f206d845e952870524083947aaedfe7ffc21e67d2e883bb52b3f87f658c209ea70a3b78caab780491ab874d1312af2e93dd66e0006cfc930d7f4d8e3e558edf2befb9a684429b19c3b6e936372ea3ad4ca182bec8dd09f208d42b4ae336590ae4969f9aa469f89e28481796011cb97950185f8212b0c2bd9678fc5c99e7b73aabcc4632a544f12b2513101fe1288409ab4dccebe3554dd9e767ecfe8f6972075f49d78215c9bf328caa4dc80d9684906262a7b6f9cc2e542830924368dd041ec227ce353b0ae7ee20aea5df37d1a3af62e0466fcc5f94fbf9ed7acbdee421aa9e1d1f779013c8ddcf9cbae4ff46140fd94190e86ad8ac4472a646713138f851d562ecf3352e2ea818109e17651a600ee2861cee0465b0844ba126b6e7c96cbb7b09c233aaf4493df573482ca2a2e825e1683f6e31c15245db48b268c65a51fa2ef13335cda2898035439a49f1c4731ec87aae43768a6772503b239633c542665d2b1940565969b34b1f311fbb57074a4bef770244ad46f23c644babc198c34f4d3ddfd5f50ca7a567faca715b187c31f4970a871db296dc5ade768a5ad9db45104aeaa28cd278733acb06e637ac7f5fd07a381a29594e2c68f119ada586e7e1378a3f489b0cc45443a993b40202d284c993714fb4e88864b5e27153b6b93d3601d72cf161036d1c63a753ed67e20d5355222aebce82cef8fc70ab3b1044a45f68ee5c67a26920d9cda7efb1156a31192ae0b7864aecae8e2de037f9cde4fe83374422cfec1e37126d9afee8bdd3339ecc262df7825c5f66d6062865d92666194c2d26ed65d46e1cd200290b0e3bf1bce545d7af8d132304f2d985ce265ad70b8a5e5957c4fba4ee203ab5113c02485f3a78267ca611698b597fda64bb2cc7699d619ff8b4b688d23afefb8283768663aa91b73d870c01692fcd73e223960696b186facfaf353429ea4c03d8de631b46b36fa9f5748f80361aab75eef011a203784e2d73cbe6bdf53c2fa4f7ca9e76326bc2081ccfa6e3675bac97701fb79ec8c98de7002a845275fe40418d910530f714115cdfd540ef36073fc58b106d0761944e95c1400fa66abfe12d292ea1f323e770c0a0a858ab5bababe541c3466ec2f6bd65b7625f82f09ac40f780dae07be533653fc4ddbed97753af16b03c6107cfbaa6d3068e58552e7fe2b6569c33de9e60a395d4c44b6ebb7319e351cdde35475560536baec8032a7a5f5b55abac9b1b3c8d448c530fde8523b25960c21445942d84891ecfde2c39d580a5b89e78bf8d49881e9984fa7205600091d8f4c8aaf6327d03bf710c2c65d05b3a218f69b855b075a2ed6a46b806f6a38a04b5e89aed4a922b4524f182c32e3b41242034c4bfb80bf0472d2e1fd688d153d8b40a3f007b50deeebb99a1bcd568bcc6a703d0c6fff2f4072bf827c401636d7f60eddd56769b693e0ff50a3ec8be0e031f1d01f4fa1eb68f0ac9df4c7e4b1dfb56fba91b8ef8b21b706d786c8c95f447df11ee8c4f9175af2149bb968bdf7de0a6102be3d7445177e9551e20653de4d96624f521a9cb85279cd19ab46e84ec8d1abefdd2ac905aedce8d1932325402d50b4aebfdf2259a717a41f03ed76dcaf769f9a3f4550b8cd3cb96f3f7b02f64ed7fa15284afcb347eafdbdda7eea5d65f3fda3be850de0ba4896ebb02d9d30291ec75f900c1234ea07b67170132ba2d10206c849b90a8721cbba1b862488bbabde68d95ba42bc94e4c5f29ea69b770fdbbd5c45d41dfa40567d7341bbfd3397769ffb93b7c8875ecc5e238d03bd5282bc99b0a89d9315704d9e463da2766b1e635f73fd60ad9b3aeeb41cdc8c4af4016e9c581744860c5dd5d0b53422f06197773c7b1a47b67affadc0d066e51349f9c9bf3f03cb641afc4a55e8b175e8f250e15a7a6c985969d568f4f212210862e4608b73b62cc94166511621c8bb91a38a62962768e896dac201d2d6823f9526397b8d4a327a9e2cf06c0ac8ac0de9efbbef679c2c5d10283c85da324d79681c20164b60831e26f7281e28e83bb9eb09645c5b7fa76a28d80d21ee03070554539f118615c5044138528d49f83ba789c49a58c1c0515725c555256371227bd8c041a11bf46af25c8534d3e681c743070249de2649c837f7305c76fb4a6d3b0a3e76430fd34e793e662d38df96915d9c22423faa9448ae3bffb18c7e4734335d93d9abb9d0f1e40cf5249f604d2bb5c5b5277485a98cc3d8292c41094cf62e1b1322739d7482fea2a43d8003a81b3b09c9957cb3ba7caaf615deb9bad2476f8ea19c6e4440ea9dc8fdebf5f2b23f5ff34c9150fa015f3e03a50dcce811de1c007e77a18ef069b034f9119f1791b6d891e7fd715097c2898174f72f7b7c9cff784cb67fd714fc18ab38e7cf77b1635e2a0963613ba77fbbab1fea21ddb814f5a9e85cc41f33b838a8b03d27b376606a0eb691da3540aa0b981a46588ba092d7fced9dc877ddeac0e3da6335cad25270c5b59b13274bef288b8a02b02bd07d6924666d1037d7787aae2b1b8bb694136af4b4a3ddedb1bae1f75d1351dbf531770f13c93c5e852d9ff3891c7e13a8015986d220451a58b4d835a03a56632545350419d6aa97d2b91668f95dc92b0144877c9661e1974afe92c8460b1486b04ab32a4501f1287fb9cd431129864b1604fcfa692033923919af9e4fd1faf110739ef2d263c4e1adad18acf8eae4686e24c2b0e793619f50a7cf075ba3677306c5076a23f070708691fd592dab4f3aec2030d4456b11a9719fba80bcd21b9ce5b2a5e39272aa4fd1da29953ab316c8033bddea4405da663e41a4091021a47378fe2dc60915dc090e1f831421507722e138c66e026f4fb580ec9e7712ef76582c795f77182f58c1b17f995a2b26cb8f65e2bd5ec1235f2de64d1d4fa6177b763bf680aba151c5220ddf953f8022b0743908abb1dc5b656fc3f68bdc7a3dfbeaff3ce2b1ff1b0834c9696201722d6fd62ea4c39668e0d40e681fdee965a4f4e7d1b56ee60c677d8608048b68c0984337a7cc62580b95e085d1550156656cb5208daeee7d0e473a9f9fbf7fb9b7fd9ff90a4d8d11e324992909a21d8e840b6f6e262f9b1467fd4ca96636c65ab66f5da281722361b54c810eac681fc43a84cac6ee1859b302cd52ed18818ce5f500f932fff60df1d502955757601f2a6be0bf3563f25b078d44b0fb55baafe2bb3ef90c7e42b3d8011f4b813009cd44a3b7e24d25eb45fb488a7e9a34dc0975bb6871dec843403507cdc90d05d7b2a6df4b54fad28626785064820d3aaac34bb52b8610c187d3c366f9bfebdbb92d7d0c206efd7e11c507444d299eed7e9eaedde074c957c4bf488309dbe9668be43b3e73df635e253c909fb06f0f0d1817ed3c3a3a8a5263af846e4a6324973eda916007dc94f0d8639e57fe9eae342eb209ae4099a0332fb97c6f811495549586370c93fdab5e6a92cb62e2d2e599584f923668ae84df0676bb08e12f13a2af1283")
	expectedPublicKeyAt1023B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt1023)))
	_, err = hex.Decode(expectedPublicKeyAt1023B, expectedPublicKeyAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.PublicKey, expectedPublicKeyAt1023B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt1023B, deposits[1023].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt1023 := []byte("009560ec38ca371e316dafbd545bce01bc809cede91bb7d9310fb64db8dba123")
	expectedWithdrawalCredentialsAt1023B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt1023)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt1023B, expectedWithdrawalCredentialsAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt1023B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt1023B, deposits[1023].Data.WithdrawalCredentials)
	}
	dRootAt1023 := []byte("8355e81d7a226382f995616c82e8a24b3650af9aa842a3543995d311e65dc85c")
	dRootAt1023B := make([]byte, hex.DecodedLen(len(dRootAt1023)))
	_, err = hex.Decode(dRootAt1023B, dRootAt1023)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[1023][:], dRootAt1023B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt1023B, depositDataRoots[1023])
	}
	sigAt1023 := []byte("6abc6d5fd043aadd5016471056a61396999365ab71d75139d8a6c872e1bff85480a464fad0b8f80dfd3d6c8ebaac03558f441f89f0fb7ac258383815bfa917c33c13798e57ea7a086d96234da3ef4eccffbd1090710f83ddabbcffdeb0729486d5bf667128bdfb0cb159f1d212af00de79e42906689370f10909b0a476e0b6c7bb1190cb90a4a22bbc4016ab5f073071a24d8212661f2bc3c38a5adb19497106e255dba9480320d9610e5d31bbd056c9521d7d8ae4747847c9ca5c882eec2c733b9da15eb2da1a2134f7156b094221328da3d9c8bd112479ffa489fb039f9d08f40ce5f512a9fd77172b47d52fdabb0afd8f9059215484e8bc9db48e948e32d397be2789f59d8cf49fbe94971edbab570bc6380570ae9777471cd3b78dad3ccf774332560ee3890c6b0feb65b3b72821b8a3a5cf5ed0795a2da7859014c2a4b1fc3fe5ea5de516979ac1e48c6e243ddb982ed04f52b7a5043411a9ccf9b0794e016ee7e04439ad83c9a17a6ae7e9298305afda4be42986593d4ea7712b62b539a62130121358ac269f7ff9be73fee7430338166781830a3b13880b5d1cf9f6745d6a42a049755bbfd0437e0bb0ad462effca2b4d78d5794fc9b7baa2b9529a0612ecc64810e30a0d9a761178895272828aa902fc7db9e2573fbeebc901d02819cb869791cc1b6e8930f72c16fa6113c670a97300f7f907cde265ae81bbf26482f6e60c2870a3dec7fae5f00b3e9573982bf3d719e87df792f437d958edce99b892d67cd03c346b55870a50594a1434b6df8846e7082accafcb693609013736fac0fc785a5acc60c670f9207cd0a5b0269d0d34eb2d1bb6d2c85a9c3634e909a5954e6f47c98ff54e2e981c495d4f8c142f52bbe910d8a34e33e627cdcecba42a4aaa58d95021e7a3c50c2a036b6b613a207f51bac631c76bdc29ef73b8bd3dae7151088a59aeecee39f69b6d391028af102db879d540a7e095e15098dad3666825201e8ff5088703bd54afd486519ba53313e1978d3ff3321fba7457bfbc468d0036eafa2515975e89acf24299e20ecc71a5e463844a2d0be601125d0babbde3228e4a72acb457cae4bbc6d09630d4b173e0b0508c4b0cd2474fcd655779b9d4ac6052f653c856092cb5659649d731699c542c9a34a508524af1b55341efb490da4fd563aebbb08fbc8ca1f326ec4b4f08c0f4de508fa30e5d976771935ab59af7fad871426d5bfa9f9c659b616c7f1ba734045605c3d1a4c0c2df784868b6e3f84bf81526890855b6957628fe897d78bff053be43940e96363a5a13cd078847af9ca2b217e06e5fb74303af94fdcdb81a7ea9139c9ded308c264cbbd4ab7cb5f4bfcc4b135ec57b45628bf8b72c6524a81a8faa0d2fdcec4787894249ee45592eb87606b366879f9839c4034a65fe817d103e47decc25e5b37c696ec985e39d54ec3a3bd29b91d249bcf2c29a35a5029aef6e0bdfefe54ec62985031da23716c981f4614e65d155c4dcd936cb47104cd805e5dec0b77642104b3ca7b134b09732d00139107458248d90777e2e708e352242278118d321aa3d13e4ae89dbbf0f7d4483869c5622293fcc762b9f38e90f2387ba94653844450b55e7d0f4a5cd620f40de6d8bdc5e030aab9bb7ad73dc8d9163d37da5d893942bc24a1c6dd912ca3351e7edc2fd7e890e908ec1690c92db265617cc20983fd93d917ccd9df326fef69fdb8d6270411d8d4a0dae83776a3d262c69bd1086918cd0b4f3bbddf8e81283ce81cdaefc11acf762afbd3f818525de42d95af2f0746402fbaf8f0647884a4fc8647f05649f25ce00a384741b508611796f40ff1ac4e28a0800b95fb475f0b074cdbef33bf6424036d3334a4b1f9e4b7bb9228aac53dc0e004c63a0dc27a7e2b881df8158870c0b9a3df7c2989e640e5bba620c4b299c7c0951f1d071372df9a65b42f42891c232cc1aaf2e50f7205579191d2874874b1f2aa0c39581146fc70f245354d2426aeaeb8068b104325c146e594aaa52abb015b68972385045b06f9ba474ca5a546ea67a23d3b0f223cb5016eba23f0893adb18015fa323263a14dcd77f821f7d3ba761f1ac87a78cdfb64e459c28fefc1710ec47d997bfd97a59d0d37559d644c5c0653cddfb8f25ded27551796add0229265f8ca35d94ff47e14b5285069de2a523176d8dbd3900beb1a243baebefde1bff1a44d95f2f95d412b6d2d71411ccd5728167d7984dd8254fe944f978c478bb8fd2332070971263ddd1b649a2175b059d1ca60d9e060183f793d72a7dcdfb0378f219ce17cd8b87f1019e8b9f7ec9e47be72c4aa6e955906191336e74cb93711fce071397911c9b3a08e287bf2c1a8b39aab53443dc207927f7b5fea353416abad6363ceb04e02374f22fdcb78aac9ea7d913baad06e93727666954a2c7614a1cfc200fef647df17a3d2f2311cc2da016bb636ab45386e85d7abf44634e4831bd1eff1930cd4becfc870d1f28657a561ed0c47f6a1a467a756096a7428455bccdd323c0a8985a2577b56a8d51d47a83faf5bf4d95cb7240a2619c848b69fdaf48117037b53f0bf65f8a58b6089d2d5f4415a94bb7f97827508beb049ec6c2993a3a7588ee61aa2cb1a817c494e50eb40fe4b0c902cc2f9825717e01aff3545289186c79eace7a7bb1d17f90aabe8a3db1cc07734c4f763583650872662cc54eecea2d6143ba236bdbdde3450b86840c7137e837eb3fb14db622fb39c1f524437b730191b98116ef5525e7ec2d6b8e8a37e9852525df5cf15c0112d0da1710f6b0759bdfdf93f9a155c3f7c98871a5a829ffbfde1267ace03459d8052c7703846f371efa9543261f4cd1e7a653930ee4c0ef89e604b2495a653ee3bb1255b5b0f20374b2c1a383d6d2f186fd794f3060e115840542ed8a3d8797476b1a395aed288f5038fa0ec6d4a321ab24e09f698da4c809901c97dd323356e3ff0d91fef0c6a830f9a264f64b2175fbc711992baa55e59c3a580a2373c7547351dec1faf4d1ada30f1bb97a8a7abe901d903d92f3729132dbb6a7b8a92e548b956b92263dad25f053d401ad483f62b10318d85aae9fe0110bddd11465865e9c078b95c4f0e1d5b2c9060e6109711ba3c8db0abbd4796723d7930de5f31dd013a0f5d236bed79db4a122ba0cd317c7dbd2c98ec50a909465f968437c43831cfec995289663b02c2c8fd0c68bf75cf307c4d797372af4154140691535457991867cae9a4580b1d05ab5678a9e8fca51d67b9415655921e27087f06c9ce5a9594ffa310cf390610fa7c5ad9e18b1c6f7497a2fa9d44daf0ec002365d9c5210770295e2974673a6b2788d769f9a768ded26cd4d36a7fa1512c36cc226594c22ecbd7c6242069d9641baf90110e8788b118a16279622a19b8368feff04213693884872185755652e134eaa20cbe7010cfa7d0ab5228ea036f23acabec212781f556be39044ee405825b700e118cc8dfa89155587460d3e7d8e482bf81e476552ddc7a06d35b6422736ad6f91bd0ee8ceeb2fe65162dc659b59a822559f4bec9b59766ee2340dd5e8664a27d712785e8052eb3e095881f85be2c7250dfd1f097cddaa762b3b0e2eaadbedad6f52859dce23cdf32eac1c39c12d0d2cd6cb30b6c354b91ec2d4efb1a798c79e4006167d6e5e31c3365fe2554dc4caa95e2235c45365b9b833dde14674d3aebc6380bdd076a441572359a0b6f56b2b966dd0d58beb170a9c00da09917e40beed845072d82eb01782944c60f73928d5c7f3e99dfdb29c5a6425d7005465b5871dc9edf6554608be91edceb87748a1b3aa5ae640347a6daa13615ba21d274d5b86d19d314acdaa061ab8d1b2c22f6d08d2cf14d4233ce80d6c1327161735a20d703c424546e05fc69d3e65e489a1bc90d2fe1f7f8e0cad2ab6f1e1afa83955ef72d048a05ffd60939c1970c766c5499a628f60c4e241149b2483947b738fa08bbdc9c3aadaeca1d2c5a61ef9f83dc122110f84c9dbd5c466b8a8c19d7c163b932fffd5a380060084a19645ebe7bcd2f8c1cc8d3fdb3e118cfc4052d929b3c04025eab8ce444f5135a1b10da5427200cead56f5bef2f02573bdf8a9b1b563656bf3fde46cfe2a3b80a11bff44ec0a54bb8fb71c685d5a74aca737b4adc4fb09526bd112ff2a2ae0812160129419e4c6b45b33bb61339805e2938906f605cfc6ba93f98d3972df473bf7f95c03149a349e3d08d51a6a37bef33db5754c36521d1b7cfbe838a376cccb3d1871fcf1452ed6977808c4430247db77288c3328652a032237eda319a1e7d9f8c9ba63efb57831383c4d5f218298a7679a2e223e41da4c3ea0220db8e3a8ad0cf5b58e9cf94ac6d36c5832f62442e3e85a335401e4fbf6edf4dc00167fc22ddbd44cffa43516b55b7a2e14d456b5ae8ed540c235e71d71b7ec32887db47f01845172e6497705953560b2397d78ef4a36b60bcdfd49daac8e9c79201b4727e3a39cd92b4eef0c70bbf2c884bc3912573f12467e83b4a244612eed338e9ed829f332cfb5a099df8f601d277c0955ab450d7ba1ea48b7c3c6453c19d2ed26278cf13e76de7955a0ed6db712f8a4fd8162158e2be7d2172171bbf348e5cb93ac7acf8071e3ba47760417111ec9b2d4ba7f6ecfed425bd4b56d7ba05041a18f3c4751eed3f6fc22126fdc0294fa52f89685e8ca60dc2f94c8d69346751c351a291765fd27cac07e67b5decca08ce0b4118c7bd346e75f432a6c984ffd6436569add81139b66f8bb919ed2a6d842d68af6eb149bd7e22eaf8393b7618fa52da5a3d6deed469125b5eab4b40b7bb3d256279dd421d8afdb6397a50eff8443fe62e9a30719fd56712483d6f421bf82a26c05adc00c6804359c727b28e60a6f53611e32838f5a0c4d17a9817c60e769eafabf0b04fb7dd2152856512d640398e98d6385102967c300adcd9256dde3c1aca47b2ec148cf18621d46314adca3c89c2177d59f6804b2ebc0bd4df74e8bcb0e2e2da64b246a0eb7042738b411bec1a2754961bb7c14c4adf45804a179b9079de13e8d7f3267732ea6284057780f62a808ac38dd9920503b4f6b583c1983e5cdb56782e49b466b6d78d6586d7260b1f0118dafef79b0d6676fab4b254a3c343187e424d0aad931c6c1b44c9ad367e215aff75d86c8ee8a9c2dd55fe52253b65d9925ef71d36c70bdc87cd07f8221e16a6ce5d25d5bf29bd607359ff72f869aac81056c0c30168f3635cd4197946dd59ed8e5bc5da60013142cb72c1c14101a8312192e3b469c96939171ca5ffe111c73a4900c29ec0e4d8705e08e6168cf79b63729fb63448517155d210c4c46d5f95a09c65b1807f639feceaf06bdc7cca710e46ddb7075d791d98db4e508ed08f3525d56913010a22b33ef91d637c7a017e518f7f52fdf8b68487240068cd2d294e260c2f593b95d75bd87754c77a64481ec38af6eaa2983957acb638fa765d3235a03c3605a97ab68b033faa398f0eb23a2299d4179518177dc2750b34fc145c4c6486898797e265fcf7b275d192116ef20dcf85d4f5cea264781ab4ce852143fa6eaa4bc2a9b4c45e698fbc2cf0dc771c7f81fa9b9ece393607d1c404982abcb52c861b89b65b338f42e18a0281854a13342229047680c2ead8fe366c0fb2ea7d1bbd8a33237bcfeb8add70ffa8eab99d90123f0778d1d40f7e58edde23378341af67f4ff92f5fcd4943c826734719e6cb14d91e3e4dce522cf52841fa0d30451beebfc4fe61172ef1dea069c54791a54e62298132ba97e6db54a491f12db0b0ec103378cbf75a9daf9c68066a75d3549fd954dfedf4881176afceebbdc41f8db0b3436167ae3332324a7b63442f2b62d379aed80841259b4984b4b10a7ac2304175ad0fa2685e9bd4f329a9ff2e528ca92eafa5819e40eacc03199f9cfcafa88e3504079f50f524057c42106caee0b207627db7e2192367e138dd3dbf002d1e49c90f009be8a7fd1de64f887e12eb5cd43e365e1a1acd0cfecb6d60df7550f0d42f05a80ead8b1833f801a3df29629bdf318d25ef27893d1652eaf9262b86571e98a073cde4bf960cf25cbf213ef11ebbfe7d358894be7c3c47c9bfe8bc5a7218bb95d57d48c030ad3da26d72b13639043158fcac7556b3b130dcf9aaa03b42b50d74c305ebc8209eda800b8d0ea0e32ad241586bbd73b47c3d42227b118604ac9bff4ff4ca0c2e71dc62055c6e60d93d927ece19dae3ea16c8f15b1eb4c49eadf15ea69f8cb423e6e8ed6069453f04a1f10ba5f36af24c26c9b3054dcf0f8e30fee7cb45953bddd83329ee2b7124fb175329a4d305dd31dfb92365b1d4b723d2b812eb97db25819d9c15636e110c1fdad5fd0c772bd772c08e6e91fbd39dd0ccb3e557e932051dcf505229fa1ceecedf20a0e10132465666de6ef111f36499a9ea3e8f901272a74949bd00e274a67717dbff9fd4b575f727d84a9d7e50000000000000000000000000000000408101a232a333c")
	sigAt1023B := make([]byte, hex.DecodedLen(len(sigAt1023)))
	_, err = hex.Decode(sigAt1023B, sigAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.Signature, sigAt1023B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt1023B, deposits[1023].Data.Signature)
	}
}

func TestDepositsWithBalance_MatchesDeterministic(t *testing.T) {
	entries := 64
	resetCache()
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	determDeposits, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, determDepositDataRoots, err := DeterministicDepositTrie(entries)
	require.NoError(t, err)

	for i := 0; i < entries; i++ {
		if !proto.Equal(deposits[i], determDeposits[i]) {
			t.Errorf("Expected deposit %d to match", i)
		}
		if !bytes.Equal(depositDataRoots[i][:], determDepositDataRoots[i][:]) {
			t.Errorf("Expected deposit root %d to match", i)
		}
	}
}

func TestDepositsWithBalance_MatchesDeterministic_Cached(t *testing.T) {
	entries := 32
	resetCache()
	// Cache half of the deposit cache.
	_, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, _, err = DeterministicDepositTrie(entries)
	require.NoError(t, err)

	// Generate balanced deposits with half cache.
	entries = 64
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	// Get 64 standard deposits.
	determDeposits, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, determDepositDataRoots, err := DeterministicDepositTrie(entries)
	require.NoError(t, err)

	for i := 0; i < entries; i++ {
		if !proto.Equal(deposits[i], determDeposits[i]) {
			t.Errorf("Expected deposit %d to match", i)
		}
		if !bytes.Equal(depositDataRoots[i][:], determDepositDataRoots[i][:]) {
			t.Errorf("Expected deposit root %d to match", i)
		}
	}
}

func TestSetupInitialDeposits_1024Entries_PartialDeposits(t *testing.T) {
	entries := 1
	resetCache()
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance / 2
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	expectedPublicKeyAt0 := []byte("b755417ac7b0a00d7a04ccc9ba74c5bf46213704ae6c366176b5c92dd6c209331a23b29e4c22f8db4b4c8f90c69a6e6a14c0ecae5abde6f6e6f03a41154ef97d49f55ab23e1e421f7dba88182c8ee507cfa225ddf6fbb7e5d5331dbf21995313bf40d127ca8889ce06fd10b848f83bf6b0b7412ece6255b895833c17309c39af542eb6a12c61aa788dd1dd054c8c6630e80e34c211f107c7c440342f3a434698d6abbc68bb80e98694f720e996872bd049ab12d263ac63fb63ac100c5122e1b69ae2bec37850c38f9db50928facb0a7bb39a4205eb1c7f2fdabbeb32edb17eaa9fcd68f43eb56c66e829ce95bbd86545e22f138df8b48816543622bfdb0fb36079ac56cbbfeffe6b33781c410f51dbb2188d47c924e0d4c2c8b55cf37e749d28096df5cf12256b0d62324140c4bedf3fdf75360c6a00e441a77e57e5f26e9a5786adb75b10d5d8265038eca3fe6f52568ca4099deac108604f932f793eb6e8962ec4372a49e288c488f94096b2fbc32365be7c24588dbcf83a963973a3f1ebf151fe3a36dad00bff7e72af525bfac2422a0431988289f10530c8d069c7dccdb4ac5b68981f7909f15e5faab4546d53855ef12de6cdabc1006ded7779dd91f0615621b9f7b2a5945dd044504e7fdec80c62c68b16179ff628f9f6c59398d9dfa35fcc2a40022f9ed19cb726c3052076502ac5b34ae945065191a0161526e750942f4a4a7b05695fe7f3cc7f4c22a7254063f78d80f5da1d9b737a642a59ad16d955e118a1b1e68e7fc83d198780cb37a84da1095a96c1bef28e3cb8561c4eaa05647a523df7b1d39695cd5a47e51e4e75d865dadefb2933404f684422400de0158c1a8f2dabc8b87ced747de591a68bd0f9aadbf90911cdb6b08f77450454d005129c10a9be844be3ad848b0a674356c0d31b9f19acf45a9781e85bf1a6a2b88999313bfaf816637b239d4fced92293082f649dc3c48ff0443505e63dd948f53dc867fbb523faaa9b6f95e6193b18b0bf3150b35564acc654ddcc6c8122fb134c4acb45a6f583ec5f8374b5b118153271aef87b4986d76f2e6996523cfab3dea3f794fe62c1ff5736fdf9d13295c8d3b29fddc06200aae6383aa3b3e9581eb48131d27b834c0e903e9d1e553afb56199ea789fd475da516b428d655ac86662dbb26a85da97af5dbf166a31cdb6d6dc0cec8137d75ba3e892a3217beeb4e3de845f2e762ddfd7ad1c1cc846dfbf0b75590268347a6a5566599352661e25149058957b0363e82e0e6b707d72d2ecb4f7742333586aaeed28a52f905a111abcce4fdb3950b6ee09e59ef42d5e156315ef6c3a0b3de5d0643b5c5b020eeed54d2a8e619fd15e35ae182cda8415292e40e52af5a6434187af39ee73a5ddf70d3db69de5c54cc24d1e42071f39ef150803d37550a34a4de0bcbfb02e668f7323ac7293e0d743a383d9d6120df38db45b38542e0eb3fb2d73339d523cc2f2e35f6fa2de260de4c8191a242a67cc08f6ee7ed4546c8c2c8883516f1c21e5432a56850f7c1ab67fda639424d5d5ab5ae5fa6b54879ea669f9933874077936d9a6023ef21a270adfe2ccef04ee076773e0aaa09af869dde0b2db2e7a2ee9172b5b39510e6bc24e8b4efd3c80162af808bf8fbe42ef4d2a222f825f64ea313db470905f93cd3bd944773354645845880eadab41c47f2a40abc3d1e1b1095e601a11ef1a2e00edc52b500c9cec70fea2d863bc7182f276bf0ca8b9c3bbd4e8cbff8eefc62b8bef1702681967d11c3178faa42baec7752f3bc9837b9e7b2afca131ed01c8cb54465c79261d4a7ec9407c1779457f1e5af2a76d98f0e589f70fcedc1b6a612000a4224d5dc3abe7197485c5b81e6cda403b0a8e974e1ea3c0f327f55a87a7ff063b0391ecdcd57ecef81d3f66063223fcad66fdf79c9f4bb823cf52aa9f7f141bf76ba05e6a8d2e5cec872a59285a7e90dbaa2c931a26979c60f6060e2f5b458f44d16c637a7d4508ca233008232ed6aa9c0557f2ac51fe706abd45e04f5b812b19f427870343c323bb1e7a98ea7fac273444b73777956b84dbb0de64d623211598a7d1ff169c4445469a4b0e50677ed828f60ea4f028b2aed7bf5e56a6ae7607ed6c9b291a3c3d76f1ea5a0419f59cb91c89f07d9706ec46c42fabd47b280c7685355f74b58ac10599e927ff63d5015f2a8e5471e3b5afbd208fa761f8106f9293e821d483b1da1b298a386ad82459db140ea87e1a3a23a6426bd814385a28c4c3a842a44e2024e486b0b4644658d73236ceed421de204656a11182f21e94d66ea9c290249fc9e374cedd4e67b0969acfc1f4ecbdd401ec936353309134becd14db6784a51283bda7980292cde6c8cd35ba0b3a1109905ab8b8a2f90e93c6cf47dd16737894d04426c9e3b85191debeb9302511faedb31a21ab3b22a90aec1e22985757e6ffccbe751f9c6256d69bad6d6e1cfe989202e87cf2d54f1b4e4163902d6e0df22f3accac0e28cccb4c0ed17652bdce8c5aaa3160ed20ef1bd455119e00e1c3832e6c838a6b7635723c4e078b8d2df66f9c3ab7999cbb6dea42f35ab3ea13b6d0a0a673615337da54f2ab1bbfbf3b0912fcc1b73798a883281a8a831938c02e226533b38d426204ca082e9a39ed8736d620465954ffd5a5645aff6684702a08569534713ce8b9be795a979a947f67225a2dda27d20e4f906e39738a413233ac8b5c7da0cf59caa54ac89b7002a0b73997ce1879949f3f5d37a82f49047e6c6487351eaa5e7a8145120fa77c2383278ae7f7b2b169b64c8a4ac6e6e6ae8c78b5e755d42e24621ee59479c0603736647480f944c90545038ba8fb048dfd475c739fec820c792010b4e9203d1c18b908e9feb448caa815bdd8e8363ba793544ce67ec4ecdac3b0cea2acc4d51aa5fc2f38168f4c9c83386e9c5fc2e96fcab0a9827f6daf8eb1fcb8c391a7cbbbea098b6946ea5111f63f1a31455d49a45bdb48f999a3153ee37b12917e564778f7c574b3925f12a03190b21b8bb062cd7663c377a396cb99cef834eea667d19ed20d22f11e8564c3cd670fd3b020e764118cc22cabf2f967776b0406cc67f7510e10b35d7779031822b6feab45735b7121d628160783c40f3e3cc2cccebc623d77e8f4d3c9de88fe0660a137aa5f5811c873ad57115200468aaac22a768f8e227c95faa7324b1d1a81b03c81a76bf6517a9645f5f53a8f5865ea278d95d675b25c1def5d818fbdb2a7d497bc3a0645d4e362ede1b4fbe472e6f4968d92d30ed475e55205fedbdcf2ed46bc7386d05812a7cea540aa6544525ae423bfeccad82a6d1269c9c19b8c58ce6a1565d0dc54853d32962912f3c7508276e7189686ff49436dfd80c36d9a4d8b41e0845082ac538db51b5b11e2fe23756c2360f1dc4fcdbd7d2ea2e714795baad4c7aba58ac00566b52c36951be76efbf083628a20fdd828a15e0781faadf32262f09f017975dc36b9639bb705fb9e0321a05efeed7186e96d3004b7238efc015503aa15d81db812a9876870564d2a81632d30d4e09ad3b04b8cef2801c3a095dcbfe6b321f187a55a57eb42ae495d89a9fdecb91e3795c24f57f4b45d050847462505ba32e0de293f228d7452ef8cdd0495b4906047473a38a900d471930b29c1649829b030c025")
	expectedPublicKeyAt0B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt0)))
	_, err = hex.Decode(expectedPublicKeyAt0B, expectedPublicKeyAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt0 := []byte("004734bcf98f6f83c15ccd7d6bcb5a17667dc307adaccea712932231aa7079b3")
	expectedWithdrawalCredentialsAt0B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt0)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt0B, expectedWithdrawalCredentialsAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	dRootAt0 := []byte("91c40170d5b4630f3953990ad84ef250ae79dcbdbe485558ca37fd2bef59e740")
	dRootAt0B := make([]byte, hex.DecodedLen(len(dRootAt0)))
	_, err = hex.Decode(dRootAt0B, dRootAt0)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %#x but received %#x", dRootAt0B, depositDataRoots[0])
	}

	sigAt0 := []byte("897eb86a185dfb06909c7acf5f045e16fbc646659172d71ecce9225f3d725d1bb54c36bab25af2ac91027cc13d23c66768af379e5101e725783637e4735632410a6ba4c03e76cb91d841e413ac44ed9baaeb2a9342004d5e51819c2836a689cfdab4f45a54fb784d7d1f9892a93515b07c935719917a6a06dd5ef2cd937e3e7c60189418e0488e806d2a2f727c4317df9e38700c2f0ca7f824132d34e66c27bf7cbab2e62a587596b27f90770576fb79d29209504c52cc11d08a244d03ca209cbf5a4564308f861ef33e854386d9b4908f2651aeabe7e00359108c5d7395976106e89d6fb75f1a31373cc6db007cbd8ba68f8fc454c944a6038372f6a27eda5320f2e652ebe23e6fa9026d0f2a76bce9d4150e80821780a9a0eaca90fdeec6166445e30a43f5b6dd84ced0f7df2510be1e84e1b9cd37cd1ee8ad67d72634ef8bdf0d60f5b7bc2d0dd0486d1a2bbda00ea34c6c9a1fad3e43f3514f1836ec634687addd4c33e94d4b90761c398ec8f0cf275b6bc21d186dd3b82ab95179df39f1ee755e8eb80128395f2ec2a60523e42416b743f3f3ce973c7273f400d6cecac9da9df7a85057fd93c8b3e5d65c43838d05f29ff060599835c7f141b05bf8e1f8ad3e9595a010efe565fd374cf0a8df6c3282a4308341d9f292faacab03182220aa86851fb8c4eb6bcabce17decbc0cbad836116b761d0669bd2935a10784ddec222556232e4c61dd9207f4a1ebd145ff302ed7b2c4b2187f7682b1aaf3a619b2aa76658427016c84411419d23e338e681bef7707aa51619666971856aab070baef1f799be9e3e47ecaecc2f57ab3b30e425f3bb0d0733d2b2f1229f9b965fbdb6e0f87943760b924db796aa663ea5820d1ae4ba8c9eb8a876d9e38ff6022fa997370fea3b3a739299e9a02b324d4fce4bdf0196c4567be6d925dad3ce0de05df0d800d5709124289f589352801cb4bf90e2c6d86088b80a84c05457bc23cf19d794b91e738b756606179f4edb4521eb80fdd7c814d65f995e1be7e4291031bf97e740f700df9b0b6139f3def2af718c5967883fe0e3a2abaff2152ba5323166482b6ee3a657b49dca768c583f56099b2d1eb7e7dcdb03662041542a18fb7146d7f30efec2b56ef937c949c4faa2b5f92544844ea6f31e3d5aeda5a6cc5d2e4a2f5f136ff4abaf3cdcbf37efac55536cbfec34a50e8d489d33686c674a38f8a2b946d00361ae15d01082bbec8732175fffaf7074efc84078e38fb2698c6e2b315ae005e53d20a8776c0b5bf9716222f048067455128382ac3885b07b7a57b7b5ed435382c1d316e0ff18640a2614717d4bdb1e05dae395ae7f2e46a977e503907cc80dd7bef93b272fc350e80a246c866434d3751ea3640cd406a99afbb2c6530a82029f15ebd4ebc20618602b3d2dce64ef8082e495133f83a8d0144f5d0323255712ee6a6af0d7206039761b2e49d9103f7c0cb61d13a65b6e92cefd4d12126605c4bf2c8aad04e68b5b1f55a801ccf6d1fa1e3c56a0671f467dbc877e59f30c63d39ba71fb27e61ba7a1824a6fe7507ae2066d17e8a84d344f27f6cbb9eba6f0d21bb0209b22433bb5f85b7371582abd9b2c08e15e727698351f0192bfb40102ca2f18ee5d102707292228c77baca24f263b4bc1f4ab9bc0692ca310d60fd4fa10987d7fe474c76317ec4508ae70fa47816c0625d0fbd204000789e6a53fbe14a2c8a84e78742aae54601b942eaf6d3f94e84b023ea6b11400e4711fbb7a6abe4e8779bd9c2218c471e656a8e511330cf7e1065d28b57ff5f46b35f73356e53704505fb34b8ff5a4c326267041c10e641d383fe3f266ca38d086d79090e4f5d376e4d8d5c1dfd2cb6f2739df617636c9f17fee14c5c37cc60d33e07f3caebf6876196d6e17da35627517bcbcd6e0df1d2e490a5807fca38ee7ee59111fcc769b6e44417dd74246e455de753d7084020645d37dd3a4b9828e8b10674e38684da712b1640a9b5ca908b4d45f193d089c639e983e6617baf45d561bdf31f6e81b9e4120061d79f10116a56e01f7d831a2181dd29fd3bfa614b5af85aff751d2476a9057bf00bcbd509d57e97fbb5881ce9b52cfbb3c7a38ca7f04a020f0e74195a10e31b3d6292969aae8513ef6b570aae0de0fc68e921c6307a9a7e7c772b287775671c3b3830d9033c9b2e3ab6346b75b6faf9c22cce964d30f0a8d37e40caab94f9a7201d6c86d428778c2393929269e341bba0d96a183ebdb63f95250f558393a2280dbc04fcb9cc82d055f399c7e33342ca344819b60a0f1d1dbd1fcc7b3d773cc8903c74cc864b77cf2d98e037907d293337ddeb96c2098326246a9563158ddd5cda5da7db9e561e2c4cf91fae013df0bb1abb43c7cfcd0ef86bafffa820a856363c73e5b7fc16a90cf24dc95c4d453a0175d9182f23aa6f679cfdb3fc46d8d8ce3a27cca0fb198fd7a1a293d913423721a8e6f3f946fe24ebc58360c1befd29ebbc73829f31599afd85ffac503340cc6898847949417a5fd63bc1368994bdd03d6bc0d5421d0ff7e6ebb2a549ee2494f78880b2f6fa84391d06f88257db6f32d3d5529b092892ef7004576f4354b347d3b5409664ca854f07cf55916de4a66a7618adfd19b9b63099bde3a8df19b689824f6a64bb35f5e19f98a456f35ef11bad0d22afcea694bf9824f540b50db6dec70d285f84e1f9e8b2f6175b4401aec4943c18a633a7b877b95dea689a3e9471970e9fcd89b8e83035ef8b2acc52e5f53e1a1b81b6d8727b84624f4a4e2f144439567d889c1603e2b601ff0486fae8cfe5eab55c72adabc0384459fa07ef84d35e7fdd5b644e2c46751b58d6b4214e00650cd55d463b45b03d2dbf9d05d2c8d56477c7e74a68f9bd58a515f1c710ca964244c6a8466d2122f39e48b0ae7674c84677d2ffc8f37986a9c57eac81a3191245be9e318af2777199e0e7fb706053ed48cec5c62a653cbe00f08f2a903d97f6059ff3b4bed8ba0c6a42b2c1cecfc50dbd41b9f4a51eb9b30937b18407b1021f1633c1bfce0f805c0f85a89d77af40fc1dfda6704df4bbe4afd2e981cab0d1345f952a37ab516d078a8fbd4c95b7f1a41f74e62644c607d61eac689f6e2cd419683bb1c4203acdd972a6994dffe2fe7f18e9996f22ced18ef089472c1e17debf543fd2ade89aca28008c2dd2cc751526e2dabcc5219df98857d399940a844179d90b13da6f15329132dca0c6b1825acf3048fa3d74177a13009e044143462f2d5bedc920aee2476f56ddff1bd1416f5598d9d95b6b5a705a1d7064b6b45b9bf39c501640956e2b33acaed50cac68ff9fc0e42ac87686d5f41e54d3ab2f2f78bab3117ad5ead498d5372a67eae4fd5cd970bd6f44194a43bd33a4fba946f57a8e8cefb30f0765c2b9d5b9f71ab310187072cb5f4ae68abdab2fe69f73ae45b49987ecc108c09924dec721ea64664c6d7052f61a59f00ca67c9d39ad668e4914b695932760a0fe13348255340bf14a5f40d8b0c571ee22eb52822f34c86be517b25caebf5197e2256e41e42b2ea2c1a8e10bb0501426b7e42e370bcb2038ec0c80976cb520b79fecb897ac873484f453bdad699df94cf9799314b42e44fd316e54b40034533d0154d641f1b3b0752620984c5409ad392c452e3da71f4a07c8650ced0ca6a95496549b7fc1618bf11ca1c923a565f5257e0b83310d657b05b4783a8f9d172fdd08eeb1a0db362a91ee3342666792045885040d161063d7775942c44da7e2086981e779134904c8ed955d831db9c312ecc6f6e9cf6198cd333d48912d60a765750744abdaf3647352ce40de654cdeba92d3d6d74cb488974bf9977f3afd0cfa4985151c2a90e08a8e36fb20d8bbcc8c7d7059cc5673022a60d2af730bac909bfbfaa7fcd517f96adb3ce269cf63db97285f258d5f533e8472489f575e52533d4ff7a9dd7bc6f6d519a12e415727d630bec1c54f70015efed4bb6a3104c87c3356dabf11ad83f0c0829ed466274e60fc6a80a8047c109c42a38b89d7e790f35a3458e52f7a56b4f1451d94a429f90856a1737abbb69caab103e803b9f9426d5e3ce5c58a2b2d619cec39cf6e9764373c99de2ffb8823076298370862cc74d25d4f7436cb228f8c12a50f07f80f8d7a369746a011faafd2c7bc229db9a182026cdd09ae7a99bfdbe43cf85267841bb6330d881597bb518f3c02f8e808f4e9913cd18c10efa9d3ded3f6bacf36b467be89db02742d39dbc20a8eff86444763e7bdd5974e09a946b0ed484b017d51eb7c2d5c4380d9c627ecf4a44afb35087773449a8ce99e06b03e38b942d99465a8766f90e2bb1e3a10ecc464199f2ce074e7be2b2fd7dcf7b54243cefea37ef793f4bf8a9235d5c13b2615441e043543699049b4bf3873598c28f2804d1cfbdbf357e63032384c3dce2e21ad9c2d45198d6f11d4c38f6b08e8b7945f83e895b9ab65912f4c6579e0eb252ab54483c170c334c03b894c8422923e81d50549e06f27cef6805ea58f7c86f1fae8ae75acf69b28e319ba481a17710012376afee2e6fb9823621da5f6020b4dfd7d96644fc6e482de3e98f45c76e3ab967e5c2d8e7eed5587df60b04121bf5f68e6bf57508705338f87ca1932317dc5d891a648bed03addd1b3b11554930435a1785192370b08d957db2bdecf88af2e660d0efdeebb322e63e453dd6a3afa83d86c41a45ca6177921414764a846209d0998714302b6e82b43119c28cb4dd3a5a61e71227d711d7be0b6fc9f07585f16627997339d22f7dac50e1a7608df40e7589ccd20a88da19e6a281d359bc9ca1416c444910143d0c3ffbf9cfc9e13e59c8564700a0407e4808879e2cc33cb8225708ca788cec0e72c59b2ab34f6e4347da869565ac39fa0c7579bb1edd7af23fc1b05ff306742f085be3e86a4e951eda0c5227e59ac25d370a8323bc3b2bbf9dfa0b93c8d945bcc60a4e1e93f557cfd5f6f5b49b1ebc6de17524c6cc67ca88b720616158c5492dfca66975a92c177eeb4d1b1de498fa3b09bfcba482c3351cc77fe87b17bc20fe278c46152a56efd1d30eb9440ce03d451fea3d8172c90f7c359144cf1126bfef5ec6ddf4b929d73df6041d7e8f97c04174f5bdf96aebb32779e2910c59dab2b313aaaa09341a66a5316452fd90d9033262f601de3fd8964cb766931c9536b06be53d7beafeb76d0c176d2c357b77b1bfc4fd88eee9ae8fe71db4837f3816bc66c7acd7977a95c994523591871b40d66065ea15afb445e9b92fbc5e225f366dc97719e0e86b92b22a827c68dd5a50a8b8f425101707ca2cc9e3fd9d230b454546cc18893fa4eb545374349cde0e22de16f1ffbbab5ed258a91f4d46504d6ffbec98141b74209b135a1e5bcc4077059c4d0bd28913fa7905e5f10ee6c5992024bd8915ec6aa06d169dc3ccfb93ffc3072271f5d2355e6c9ffd9ddae78feb70176d9d675fe94722d76058ccde6afd82724fb078f240f3be2241926e8883bce20c5332bcc73397af0838f20de72debeb8010e0f6cf4ca5e3ce4f5385cb3cadac2a8a17da23bb0b31ab356d85d35d6ac018d6eb949e6d96bcfc536f70d76b4e3da4f84f0b6e04d1d2272cc952c8e352edbde1d444059a00438342ba43eaa46fa052a08eff10e3a399f3bc668eb0c8937cd6383c775502dd6f55db7f3887995970ee093f6405a0842e94f92c3b480d41e40658f641be3fbf336496deed0118411546afdb8a03120dfc5e8ddbd8bd94bc723370f274001235d46210327142e81f200da018a9bffd67f9b61a9130b3683bae8d2e2bc7fc354922c96666247503633aa905ba2ee39cf2110176fecaa40891352a890e2d14cbe949a4ecc3800dc76ddadd727df9612da5aa5ee9565e2b93aa66c29267e398320156d287cf01bdf1af4d0d6e454796c396514f18cad357058111770dda8f17e877b9866a1d1f6d3e8716d7061fbbd0e33058826d2296c40457a7f4b049c36e0ab3237ab3250e1eb3e654037abc0f92a4c29083a98fbbade25204f84c2c38c68da580ddd2989765a08d504353b19e7d64f056261e3c82d69ac6448a8d16ce85103d5c6db9c186df0be008d1dd17b61d3d2b28c131d9aed964448926bb622cf6b12fc973df1cadba7ebc6efc4c9422ac1e64105d1dc0447a0bc36d202328bbfc8436e9179326843b3bb71f51e59e39a44040262505679d9d2c47a9964c81b7bbf924f0ce53a8d7b94d7612b3c8fa7ae9a28f8cc690c6a4b3ef419b16d12ce0972b6b266e29311f231bbdac42d76aa1b84265f44d41a1b460ba7aa48d3c16111466e5a5274e57066340a3ca9e7c0520e033733f50a11f041e60bffdbfe64d6f9099cd1b52468f1bcefdae432add5b59589a280c6bc261a13ce7334778abcad3375e96c1c7434775dc15229a9ba8bbc1c6d4ed050a204f97aad3e73a5a919dd6dfe1ed299093bdd3d9dd5d6e90fb0000000000000000000000000000000000000000000000060b0f1921293034")
	sigAt0B := make([]byte, hex.DecodedLen(len(sigAt0)))
	_, err = hex.Decode(sigAt0B, sigAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %#x but received %#x", sigAt0B, deposits[0].Data.Signature)
	}

	entries = 1024
	resetCache()
	balances = make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance / 2
	}
	deposits, depositTrie, err = DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err = DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)
	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	// Ensure 0  has not changed
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}
	expectedPublicKeyAt1023 := []byte("5de694585e91d95c86a104a9f66cd685c48b60fe9c79403b4979c1707238980bdf27893e8be214313fd4655ff540e206b820ab741d859d3f6182e07936aef4615b78d5d03d89be306203c3314bb2bff2845b809457653b7c9fe268a0df86bbf84ee155a2917236a445ad1b494885e1f206d845e952870524083947aaedfe7ffc21e67d2e883bb52b3f87f658c209ea70a3b78caab780491ab874d1312af2e93dd66e0006cfc930d7f4d8e3e558edf2befb9a684429b19c3b6e936372ea3ad4ca182bec8dd09f208d42b4ae336590ae4969f9aa469f89e28481796011cb97950185f8212b0c2bd9678fc5c99e7b73aabcc4632a544f12b2513101fe1288409ab4dccebe3554dd9e767ecfe8f6972075f49d78215c9bf328caa4dc80d9684906262a7b6f9cc2e542830924368dd041ec227ce353b0ae7ee20aea5df37d1a3af62e0466fcc5f94fbf9ed7acbdee421aa9e1d1f779013c8ddcf9cbae4ff46140fd94190e86ad8ac4472a646713138f851d562ecf3352e2ea818109e17651a600ee2861cee0465b0844ba126b6e7c96cbb7b09c233aaf4493df573482ca2a2e825e1683f6e31c15245db48b268c65a51fa2ef13335cda2898035439a49f1c4731ec87aae43768a6772503b239633c542665d2b1940565969b34b1f311fbb57074a4bef770244ad46f23c644babc198c34f4d3ddfd5f50ca7a567faca715b187c31f4970a871db296dc5ade768a5ad9db45104aeaa28cd278733acb06e637ac7f5fd07a381a29594e2c68f119ada586e7e1378a3f489b0cc45443a993b40202d284c993714fb4e88864b5e27153b6b93d3601d72cf161036d1c63a753ed67e20d5355222aebce82cef8fc70ab3b1044a45f68ee5c67a26920d9cda7efb1156a31192ae0b7864aecae8e2de037f9cde4fe83374422cfec1e37126d9afee8bdd3339ecc262df7825c5f66d6062865d92666194c2d26ed65d46e1cd200290b0e3bf1bce545d7af8d132304f2d985ce265ad70b8a5e5957c4fba4ee203ab5113c02485f3a78267ca611698b597fda64bb2cc7699d619ff8b4b688d23afefb8283768663aa91b73d870c01692fcd73e223960696b186facfaf353429ea4c03d8de631b46b36fa9f5748f80361aab75eef011a203784e2d73cbe6bdf53c2fa4f7ca9e76326bc2081ccfa6e3675bac97701fb79ec8c98de7002a845275fe40418d910530f714115cdfd540ef36073fc58b106d0761944e95c1400fa66abfe12d292ea1f323e770c0a0a858ab5bababe541c3466ec2f6bd65b7625f82f09ac40f780dae07be533653fc4ddbed97753af16b03c6107cfbaa6d3068e58552e7fe2b6569c33de9e60a395d4c44b6ebb7319e351cdde35475560536baec8032a7a5f5b55abac9b1b3c8d448c530fde8523b25960c21445942d84891ecfde2c39d580a5b89e78bf8d49881e9984fa7205600091d8f4c8aaf6327d03bf710c2c65d05b3a218f69b855b075a2ed6a46b806f6a38a04b5e89aed4a922b4524f182c32e3b41242034c4bfb80bf0472d2e1fd688d153d8b40a3f007b50deeebb99a1bcd568bcc6a703d0c6fff2f4072bf827c401636d7f60eddd56769b693e0ff50a3ec8be0e031f1d01f4fa1eb68f0ac9df4c7e4b1dfb56fba91b8ef8b21b706d786c8c95f447df11ee8c4f9175af2149bb968bdf7de0a6102be3d7445177e9551e20653de4d96624f521a9cb85279cd19ab46e84ec8d1abefdd2ac905aedce8d1932325402d50b4aebfdf2259a717a41f03ed76dcaf769f9a3f4550b8cd3cb96f3f7b02f64ed7fa15284afcb347eafdbdda7eea5d65f3fda3be850de0ba4896ebb02d9d30291ec75f900c1234ea07b67170132ba2d10206c849b90a8721cbba1b862488bbabde68d95ba42bc94e4c5f29ea69b770fdbbd5c45d41dfa40567d7341bbfd3397769ffb93b7c8875ecc5e238d03bd5282bc99b0a89d9315704d9e463da2766b1e635f73fd60ad9b3aeeb41cdc8c4af4016e9c581744860c5dd5d0b53422f06197773c7b1a47b67affadc0d066e51349f9c9bf3f03cb641afc4a55e8b175e8f250e15a7a6c985969d568f4f212210862e4608b73b62cc94166511621c8bb91a38a62962768e896dac201d2d6823f9526397b8d4a327a9e2cf06c0ac8ac0de9efbbef679c2c5d10283c85da324d79681c20164b60831e26f7281e28e83bb9eb09645c5b7fa76a28d80d21ee03070554539f118615c5044138528d49f83ba789c49a58c1c0515725c555256371227bd8c041a11bf46af25c8534d3e681c743070249de2649c837f7305c76fb4a6d3b0a3e76430fd34e793e662d38df96915d9c22423faa9448ae3bffb18c7e4734335d93d9abb9d0f1e40cf5249f604d2bb5c5b5277485a98cc3d8292c41094cf62e1b1322739d7482fea2a43d8003a81b3b09c9957cb3ba7caaf615deb9bad2476f8ea19c6e4440ea9dc8fdebf5f2b23f5ff34c9150fa015f3e03a50dcce811de1c007e77a18ef069b034f9119f1791b6d891e7fd715097c2898174f72f7b7c9cff784cb67fd714fc18ab38e7cf77b1635e2a0963613ba77fbbab1fea21ddb814f5a9e85cc41f33b838a8b03d27b376606a0eb691da3540aa0b981a46588ba092d7fced9dc877ddeac0e3da6335cad25270c5b59b13274bef288b8a02b02bd07d6924666d1037d7787aae2b1b8bb694136af4b4a3ddedb1bae1f75d1351dbf531770f13c93c5e852d9ff3891c7e13a8015986d220451a58b4d835a03a56632545350419d6aa97d2b91668f95dc92b0144877c9661e1974afe92c8460b1486b04ab32a4501f1287fb9cd431129864b1604fcfa692033923919af9e4fd1faf110739ef2d263c4e1adad18acf8eae4686e24c2b0e793619f50a7cf075ba3677306c5076a23f070708691fd592dab4f3aec2030d4456b11a9719fba80bcd21b9ce5b2a5e39272aa4fd1da29953ab316c8033bddea4405da663e41a4091021a47378fe2dc60915dc090e1f831421507722e138c66e026f4fb580ec9e7712ef76582c795f77182f58c1b17f995a2b26cb8f65e2bd5ec1235f2de64d1d4fa6177b763bf680aba151c5220ddf953f8022b0743908abb1dc5b656fc3f68bdc7a3dfbeaff3ce2b1ff1b0834c9696201722d6fd62ea4c39668e0d40e681fdee965a4f4e7d1b56ee60c677d8608048b68c0984337a7cc62580b95e085d1550156656cb5208daeee7d0e473a9f9fbf7fb9b7fd9ff90a4d8d11e324992909a21d8e840b6f6e262f9b1467fd4ca96636c65ab66f5da281722361b54c810eac681fc43a84cac6ee1859b302cd52ed18818ce5f500f932fff60df1d502955757601f2a6be0bf3563f25b078d44b0fb55baafe2bb3ef90c7e42b3d8011f4b813009cd44a3b7e24d25eb45fb488a7e9a34dc0975bb6871dec843403507cdc90d05d7b2a6df4b54fad28626785064820d3aaac34bb52b8610c187d3c366f9bfebdbb92d7d0c206efd7e11c507444d299eed7e9eaedde074c957c4bf488309dbe9668be43b3e73df635e253c909fb06f0f0d1817ed3c3a3a8a5263af846e4a6324973eda916007dc94f0d8639e57fe9eae342eb209ae4099a0332fb97c6f811495549586370c93fdab5e6a92cb62e2d2e599584f923668ae84df0676bb08e12f13a2af1283")
	expectedPublicKeyAt1023B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt1023)))
	_, err = hex.Decode(expectedPublicKeyAt1023B, expectedPublicKeyAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.PublicKey, expectedPublicKeyAt1023B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt1023B, deposits[1023].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt1023 := []byte("009560ec38ca371e316dafbd545bce01bc809cede91bb7d9310fb64db8dba123")
	expectedWithdrawalCredentialsAt1023B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt1023)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt1023B, expectedWithdrawalCredentialsAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt1023B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt1023B, deposits[1023].Data.WithdrawalCredentials)
	}
	dRootAt1023 := []byte("7cff3b26de5007156508882eeb9124411e0d12fa9eca0f46fda5ed2241d1559c")
	dRootAt1023B := make([]byte, hex.DecodedLen(len(dRootAt1023)))
	_, err = hex.Decode(dRootAt1023B, dRootAt1023)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[1023][:], dRootAt1023B) {
		t.Fatalf("incorrect deposit data root, wanted %#x but received %#x", dRootAt1023B, depositDataRoots[1023])
	}
	sigAt1023 := []byte("acc0a6bf16280c777e408ae2cb2dd564392be56b927186dcbd2df44dc1900282bc2b20b6687e8013cbf9dc53a9d72ff7d9923f9689d5d72a57f516e2b086962bfd71cef15617a2d7279f48e95f2fc4633e0183339e74d87f659418b56239f322ca9b89701ee5abe12a9f238353c5e5ee5277324302c3db52a0138da70e400496a1495cfab5f92c526eb25efd0666bb96741260c2e1032ac184a2f3fef9b454011b55f10f55fdfabc51af114c5211cb9c369610b21bc33d3166b1a5428683df71621259fd36e819baa2fce58871d8be9ed868708f7013a5d2eee9a393b00915d1102562c64e03f8515498581f6d9a26778e967207f43954a745a381624d33a78f3e2a1a43d5f440648a36bcc2e4c74864fc80bcbea600a0f11b25112481e080db31ad9d8e88e02362774c8f5033f7c84aa3ee73987921b730f9de7c0a393b40828dc1bd78c268a0e5a77184263078db37697dd8f852a8ec7c01313936e61b76461c9f046663ad189d7b9d32b54cd92541705b9769472688096e085e0b2df1699e36e6b93ba03ad5cd173ae32695f61e9340bcf8e89de790889581a1e57d5495e2b10494279ac237428787a99a4ed42fad84323f997e266f4a58e07f2afcb256a7a2d12857da61b3075b466e8b1a8cf1f7d570627bb5754eb2c8eea078c7b1a0ecfd8c0b590c7ae5c281d724364e1406cde6555f222cdc35bf10abdcca45099b93aed962319ed9fa2816386a1ddd313c519b49c7ebe7f4ea45b8f67fb93d78ab7e12f69fb10a5714c6860bc65844568f1ea88775486a7777eebe5afe4bb1cb2bdde8c864cfffc84695b0a27700659d96781993541001ec7e44c7eb81214d04c42a8819c5917a7eaa9efa09080a455857f3b89df6f3081ead3dd01a8031ceaa17ea9802b97c08b54c63fed50a8cc2a7c1ce1e394676efbecea1176d28d7b6340cc8856e67abd3bf50917e25d47990f00a7555ace43063ad2ee81322347c93b9223a16bf5da9a37fbe29ada588e266730aefa6b4243eba55c248f007f8051609c668c2b1c3c1140a1bd3f0aced30358af0c7f6fca7afcfc154e60ac4434d7cc100ce2401e5db9e5b3496f69a55d29f2d40e35348c40d6561e15431bd5e04ae8852f6066222bdc37e570107d18cab603e3556707538b13037971cf4dcd302d21628cd6ae73d60303eb78f9f3507ac5146c59e03f7d18101e31e0adc4edd3d7afbdf2f71a489db7ab2dddb209f014e30d088b11fa151102f73b1f8599ef2849027edafaec352bca555aba6027916eee5fd8bf27c91e43964a67c58debf4b5dbce93aab9567f38b2faf7a2f7db19a83bffaa1c3b5744246475f8f4dc210db1e3ec213954ec49ccd06eb4e58ec1cc4c460012b7e10e1844bae4f72ee248a3bbab76db217ac409d42b66f12c5d28a427604bb56fd114bb140b0aa85492ae80748bad2921072113f81ab4d12080a0a614bf28af7b9e28b1bb2573081c6853d06d903461e86dac2f29beab0dfb401f13869f8d52f14e7f8d94493146db5a06cb6208ecec8ab298563bb23af3507bcecf2f6e195d4660ee0a9aab96419eb0788de1510ef2055538060cf66e1674b50d8cc06d8813fce6f4d64bf972ee5046177fdd17b7f7498e790fda1917bac12d96676fc9df288a8e863f75479af77bd6b160c8ce3cffa48fb550fabe42e06b0670033bbc9d564a1a59d162e7f762c1adc59b93a09b90ae9be092655fbc8ba93c17ca08bfb52585d800bd86776e3e7d3c1d474c8aa1f2f9fa15ef7479f4b5f7d1c53cfb4ac4dd32ea430ba718f1f62786238a087501824a1d62704df8bbc554ce12ec7dba4c76c5798319eb29faf6297ee785ea4f7d4950a44685a5b42ec74d3683741b88e9c435697241340bcf00a08fcadd3b1c2085bb19fed20fc0f6a087971d35a57038a266d687bba2819a98850636c001314b9081e23f238e847ed51b3cd10bd424236141e8f11c01a0a46ab78e504956ff2efbb2b2dc07a5ca182b2c5f401d66eeaf018ceeaf4e21224d3558fe21a01c40146a5f10b0484f8f151ead38f12db96db5e59d8c5edf7d1e7e61240ed14b3f0bea8893e10ed0bb6ef8e93d3333d4dce12c519efd4b3e8705c343a6322396026948924124f859506d42f84306af4f421bce1d8a361dd36ccd8a738eaea9c1cc8c559c42b5fe17abf8f3c74e2d7d07819c59f0462168436059e12e2389b87c90508c8c309e2a719cb28555eb334efafe5af573213b4d5488b4267247f720bbf8c70b24048c9e60dd1bad91c6a954ce8761221ae0381d1eed5bf83c796d5a2f11813e01f3d3ede7fa19b89d9f95641a3dda90c10cdb359b1372c75c5d061e8c1c72115ed9205e17db3ee27702f1d1e89d49e34c827f40af2597482bcaca0d5adf823e6bd9b64a9d63cc9e59cf5a60f6ce9c32d643dce87122fd020ba601d6cfdcb5384d71e3d0c3727f9d0221150b70a6be8b90d93a32e05dfe5168e20ed5efcc5f9ed4164a8078bb330790d8f7796659534e5be4a23aeab1e8d4d688123dee656ab3e0dd0c1c285407d98c90f03cc6b146a4824ff2af419d37ca4dbcf307e89455f640f0beea52307cc5f09f734de04afed5bf03bcf1a9f4bcd3fda988538f2d382f24699f172949ec82aa1ffedcda06a6bd61945c08aca80fe4467d3ba5d1b9b1effb25848d1b9f61fa5f6d282c45a98d9716c573743a9cfbacf3488c394f093d9b0d8c1499c14f7772cb34d399411ad883e6853adfb5f7ae9e8d6b46fe8d359d116a51c16aee4fd2ea1a250de11a5ff54dac9b55b0ed929c32183914e9aeff4ecd165d3c446fcc91c399fb12c79fef3d1154c50ee1ec0734cf719466d4718f4ee74f61a2c14f5cc9ba6f4c4f6ab35a58082c6728aa4e46d3961a82a9e6e3d8a4b2b8dc806ab63fd47e76d701be66208d307c365e67cfe883baca05eb6a3e62820754f5cf3d9f5c2b78b2084b2a2727568975120ec319f9e8d75c3438bff523b5bcaf703ed7e9595e0a151ad6eec58d96d121df486bbe4fd6e5896d203142cd9378cac28042f54108c3bf33ed227344f1cdf2c7471f95a71b51c27d5df11871bbe8549b449e18d1a07d51e90e362b21c672c0c4f0dd9fef3e308b67a37dbb72b9ca4b774332aba0b970cded572324233fc8dc59e6eefa5f53905060deaa17973e395bd117fda1054a433d737d05d297d18cfb8f7beb05fdd10b27f5b947ab92da4a56e604a92633668f9149de64b0f23f8070a42fbfd2b716a44fe89f4b085096f9a552f1e44c95b63e9cd6f29e197f2b99544f9e21e1e07a04937285301a1149997e9f3a64728beeb0c21387f26e2aea70098077dbb2bbe701d4198e9b3a3238ceccd47238e8419298fb4effa20e9f66be2183d50d4d71fbc5b2b92613dcd438b13823ffb1a466aa59696cb3876f107902ff3e890fad790e5bdcbd4631aa78e48652e0de32dd784a5c548654e696737fa7a247ed694ef25a41fa81b2ac1fa88088b877f9109eea809eafa7cfc4605e048a6aae9b6b7262550069c18ab116f748d86325be4edf9d5575bf83ea8e9d73308128c7c4e98aa33d65f4346f2a2d9c17d473ee0299cdb8468968d9ece9b4854bea0bc0521b383678c904f1a15d652835214d0de9463e56ef45fc3c5fc82199a09320630a741f4458569acf47a0b93a11a42df5e1966084a64072ae790f75eb81922a47ec92d64a239ee001107ada3b32099f03d01efc41216d66ebc66d1df324577071529bc71a702da54d1bd6044c166d242f4c73531cbd5aced13e189511b2cca32191d077cfe32df2f06c178535fd4c26a59a4b1ac6e25f58d6760cd97d44006d011115109372dd4c7ae327185419799710dde225ac97f25601db43ef6e69dff2d490ee751224c4f7083876704fa1052243d8c6a22f0108ba07648655d3403b63501bb084ac5e81d6e361af5d3a501619a4bf448a75c46443386f5d0ae162dade49d7b66037d1a915d095865afc17f49b7c0edf79815995bba2e100484d5ce7b47062ad1a78969ed4d156ade3990931e18f6dde5b5be17d2b516197504948ec530d479fcb75c5f7eea8e4a0bc7afee6261dcdb19812eeb7b25152630cab52ee473b49cf164c0dc0fe0129d46572997b9b23baa8bdd9f5c30e8b732e1e39a926df292c3489975a987f1f31bd37dff55514323950cc3c6c5a65be739d7f145521a945f3b7ea9a522b2de7e7a1575c40edd085ac323b6948695337842ea6949399fb3ae2aae3429a2389c012b690648333841e07b4d1c1f8dc53ece609ee5620141eaf306ffd2597a722d408ab6a12f18ae54e683210184029068abd706f43f85559137c3ab47e137aae2494c226803f5c3f477ec16ea2b4793c261c4d67b3d76e25ced04b752f73b6b1431a0a3167ceb78121c99c1e97baad85513f1445256c22e571843006a267ad6fe16cba43b3ad0bd66aa0c9dd0b9535b2766f1e6db726bee362886f8cd4cb120b34a359e5ea38577145d587682fb3455f99614bbb1003dd6d8c1926a3ba500271418a892a33da226a93d32f8f4fe1dff4ecfc74ea2cffe6728717f46a00fe8b683fcd70dbc43264f9f3c68ef04c1fc95f5fdacaf765abfeb8227252f19ab58d6bda343b9acb53d736af707fd2e13578a1495c1a21632f00755405eedf6243aa201dc4f18c4d9b04b85827629ee5e02052a0be3db5cf2b66e98a343348d357e98ace9d7940573ee62b77e1dbef8ed83866d3246f921487031cb9727a1ff64b056c06f63404c14d7df0a6391165fecd5a00400f1b7c72744ccb21ca90995d2b84e912156bb61e4ef5a39478fe2638806422579129914b135a6f7a16286d0b7a566dab6674d951558fee600be17a52d620bd14dfbe6180642f8adda427aa6179bae1e4f982f340d9a6aeb6ba0cb262428dd15b3d83ac99cb8a3eb516efa57e9c18982fce9ae24f700008e80060168db0acbd9467c523e881e1acc5d427decd512e69ba4573531e50a5fb914975936fe77d8de786f10413e4c0fc8169e898488e703058619715d4096abc6df39c3d7be4870f02285b6a522558195740c2386e84f7686f7474401852cd6340782271264a19bb2a93623b18740b61dc90cb9c46d7109db3de876ea9f9e567de7f8a800337a02a7f1576a304028044bedbacf2e74eabf923b2d6ba23acb180ce272ff6daf74604a1ff18a7c211f7f9c26a1f57307b1d0f051138e342b70a4e667f983be11df3922e522ae66ccd9d1d0568e6a9024ede3b0e728bc5a0194b8d21a643a349dcd9bf28a76a32b170a1b942c72fc72ab29fb0fdb10f1f8a3c2d820a3eded8ca1ad2a03d3693924ee423b5315e45f091bd94abdf26673f5fb8c51971cddee473665f3c8680155f6df48aa9dd15d33af952f414952debe645515cb74336c1e9cc96135bf4d4632c40b6dfa45b9675be7b30f5af60beb07f8ec623943f2f45659697644d4faee62d1cfd10d63823da835641beca5cc54483f400d81978ccb2c5fc18a55275979b25fce77f53bd6d8b7a90d0126f112fca1c4ad712e63e9afccb3a2669f6d9ead7a926126614efc3b5cd33140baebbd0ff84b49ed5673bc412420a803125d41b25a5c024aa1318b4617f19a5b55f586938a203a3b7c80959395fe4d98985c6da13ab0356dc5497b4643608d6fcfdd732795d69d83ff1d26022b7b76d480f0a7d198858953baffd857adbc1864c6d3e4be9daeae8db6ff77365522505f4e08860bf74fe36c62bc78f823429389aff546d70833a86f8197a40c3477d929e13ac0409f8781e55a1a29c0e9eea935c9a69660910597621129851b81058ef7012df27a2537799d6c380c6c1c482874fdae62fe480dccb51f53902f2c2f7ed17fa2c661f4a0cfc202387da8c1e43822972b73d0d73008cedaa0aac86f77fbf5f327b8e57112348454a76c5bb3bcf3d635712a8a632005a081e045617acb0d1873fb7ebd1a9f1a553f1074e2236332916be11cf1d565b4507e7f36064f204d2b3a4b96e706ab2474aa1309fb88aff48a6644302c099950b5e002cd629965efa946ddd216f61beb9293bf568107a348506c8fd4582ff210ff0d2aa3484df1198be10a7731a0fefc858d348876b5466e6298bab0f2d9f4ea3ec1d032cb077046d4e13d1152a3c24e698945f4014f99bd1265015383c774682f9feb59694c7dca49f0420fada25d3f477fc764b51d8e05d3f5f94bb8d60e8e3897de79d49150b136e81a0b064d323036a0f92dfaa2a5690b6e6fa4be47378212571aea8eb0c95b8615c3df5db068662cfb68743ae53d742f45e913ff6afe2e16b13c4f1da695fc3b536ee53ac66763e5282febcd340d60ef0c59724722d18e52aeb2a02be16378644a8b7d6d01236c7442dafac5a3eb37cb189dea9ca72b47153bf308232a8992cbcc272f363f4a687479b42f5773c7fb1112292b4ac00010232d526ad3de4d596d82bdd2dde0e8eb141c252f7ce80611246f81a600000000000000000000000000000000000000060f141a222c3238")
	sigAt1023B := make([]byte, hex.DecodedLen(len(sigAt1023)))
	_, err = hex.Decode(sigAt1023B, sigAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.Signature, sigAt1023B) {
		t.Fatalf("incorrect signature, wanted %#x but received %#x", sigAt1023B, deposits[1023].Data.Signature)
	}
}

func TestDeterministicGenesisState_100Validators(t *testing.T) {
	validatorCount := uint64(100)
	beaconState, privKeys := DeterministicGenesisState(t, validatorCount)
	activeValidators, err := helpers.ActiveValidatorCount(context.Background(), beaconState, 0)
	require.NoError(t, err)

	// lint:ignore uintcast -- test code
	if len(privKeys) != int(validatorCount) {
		t.Fatalf("expected amount of private keys %d to match requested amount of validators %d", len(privKeys), validatorCount)
	}
	if activeValidators != validatorCount {
		t.Fatalf("expected validators in state %d to match requested amount %d", activeValidators, validatorCount)
	}
}

func TestDepositTrieFromDeposits(t *testing.T) {
	deposits, _, err := DeterministicDepositsAndKeys(100)
	require.NoError(t, err)
	zond1Data, err := DeterministicZond1Data(len(deposits))
	require.NoError(t, err)

	depositTrie, _, err := DepositTrieFromDeposits(deposits)
	require.NoError(t, err)

	root, err := depositTrie.HashTreeRoot()
	if err != nil {
		t.Fatal(err)
	}
	if !bytes.Equal(root[:], zond1Data.DepositRoot) {
		t.Fatal("expected deposit trie root to equal zond1data deposit root")
	}
}
