package util

import (
	"bytes"
	"encoding/hex"
	"testing"

	"github.com/theQRL/qrysm/config/params"
	"github.com/theQRL/qrysm/testing/require"
	"google.golang.org/protobuf/proto"
)

func TestSetupInitialDeposits_1024Entries(t *testing.T) {
	entries := 1
	resetCache()
	deposits, privKeys, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, depositDataRoots, err := DeterministicDepositTrie(len(deposits))
	require.NoError(t, err)

	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	if len(privKeys) != entries {
		t.Fatalf("incorrect number of private keys returned, wanted %d but received %d", entries, len(privKeys))
	}
	expectedPublicKeyAt0 := []byte("b755417ac7b0a00d7a04ccc9ba74c5bf46213704ae6c366176b5c92dd6c209331a23b29e4c22f8db4b4c8f90c69a6e6a14c0ecae5abde6f6e6f03a41154ef97d49f55ab23e1e421f7dba88182c8ee507cfa225ddf6fbb7e5d5331dbf21995313bf40d127ca8889ce06fd10b848f83bf6b0b7412ece6255b895833c17309c39af542eb6a12c61aa788dd1dd054c8c6630e80e34c211f107c7c440342f3a434698d6abbc68bb80e98694f720e996872bd049ab12d263ac63fb63ac100c5122e1b69ae2bec37850c38f9db50928facb0a7bb39a4205eb1c7f2fdabbeb32edb17eaa9fcd68f43eb56c66e829ce95bbd86545e22f138df8b48816543622bfdb0fb36079ac56cbbfeffe6b33781c410f51dbb2188d47c924e0d4c2c8b55cf37e749d28096df5cf12256b0d62324140c4bedf3fdf75360c6a00e441a77e57e5f26e9a5786adb75b10d5d8265038eca3fe6f52568ca4099deac108604f932f793eb6e8962ec4372a49e288c488f94096b2fbc32365be7c24588dbcf83a963973a3f1ebf151fe3a36dad00bff7e72af525bfac2422a0431988289f10530c8d069c7dccdb4ac5b68981f7909f15e5faab4546d53855ef12de6cdabc1006ded7779dd91f0615621b9f7b2a5945dd044504e7fdec80c62c68b16179ff628f9f6c59398d9dfa35fcc2a40022f9ed19cb726c3052076502ac5b34ae945065191a0161526e750942f4a4a7b05695fe7f3cc7f4c22a7254063f78d80f5da1d9b737a642a59ad16d955e118a1b1e68e7fc83d198780cb37a84da1095a96c1bef28e3cb8561c4eaa05647a523df7b1d39695cd5a47e51e4e75d865dadefb2933404f684422400de0158c1a8f2dabc8b87ced747de591a68bd0f9aadbf90911cdb6b08f77450454d005129c10a9be844be3ad848b0a674356c0d31b9f19acf45a9781e85bf1a6a2b88999313bfaf816637b239d4fced92293082f649dc3c48ff0443505e63dd948f53dc867fbb523faaa9b6f95e6193b18b0bf3150b35564acc654ddcc6c8122fb134c4acb45a6f583ec5f8374b5b118153271aef87b4986d76f2e6996523cfab3dea3f794fe62c1ff5736fdf9d13295c8d3b29fddc06200aae6383aa3b3e9581eb48131d27b834c0e903e9d1e553afb56199ea789fd475da516b428d655ac86662dbb26a85da97af5dbf166a31cdb6d6dc0cec8137d75ba3e892a3217beeb4e3de845f2e762ddfd7ad1c1cc846dfbf0b75590268347a6a5566599352661e25149058957b0363e82e0e6b707d72d2ecb4f7742333586aaeed28a52f905a111abcce4fdb3950b6ee09e59ef42d5e156315ef6c3a0b3de5d0643b5c5b020eeed54d2a8e619fd15e35ae182cda8415292e40e52af5a6434187af39ee73a5ddf70d3db69de5c54cc24d1e42071f39ef150803d37550a34a4de0bcbfb02e668f7323ac7293e0d743a383d9d6120df38db45b38542e0eb3fb2d73339d523cc2f2e35f6fa2de260de4c8191a242a67cc08f6ee7ed4546c8c2c8883516f1c21e5432a56850f7c1ab67fda639424d5d5ab5ae5fa6b54879ea669f9933874077936d9a6023ef21a270adfe2ccef04ee076773e0aaa09af869dde0b2db2e7a2ee9172b5b39510e6bc24e8b4efd3c80162af808bf8fbe42ef4d2a222f825f64ea313db470905f93cd3bd944773354645845880eadab41c47f2a40abc3d1e1b1095e601a11ef1a2e00edc52b500c9cec70fea2d863bc7182f276bf0ca8b9c3bbd4e8cbff8eefc62b8bef1702681967d11c3178faa42baec7752f3bc9837b9e7b2afca131ed01c8cb54465c79261d4a7ec9407c1779457f1e5af2a76d98f0e589f70fcedc1b6a612000a4224d5dc3abe7197485c5b81e6cda403b0a8e974e1ea3c0f327f55a87a7ff063b0391ecdcd57ecef81d3f66063223fcad66fdf79c9f4bb823cf52aa9f7f141bf76ba05e6a8d2e5cec872a59285a7e90dbaa2c931a26979c60f6060e2f5b458f44d16c637a7d4508ca233008232ed6aa9c0557f2ac51fe706abd45e04f5b812b19f427870343c323bb1e7a98ea7fac273444b73777956b84dbb0de64d623211598a7d1ff169c4445469a4b0e50677ed828f60ea4f028b2aed7bf5e56a6ae7607ed6c9b291a3c3d76f1ea5a0419f59cb91c89f07d9706ec46c42fabd47b280c7685355f74b58ac10599e927ff63d5015f2a8e5471e3b5afbd208fa761f8106f9293e821d483b1da1b298a386ad82459db140ea87e1a3a23a6426bd814385a28c4c3a842a44e2024e486b0b4644658d73236ceed421de204656a11182f21e94d66ea9c290249fc9e374cedd4e67b0969acfc1f4ecbdd401ec936353309134becd14db6784a51283bda7980292cde6c8cd35ba0b3a1109905ab8b8a2f90e93c6cf47dd16737894d04426c9e3b85191debeb9302511faedb31a21ab3b22a90aec1e22985757e6ffccbe751f9c6256d69bad6d6e1cfe989202e87cf2d54f1b4e4163902d6e0df22f3accac0e28cccb4c0ed17652bdce8c5aaa3160ed20ef1bd455119e00e1c3832e6c838a6b7635723c4e078b8d2df66f9c3ab7999cbb6dea42f35ab3ea13b6d0a0a673615337da54f2ab1bbfbf3b0912fcc1b73798a883281a8a831938c02e226533b38d426204ca082e9a39ed8736d620465954ffd5a5645aff6684702a08569534713ce8b9be795a979a947f67225a2dda27d20e4f906e39738a413233ac8b5c7da0cf59caa54ac89b7002a0b73997ce1879949f3f5d37a82f49047e6c6487351eaa5e7a8145120fa77c2383278ae7f7b2b169b64c8a4ac6e6e6ae8c78b5e755d42e24621ee59479c0603736647480f944c90545038ba8fb048dfd475c739fec820c792010b4e9203d1c18b908e9feb448caa815bdd8e8363ba793544ce67ec4ecdac3b0cea2acc4d51aa5fc2f38168f4c9c83386e9c5fc2e96fcab0a9827f6daf8eb1fcb8c391a7cbbbea098b6946ea5111f63f1a31455d49a45bdb48f999a3153ee37b12917e564778f7c574b3925f12a03190b21b8bb062cd7663c377a396cb99cef834eea667d19ed20d22f11e8564c3cd670fd3b020e764118cc22cabf2f967776b0406cc67f7510e10b35d7779031822b6feab45735b7121d628160783c40f3e3cc2cccebc623d77e8f4d3c9de88fe0660a137aa5f5811c873ad57115200468aaac22a768f8e227c95faa7324b1d1a81b03c81a76bf6517a9645f5f53a8f5865ea278d95d675b25c1def5d818fbdb2a7d497bc3a0645d4e362ede1b4fbe472e6f4968d92d30ed475e55205fedbdcf2ed46bc7386d05812a7cea540aa6544525ae423bfeccad82a6d1269c9c19b8c58ce6a1565d0dc54853d32962912f3c7508276e7189686ff49436dfd80c36d9a4d8b41e0845082ac538db51b5b11e2fe23756c2360f1dc4fcdbd7d2ea2e714795baad4c7aba58ac00566b52c36951be76efbf083628a20fdd828a15e0781faadf32262f09f017975dc36b9639bb705fb9e0321a05efeed7186e96d3004b7238efc015503aa15d81db812a9876870564d2a81632d30d4e09ad3b04b8cef2801c3a095dcbfe6b321f187a55a57eb42ae495d89a9fdecb91e3795c24f57f4b45d050847462505ba32e0de293f228d7452ef8cdd0495b4906047473a38a900d471930b29c1649829b030c025")
	expectedPublicKeyAt0B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt0)))
	_, err = hex.Decode(expectedPublicKeyAt0B, expectedPublicKeyAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt0 := []byte("004734bcf98f6f83c15ccd7d6bcb5a17667dc307adaccea712932231aa7079b3")
	expectedWithdrawalCredentialsAt0B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt0)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt0B, expectedWithdrawalCredentialsAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}

	dRootAt0 := []byte("e45e6e6d19a64da661b4103979ce66012bcce7174a6d449a39ac872eb0a32ea0")
	dRootAt0B := make([]byte, hex.DecodedLen(len(dRootAt0)))
	_, err = hex.Decode(dRootAt0B, dRootAt0)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}

	sigAt0 := []byte("408b74683495b30e3db230aebf1a168dd120e109ed0160fbb8a98cfdcc2dc42bcf539dbf72d17f149c2b8ba84703de705265ca71208270c51d29bc45393c554c485be8e3e927bc0c32945414e980bd7c393a2992c65f0560eb369ab912851def9bdcfbac0daf4ef43b7e455f612771521eb616dceda4818ea617165e37236eda68cd0b9778e1cf9d6557536921e5919967f8b219e52b9e76835b2d645b688bab297debb2c483bb5b7d6afe59a19fc8a9268fd6f467163c4e881aea19323ee48e79e0b55d7c7a53d237534f384515814f24664a27d61dd8c3124cabf65fbc1555beb52bfdd6851a05b9d65cd53520946d07268a00b6902754b7a886ef6f392d7866f278173bff9e081812622cdcac0fe0fc3ffd8cac21aa968e0b0cbf84bfcd38e9a64130c5c1a28f750a558056135244b70f8ab4dbbea64098b070416f1ae33792cc99d35b29d9a986ca06174755de2fcfb6b374d8b7c48bec6c5ee733a20914e98ead8990ee670fe94e64a031f4a9a342e4d67f7f3068cd0af7905a90d303315e35b5f9eb5b51d2e763f2478b073b3fb77b01dc21080e7230ef3e5cae9bc460497c35545bc8a1cb1855d59be493a1a6eb7a9c25addd0b0ea365845d87dad959137add384f160689e2514b4c4a8caaaa33bfb1441805ee33f2aa824c5c2253b8b38805dde57456a462109591030dc3a13e701ceff78bb64f15b1ad2e1085b9b75869e9893c824e29c8c405b879df729697e8dcb9f888bfdfacf5fa0ed844d70640078f3b4f61552f21d5c514c553a33fbae268cd737023f9b099c759364e6a922b1c1d7036ef9e566d9ff41dbedb6cd9e05e3ccb55603344f03fe245aa4444afa89b0d0af97f7a96bf81039bfe9791a1a013d75e4edd280ff4e4e005421bb2d44223c8899c2c6996f634b98ef72faeece500c794ce6dfe00857162c98d71d0330659c92855d75b70b09bf0c0422e12304c70218847dc2883d2af622b5ca6013c6bb6fe8783c2b475c5617aee761e29413e33940494b1ad8449d54fb4956daf120dfa7545be0dbaeb902e7ef540f7abbb9cafc59f8233f82be52f8c32c92d5669915671adf33433eb9e3e8951ce4a83d36cd3772f202523ef43dedb9a5bf30a4df2d47e4f8fc48fa13ad437442528b73cc4dc2f2e10e100269fb0e9b314d375ab0e529e4b09abf40fc2b03d11e46aab379cf26f779e063545d99d21efef5678d90c9ea07cd67606a6c8d6f544ebc560d92187e6a87c869a5f3da122912febacd0212972f1bbfa913d538f755de32ad458d273220d2473451d2fdfad3982690779a8e90ae763e2930d53dfa4e02b426ae886be2cc5b0ffda5977ae43b011bb9406e4b4bd7cb43416dd9172f31f1172d2dfcd9511ac6efcc982b0ef7f6eb9d966acd990c0913270b2412576abcb1594df5354442c10008a094a9d57aa605a56a66b05e1473e5914f38029605a3335e4e0f4b0f1836bd9ae036293fafa04ed09db3bc44a7cbfc44935e7a7df1a2934d54704eef025987eba7dc28e982d64c7597143ddeca78d24a87489c6b0e6f203d9bcec39f5e2a06eea79819fc9505d9f628212158ea6bc9199e7fe447908423fc462a401778c2c32732a821b101527acff721ac632dfce29da26ca61f067bd3259810b40a3033d367e1c7a70919eb083bc19a427a99db7e20a2fc0137ae8613034ae90404370d52852c9060f8888065726654d90c7a9c1affc5197e465967b78755ba50ffc3bc60c8bf612f7f26794a16428509d126b78f91ec0130222c2c214ee5c0131fff321ad2455eb22862498586930a82c2ab45574cd023a727fe6d2f7c7f81edb7dcc46fb1f67feb332f9c820b327f3ff1354c1007d762733e623abfecab1116168e8c445fe094008faaadbf26a6324edb77fe3df1734b4c29666978375cb47fd6a7386d2ba7f0a3bbfb042ba91d7b4266b7451331c832511b8dc3d14e13103e77cbfe75182979549a8b35f869c380624de7e74a93c84b0c9d9049c65ed80c1b05c8726f6097b036fc33f6604846454916088f494aba4acfb5e05ddbe0d09c99f7f734c83f9fc1a288710b01712d5d107d31f2a8a8b177e8ca1cf80fe11f18d1f8f095f799fabfa4747cb834bf17cb882827b4e96ca449bc305204c2be699383cfc8463eee5b2e3db1076968578bcaa8c1ef6fef7621d681e7a2a4afe1d5821f8dd3f3372db81467411313ebaffb771873100cf1f0d2866e68928d61ee53128da821adaf65204f4c2bd70e085f0b29c6dc6032200688648f51b9ed2455aafbed498fb674fbb9eb245253b686d270ce65d947b5024bbba57798e0a6f7d9cd6e35bd3ae316f7c3427f587478cb6cae4e76b6388535102f89e064b5c118984e2a456b2c5f6ed35dfaa18c7f215f3d00251b6911234c5eeb84258ebb7a72e94107a28ab7b56e1b1f9902c64fede121e23d6274ed0da9d99cf4e1d1df71663f16dc4397696ef1b4e86b808e093a0e19f8333c19f21b5f9dc7b1b88d69c2642ad9d857d5d1f12bf3cb028bb5d54a0b2fe89d0ccf13e42323a8a1ef3608f3e3b26fabd56af0f274b30121a4d85b02d58205eb39ee242c3310e57a3f68f8bc2060ee685fe9747e1e1ef6ffa04005c945efed0971d52d8d5bb1fc4e19b7c748e1bfb6179b44e3c9ab2eba099be1069fa07e728de32bfcc1d4b5fd5cab2a316376e83910a8cf06b4191c929081228c0404ae1854cd09a8c84c4284bbf88c3ea18cf4e9268372db6efb358e0d94872e8e76596f7952a362854b8e1390bcd293c6a2966119a364d55b93a2a2a0b83f8f7baf0b3873582c8f37964b36920a1c4eaf4adfa1c38f5cdd90c64b598211954b352bb40cfc3dcbc39ae0e2bf9167611754aca85f2f11411929e4adfad941d2da82842cf612ba5c5cc16022c59981fd705f2cbfee08e8a7c4d0dfa0d212c51ac46b68fc999a8fe02830190763dedc2a1a1dae8c8af676ae71ba15bbc84bb35bf13e28bbb65f764f6660a8794ca7adbcc4bec9c7aee9bf0f4202c2f12aaf0ab38e4846ce609222898aebdf02147ad4b8cc301d26c3ee9914ccd3b5e0c60d84273ec3caac031742313261309d08736c1125a3a2e7355aff6c599acbf566fa95a427b7c143a3206a7573242187e2e22ff8283af01c3338e6daea086a5d6f9520d0dda24aa1497225a0e6822881d0f7df8d9cf0d311c993832d0c198227e1e88a1ea7459f06336af970e6bf9f1869dbe45b36df50756eee06dffe1bb9b2cb50ef22656a9484a2ed6bc88de4c99aebca8e8d05b397749e1e15f19cab3f8824338446edd9d78d0ef52bda2ac1c0da5686fe7b11dd3edf4d71344c4507528c62b30ef269a923cacf884df040d70ec91cd463ddd20c44cbc9696eafcc0e985739ada416642c2922d27f1ea5e063d9f4a73fb7584bf94b0eebef247a6a88954127b19f811d02ee89dbeebe6ee2247f5f02eb0a4445cd291a3a0a16fcfaeb73986d15225e783bdd12d5af29cd3ffcb0e7de01d3be07f6ee174511da866b600b0a5121a72973aa74f7c44ed59b65abd6a4ef31c1024f9ada727ac97e99cc872b3d647e6e35040ff4748c06f01002f6f7865b047fe15cf0967d922fb0b9f151c6f4b87e57c94ebb72b9b231bb7200c66610917cd4934eae6b9acf748ceccaf32476a5d11cfb3fe9f47111cc6b122021aa3d6a81b359c6aba01571ce4aaf6286d28ee95376fbcfe55d3d0b9582baccf3bfec1f31d5d331332482d4e05db1c2c7e706975678b50f73d9d37b1e8606147d3ce66ca6e06e67ad997a45b50857b8f849ee842c0b0da0699501c8b0fdcdce8de87995b36f43af8413ccad1e2527e240614ae11e8c82cb207f81996a51d622f17cd518fea28f496df1edeb3c1ccb52e92ab42a3fc494176f6d16347c0bb851efbe1d5ace2bbf6619b82ec3f821a1200c783ba40f76cad9aef70f38f043c1f8770f80a34e58890bee47df698a8a41e9bd3eba99267d40f4ccd3cccbb201dceb113524dd5eb1effdd4c5b352c32dae23dde98782979466caa9e4c872e61abce25f96a73b0c7e51008c51adf600934ae25cd8e9ed583fdd4b2ca95584289addde438e758a3ccfc1af540db874349a128467ecd9cd9dc4754e0bda4ddf8d105cc058a3ed1f68f27cb3f4ddd0098796855f2e6148960b2f1e2c0c2ffcc3c62a68eb09bb78da5ef530c061f809f73c2e7f2def627482f7d1c2e92bd730102797328176786b0207a3bcd2268f7548e348f715fee83f6129d8036d616a4fe4255ab62a456d039b1f452c7d2f98ac7859249e812672996b5e96fb98c808aa8752eb46c4eb23fb6952e4bde145246f80796483c4ac294b03d2dcde10ee13df745fd63f0e05a50947c551a9b8bf773ecf153b481cd9da6f1e3b431c0a434830c5267f8522c78bcc8cf4dba84dd5c37a38a4853f4169d6ff81b6e397867011096ca8032150e90044c8ef522f1c3669f39fd68fed0dbf261f512e259192c3e6fc65df2b77d63321c8e2f8a801144ee8fd831ddf0fc7912811cfe443db98d94914399cff3440b3be1f38449c6809f2d633a50e29dc458a6a66291b73454fbcb6e660d23b8b7c948e7dfaf5a50bce021ae785102126c1b929190f76b4a7ccb9e9d71f9acb1a2ba1400e5801a9c752944df085a314048e00964c5665eaa85640e8bb61d804f1cd43d6d2966c4b9ad93044713d951a07fc48f13741d1f4f5ce896f7bde47893d23a2a65088e722872aa71b34effdc35ad25d653e507b0c2a876bb417e694345b9a38a7f1f727156767691269a1a8023fe800075cdff1408ff9da0e7552bb1d009045cde559f03dcc2fa838abb98668d11972eaf211f38cfa4746e10f88e990ebfec9e8660f3a3aa308a8ad91a1ad0102b1d4eea7e9827d8c52cf80a02d884122eafcb7173fccf905c330d7cd2e7c5ae246141b4c8325aacf9cd2da9d4d8192088b42a5409ebbf562b0b1a5b45b8fd6a24ea1a3900fbf4bec3b2ad667298bfe98e51df6975501319c8e4d28bc1239a8dc9a498089bc3d5f8c11cc2439e9a4cca4d2cf472e18ddd658a7ce877b12de8a0d5639eef003ffc595a90d80f07a88148796c2f1c413201896e4810bdc3591594a0a9c2043a387f32b9a110b2fb96f9e1e38010532c633f70b2d139af0586fbfdab928f7cebb144364ce21ee8553e6994a28627aef25d91e4400647daed6db77977d16167a336ccf6effe13b7e3b1e06569c9cb9f282d54f5a381e2018737e64824bb39675309164a360ed8f7daa8314b911fbadbba6d3e96deae1eb97266f3dd1daba487d5ccf7fbb793d3796ca04414b1c8a368c356dac633d8cdedc3e8058d6664f0afdaa874dfb5fa71f6b0cb8d1d501ad1c8a10a72cf32034a74b3813f0d8878e3785c88da739fc15138f45215166c6088aaa7364ae479f535c3e05c661a29be53cf3395f0882c080b7592bdd37f01ba713b66ccb4eaf8768c8c47e3091cd20d038ad8b2e3139c30eae240706ca9de64dd0a308bacd4a14d78f738e24f09438ec62d9c7af15e42ebaba5c48bd46e5cf056780d0118be6f4fb69e01e0c828be5d64326e8a2db85ffe60fa374a3f7067742b1d388668b2eed8eb255e1d99e01c172598ea20b45106dd9580943746325e822770bf34da10d83a78b245eb8654d044ed1ed73178d90a90d2338aa1e6d1aaea476d2cfe66a8915453e29671b220f52fd7351ee9c8796050ccdc339a79185b6ea86889693fd2b1f57869ab72869c42ee323dbd47be9d1909ed028d2970b93224d0b7112d60725b25a38cbe5492e799c6fec063a36f8047583e90bfc6b8f2e10f4c81f9151be28c448621692b857ca8c2ea767c509cf3651671cc1da5104631c24eeb7e7866e6afbbf2011028c813098b0bd209ccf6133a5434a469923fe31aa2fe0714913be9c8cf435f00ec0f500bfaeda79c65d3c3fb27d70a6bb03be38475b112550f3f3697535e7ef3bec02cda656d4a6b8a7b7a7eeff44ca0ef355c3dd9345e529fc290e8a337bb0369160184bdeca6da9f60cfee03e665f54fc74bf0eee14d2c98bb85131ff99f3b8dd140e9ea92319e80837e4a2964f6cc857ca865817a91e1ec1d129f74e87844072c9730fbf9b3a8fe0d2ad9a23663f08dd21496548daa219560ad260df067c03017bb88bdaf5f7d5110af72b2ba18768d2178b5d7c428fa99e401a3b45a9eb8d66c816412cd415a14d8d6c9a700cd169e7590ebf5162a5bb4be2ab46997035532c369db1a66d9f2ee3014bc3e9e97e6f32ed77b4a34ffb13f2225d46ac9f58d6a6d46023ed31bf6375d471cb56dbc510989fb10cb37aa434ef7869cc2eba4d1ec11fb631c6a948e1c28c15aeb5ec3c715ed4aeeb045508a3e5d463a1f46d6a30feec4e6ea3f06c1538445f5929d65c5c6911553577dc2e8ed21264b85a0ade5ec0408107a86a5f31c4053549499d0f70519c0c4fc6679b9cce3ef14588384caff111b1f43717391a3cbf9000000000000000000000000000000000000070f161e23292f39")
	sigAt0B := make([]byte, hex.DecodedLen(len(sigAt0)))
	_, err = hex.Decode(sigAt0B, sigAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}

	entries = 1024
	resetCache()
	deposits, privKeys, err = DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, depositDataRoots, err = DeterministicDepositTrie(len(deposits))
	require.NoError(t, err)
	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	if len(privKeys) != entries {
		t.Fatalf("incorrect number of private keys returned, wanted %d but received %d", entries, len(privKeys))
	}
	// Ensure 0  has not changed
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}
	expectedPublicKeyAt1023 := []byte("5de694585e91d95c86a104a9f66cd685c48b60fe9c79403b4979c1707238980bdf27893e8be214313fd4655ff540e206b820ab741d859d3f6182e07936aef4615b78d5d03d89be306203c3314bb2bff2845b809457653b7c9fe268a0df86bbf84ee155a2917236a445ad1b494885e1f206d845e952870524083947aaedfe7ffc21e67d2e883bb52b3f87f658c209ea70a3b78caab780491ab874d1312af2e93dd66e0006cfc930d7f4d8e3e558edf2befb9a684429b19c3b6e936372ea3ad4ca182bec8dd09f208d42b4ae336590ae4969f9aa469f89e28481796011cb97950185f8212b0c2bd9678fc5c99e7b73aabcc4632a544f12b2513101fe1288409ab4dccebe3554dd9e767ecfe8f6972075f49d78215c9bf328caa4dc80d9684906262a7b6f9cc2e542830924368dd041ec227ce353b0ae7ee20aea5df37d1a3af62e0466fcc5f94fbf9ed7acbdee421aa9e1d1f779013c8ddcf9cbae4ff46140fd94190e86ad8ac4472a646713138f851d562ecf3352e2ea818109e17651a600ee2861cee0465b0844ba126b6e7c96cbb7b09c233aaf4493df573482ca2a2e825e1683f6e31c15245db48b268c65a51fa2ef13335cda2898035439a49f1c4731ec87aae43768a6772503b239633c542665d2b1940565969b34b1f311fbb57074a4bef770244ad46f23c644babc198c34f4d3ddfd5f50ca7a567faca715b187c31f4970a871db296dc5ade768a5ad9db45104aeaa28cd278733acb06e637ac7f5fd07a381a29594e2c68f119ada586e7e1378a3f489b0cc45443a993b40202d284c993714fb4e88864b5e27153b6b93d3601d72cf161036d1c63a753ed67e20d5355222aebce82cef8fc70ab3b1044a45f68ee5c67a26920d9cda7efb1156a31192ae0b7864aecae8e2de037f9cde4fe83374422cfec1e37126d9afee8bdd3339ecc262df7825c5f66d6062865d92666194c2d26ed65d46e1cd200290b0e3bf1bce545d7af8d132304f2d985ce265ad70b8a5e5957c4fba4ee203ab5113c02485f3a78267ca611698b597fda64bb2cc7699d619ff8b4b688d23afefb8283768663aa91b73d870c01692fcd73e223960696b186facfaf353429ea4c03d8de631b46b36fa9f5748f80361aab75eef011a203784e2d73cbe6bdf53c2fa4f7ca9e76326bc2081ccfa6e3675bac97701fb79ec8c98de7002a845275fe40418d910530f714115cdfd540ef36073fc58b106d0761944e95c1400fa66abfe12d292ea1f323e770c0a0a858ab5bababe541c3466ec2f6bd65b7625f82f09ac40f780dae07be533653fc4ddbed97753af16b03c6107cfbaa6d3068e58552e7fe2b6569c33de9e60a395d4c44b6ebb7319e351cdde35475560536baec8032a7a5f5b55abac9b1b3c8d448c530fde8523b25960c21445942d84891ecfde2c39d580a5b89e78bf8d49881e9984fa7205600091d8f4c8aaf6327d03bf710c2c65d05b3a218f69b855b075a2ed6a46b806f6a38a04b5e89aed4a922b4524f182c32e3b41242034c4bfb80bf0472d2e1fd688d153d8b40a3f007b50deeebb99a1bcd568bcc6a703d0c6fff2f4072bf827c401636d7f60eddd56769b693e0ff50a3ec8be0e031f1d01f4fa1eb68f0ac9df4c7e4b1dfb56fba91b8ef8b21b706d786c8c95f447df11ee8c4f9175af2149bb968bdf7de0a6102be3d7445177e9551e20653de4d96624f521a9cb85279cd19ab46e84ec8d1abefdd2ac905aedce8d1932325402d50b4aebfdf2259a717a41f03ed76dcaf769f9a3f4550b8cd3cb96f3f7b02f64ed7fa15284afcb347eafdbdda7eea5d65f3fda3be850de0ba4896ebb02d9d30291ec75f900c1234ea07b67170132ba2d10206c849b90a8721cbba1b862488bbabde68d95ba42bc94e4c5f29ea69b770fdbbd5c45d41dfa40567d7341bbfd3397769ffb93b7c8875ecc5e238d03bd5282bc99b0a89d9315704d9e463da2766b1e635f73fd60ad9b3aeeb41cdc8c4af4016e9c581744860c5dd5d0b53422f06197773c7b1a47b67affadc0d066e51349f9c9bf3f03cb641afc4a55e8b175e8f250e15a7a6c985969d568f4f212210862e4608b73b62cc94166511621c8bb91a38a62962768e896dac201d2d6823f9526397b8d4a327a9e2cf06c0ac8ac0de9efbbef679c2c5d10283c85da324d79681c20164b60831e26f7281e28e83bb9eb09645c5b7fa76a28d80d21ee03070554539f118615c5044138528d49f83ba789c49a58c1c0515725c555256371227bd8c041a11bf46af25c8534d3e681c743070249de2649c837f7305c76fb4a6d3b0a3e76430fd34e793e662d38df96915d9c22423faa9448ae3bffb18c7e4734335d93d9abb9d0f1e40cf5249f604d2bb5c5b5277485a98cc3d8292c41094cf62e1b1322739d7482fea2a43d8003a81b3b09c9957cb3ba7caaf615deb9bad2476f8ea19c6e4440ea9dc8fdebf5f2b23f5ff34c9150fa015f3e03a50dcce811de1c007e77a18ef069b034f9119f1791b6d891e7fd715097c2898174f72f7b7c9cff784cb67fd714fc18ab38e7cf77b1635e2a0963613ba77fbbab1fea21ddb814f5a9e85cc41f33b838a8b03d27b376606a0eb691da3540aa0b981a46588ba092d7fced9dc877ddeac0e3da6335cad25270c5b59b13274bef288b8a02b02bd07d6924666d1037d7787aae2b1b8bb694136af4b4a3ddedb1bae1f75d1351dbf531770f13c93c5e852d9ff3891c7e13a8015986d220451a58b4d835a03a56632545350419d6aa97d2b91668f95dc92b0144877c9661e1974afe92c8460b1486b04ab32a4501f1287fb9cd431129864b1604fcfa692033923919af9e4fd1faf110739ef2d263c4e1adad18acf8eae4686e24c2b0e793619f50a7cf075ba3677306c5076a23f070708691fd592dab4f3aec2030d4456b11a9719fba80bcd21b9ce5b2a5e39272aa4fd1da29953ab316c8033bddea4405da663e41a4091021a47378fe2dc60915dc090e1f831421507722e138c66e026f4fb580ec9e7712ef76582c795f77182f58c1b17f995a2b26cb8f65e2bd5ec1235f2de64d1d4fa6177b763bf680aba151c5220ddf953f8022b0743908abb1dc5b656fc3f68bdc7a3dfbeaff3ce2b1ff1b0834c9696201722d6fd62ea4c39668e0d40e681fdee965a4f4e7d1b56ee60c677d8608048b68c0984337a7cc62580b95e085d1550156656cb5208daeee7d0e473a9f9fbf7fb9b7fd9ff90a4d8d11e324992909a21d8e840b6f6e262f9b1467fd4ca96636c65ab66f5da281722361b54c810eac681fc43a84cac6ee1859b302cd52ed18818ce5f500f932fff60df1d502955757601f2a6be0bf3563f25b078d44b0fb55baafe2bb3ef90c7e42b3d8011f4b813009cd44a3b7e24d25eb45fb488a7e9a34dc0975bb6871dec843403507cdc90d05d7b2a6df4b54fad28626785064820d3aaac34bb52b8610c187d3c366f9bfebdbb92d7d0c206efd7e11c507444d299eed7e9eaedde074c957c4bf488309dbe9668be43b3e73df635e253c909fb06f0f0d1817ed3c3a3a8a5263af846e4a6324973eda916007dc94f0d8639e57fe9eae342eb209ae4099a0332fb97c6f811495549586370c93fdab5e6a92cb62e2d2e599584f923668ae84df0676bb08e12f13a2af1283")
	expectedPublicKeyAt1023B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt1023)))
	_, err = hex.Decode(expectedPublicKeyAt1023B, expectedPublicKeyAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.PublicKey, expectedPublicKeyAt1023B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt1023B, deposits[1023].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt1023 := []byte("009560ec38ca371e316dafbd545bce01bc809cede91bb7d9310fb64db8dba123")
	expectedWithdrawalCredentialsAt1023B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt1023)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt1023B, expectedWithdrawalCredentialsAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt1023B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt1023B, deposits[1023].Data.WithdrawalCredentials)
	}
	dRootAt1023 := []byte("14528622626c62ebf7b7a750eb3b5c0d2073042920505c08e30923588bb2b848")
	dRootAt1023B := make([]byte, hex.DecodedLen(len(dRootAt1023)))
	_, err = hex.Decode(dRootAt1023B, dRootAt1023)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[1023][:], dRootAt1023B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt1023B, depositDataRoots[1023])
	}
	sigAt1023 := []byte("851232b682f58cdde440e0aacb93c8c0dcc109aa654dc680af2110b9dba70034c840c5be33b257cfcec2476ca71e9647898d4ac2688c8b9c2b54f7be8d4586cb488ec51bda96e4ef278192e9a4c6a33cd976b8c33340cf45f48115cdd7e8c26db3784a59f99e4c6a38d12681a2decd5955c14d046285f4a3265cdb820210ddcb461ab80758f87aeab35f858e998711bd1b0b3dec5185296f95e29be436cf33e00f43f1468b67d0c1531b6d6953359c9f8220abbdac6d3816e450b4fb64354f0ad5d9219b788a4faf00bb3cdfe62aeca94436158c8bedb2719345a4fd862518f2ac3bb83446058ece490338c28334641f739bb64c6f7e1d6441ace4a24baf9a571a91ed65dbfc59a7f9a452043e6ecd66cae27421f4c1d2c3035117976b9cba44443e195c2b3f5fa0d4317c5d8106f296e2a61fd0ab207ca4296512920836e380e5ebdc5f61877933787563f5f1a50f359b5ca19123d1610a5572b9b0310742810ff5a5be227a2f7fa4cb03bb939c8c9dffa59978d156269ea09044d29c6b5fadbcfbc0f7ee58122c1cd149dda7c1ce12683a5c520e528858ba57a08adcdea165fdb831729ed90de727060487e220d14fac211256655937c6ee4f9cd3f5884c019d7275f72da674f9f5ad6b4d4669cd2fd415223e43694dd05a39d8dfdf289e7838d8cf97ae15a391d054fee9497a58ef236fac167f1fce39a009c947c1a20c5d5476f8256636cf1190f30ffcdf20cefd3f5459bba9de5c8514b1ae929c56f2d3cd50b8536467b9d58d4f56a3795328745d6356822f61971dfaa119fcfaebb2fc1ff444c3017afec57e1034f48e7256ad1337f76702a767d1bfd0f15057f1223293ec6d96ce2229c975ec2e8a9bba22a1dcbedbc5ede16017beeb9721dfffe36ab8fd6aef86ab71248cd958ba6eeb04d4bee715e0bd02041d20fef63dd902df2e250c8f054732c86123ef4dc4b3365d617a92ff6ad85b3eb66478a051e5f01e6f4bf1de3831ae8cf665fd7355bef6c0838749600bf0f3aae821dc5e8b42d3a53a5bcb5f3464504c98d51d6dce6f46d4e9e0edcc237706704b6e4b82d7d6eb8fd78bd2b46ea16fae8ec176a3a1e7580967a07c5297932ca891398ec18f974e68b4125ed4e16a38a9ba1436747b8ffcd6e5191a7cd9a9e4867664641a75103729962fb1f5a54477c2322f535fb5bc2c172ac96ebab7df95d792b385c30e169f5e7573e928a6caf1670ab466d58c6cb3f1a9b3491a5ff1e4f879f4a888477454ae724c4acb9eca9c5b39882d8d107fbf7bc7e44a088efa8b597f6f2178a2bf874c6dee1d3a217e01d33b2f066ff262a7be41ccd8068623371d29b4a393430f401d08914e12060fdde6ef53593b67f9b24b255dc8cc738df6e1b71e68805abd2b815c50625bf9b7213ad1d06291d6fdfa21f59c5d20adc4602e4e7159c3ea782e953dbb2cd2d298f6a8c46400c9da11489ed206449de3db5aeaa2da36e5b10f45ce74bc9faa7f27025d1140f74ff879bf6a3f1ed40c4fc8f6d5479f352358f65a581d92f92f56fa111a991d24ec28c4ab131e93a3218a45170bedbb23db68bfce26d63a6ba944ee530f93312c4502e2d07c8b1eb804653be0512beac0e589270025c8e8a57051f84059e2504dc22dadb300da7e753b2c62beea49eb31121df579d6aad29b90d322d4fd72951835492d40b64b2f840703c36f08c9a458afcd730e1896324612187bcb840fe315820f07f0046d956f0d4a3a54173bf6cb72ab5a031780dbae60dc2795161a8f112963d69b184131cfbb59e9cb2076a1faf5f00582aa963b83624f5ce797ac43531e873cd8b2b3d9f5b7530f1a79eb5c9f2c44e8ba00201010e042755cf6c883f6e29deccb7973cfc2cf4c10641533c1e1bb47f23a5121785cd17f9e67aa11f1a4471898cebeb5acf5abf1cde6014dcb06482a7ea49aeb2be7db99095c4ca818e1b45f92e02b35d5c35ca37829d168a2fce70ca688c69606aa1c79c1b2350ce3f79d5377d9e9cd6cd0f0252d25172127145d0868b4eb62a6cf4cbcba9bbc798d92b841ee6386f0ed441a05ac88a145d366c05284f24828ff1d4e9985de9f1b3a79478270c941d56c5ee0c63f776734d1e1b5f1427b5c95b90d4c925541f70d622ef97c28768e3385c4eca25dc817851e72c576b2438c89d1dc8cb4a7bb9b1d72bbedc5be050b084783be9085d8ec4044f09f8b091cfcc26e248f2eb695a2b102c579a3084ecd4dc0ac4a60c7126ff52441dae92874e206c8060317d737a31151f232b5211154c58bc665822d850e82b68295e3550bf7b9608127e1590e22e99f14d95908e0246db266268b925dc7b6795268e852856c979604076914a50cb53023a9f040d02f540512364acf177d52291f7a6395da6109bd6f58667c3bdbf90e5ff8ccc0a4ffd4398945575b9ee540e776a37ce8b2776bc7cd335e1f749d6108296b4095483a24220c4df87a7024d3b54de9eca204c2b54e466a90e92dad5ed4eeca06d9a1555dc48a424d2ab09416cf0eec130f09f97b0e4ff5e0bb63bd4b06112993050058d23b4892e42d31c98a68ddd1131b572fdf69afd86cc75b94252e182ec166b53965edd97be8daffcad872d0576f6104c3eb130051a5bd05524f7f18983b36288fbb1b36d035cbc9a5e54b053d07e9373818ea7c2f558d8226deb14c36e5bc55d1cdbc0808d907d5cdb81d31bd0ed3762ad6051fadc199ced3c79815273f26195102e8c020fc1b190b56ef0836ad8fd7c35bf320cd7e88625f10bcd9d07f778de7e91c48e3d3134141e1361426ec04dcf96d1aa0daa061dd49eaaa6a1ea6204ca0e103112c6fbca82be8594b0e993013c9171ce4a2314d222058fd56ecb07e4c19d60ca02981dd80f567e1f68e164bfe82f2bab79f5a4abd99ae04dd782530b67a624d2cc6926b078c8ef062fda7efa343c9558c9e3b36a817049c697aab5dc4381963567bdb536018a6cc1fa02d180566ba4cc366030c45f43883bc6029d7dce8a6a52f94d0b68346afdd2a35c1a11872c1e8b916eb79e9e76f399cc75f2626fba261f6418d47cb44cb761dde1a2b0c7720fbb9cb12299aab2263da5ac926dbd9be24025a711355126e020f8da882cd23bc6a5f2e55bb7d3c578dbc5b55c05df2ce64ef4827f0b16359ad7df10ee38ba8847dec6fdfd52107b951534b387469b9ec82cdb4d2b04566dd5fcbf88f13511af6089996c3b51ccf116df97f55cfd8e85f3773af2a05efc20414a6b0321a23a3afb989731d64e551506c1f6ab7db020305fc9fce6c95d1d78dba4aaf971d08bdd0f6b6f55a4aa56b7af0d39f71aa2db385a6f0b9ed76d7b1c6081fab293245820aecf32d50fcb57ccfda66ecb8ddc482caa532bc1b9754d479a3e2e9015c2fe4b69ccbdf3d0ddb8e4dcf648d6a551d71cc05193834799d28d2c71ddf9e1e9a9c1e409f1ec4b51d1f11f7f4adb41b1464ea5368f4d12abe843ffe3eed13710d1824fc28b87d02fe7af525b9ce4cb31511595a3a45d2ca6de2903b0802fe46f867712bff8861fe07b2a24f69883722459f8b8676573bcf46901c0703473ede65516794eac9b2a0bfb2ac411d30325885e4913fc701f426c7d91c120768ed1597482775348b10e8cc20cb0eaf8cbcf59389c2413bb5878cf4ff319c37af92b0c5a260ecc4630a2fa6f87f0d17b6a9fa36101785e9a3b7536554cfcb632a6d7cac253d66ce03780a698eef5701d791c37f963250ea63dab2597d2d93561aadda6c71252f5b70a693ecb8b570e271af9ab6cd868c34fe7a622a70e4bbaf577bb712e81850087290084d1d55eded37c5566ea42fa8746d1ca420ffd2bfdd496d691490031c362a5a812830891210bead7aaa072b232b3ee1582ab087a771324f1228016f04a0bbfdb3b13bac6b4a6ce3596fbf8af7869380bb215d9cc3b8279183ed3c83736656f697ff5b90655292e685449b55bd4a91b7bee7aeef8c447050af6cf844418dab0a98342b1ab506f9d0b6f53139cf311e74948aa6069a47f737d62e5f08be1e829d9cf9986e2b2d736b79e0d976616c8988b979d5bb3a7c7d92c0becf1a4d823a4eacd68af0c1e1ac9f6d22e4e0529b6a98b76eb44deb1dd6db9315e9be4419216c9a9e92ba0d3b3d8fa0d975a04fa6ae34aa8ec0f6b62603d8e8894cc73c6057ea81315751875c4c93707d3bf1370e4f5b73eeecc681f4d6019d290f11aa477d024f27c79448776bdffd73569d4d98cdd040349308dceae9d18ced238bd8480bdcfbf5b1e7dcfc1f31f3e46b6afa6c60698412763f1b581c72f5c6ff199ef1b3baa36a56981344a14e20d32a59a0f7e19fd0cad62b58ef7b0bd7dbac9c050059827e53cd159807c22f47f7b373ef6d3fc996caa376945ab0b7b85d7c5619b085371369129cb18fcbc930809937ee96d5ac29e5224f853c5bf75eb2cf3a2eb1db2910553f9b8bef2adaef09d9d97ddd8d263555728faac63881503f07520bd906404bbeecdc0352431a2da29dfc9897cda4db6f3f836abe7025a0971cca50d639bf081d600bea4a72cc8eb1470f703727ecf8d5d90d3c26c2601fb76c56c51bfdcdb19ca1c0c2c3d7ffe4ad604d528c363a7ff1329c859dcc4674baaacc4439c6ddbab85cca8fe6629d73135697c369d319f7db69222e7e7f8b98c25acb447f02bea4f9b22e032f3ed466d2a562b7a9143335fbd916a7efbf187dc01e75facf981338f178701a8e4e8f162ba454573b76da8fb5d0f16fadb65bc71208d08277d3ede55b7cda48f6c8e97ff3fe1d9b1868e2a087a1109e4f944c9ebc3919856657bf641e2495dcbc3ba190a73ac69a77060b895be70cc3a970dc51d79a2d8bda91383c4fcab660991572474f06f609b5c966aa97a06c75a47af957b875a304bd96c6996f618b6235b8b206ac3e9aa6d28f03707746b540b9ab35274a0f29c5fbdd1bd0b0aeb54ed6e23c863f4b27f02c0f21324884a15ae58ea90c7c5cc7eed2111528f633ff1aea6d9902ab294d6e80bd5d1a17f0b27d10fbdf08d338bbf201a6eb4a22b81c064c319f8860aa39d6ed78b70d10be8975694bf41a476895472e599fe446bd91f54f2c64f40c214e0fb869c83c5f26e3f625fb5165c595ee942e2ea78a06131aa76fe111022ecfe6034383ca3820ca719b37a5155c10313489220e874d7e1e3c31007b31a732327055ba31144d20449230f0755168893ee155996e752233926eaef60166b45b9182ef0d62092f432ae0cfcc25a86e77f554d89a1460dbe58c1f00f86ef5135c880fa7730b464bd09227ab63e23a797511bfd0676bcd0efbbb6c3c6cbd06015eb491095c207b7fad852f6c4f77549d12d547986b61bd72d4e8724e9744f17f12a239f6ef4efc39b1e0d782a204b6f42aff3f37dd92d755f8fd96343631b60fe11c0993d57d03f060d4fb0eb5c8c0b3db936c682a9414b761c5ba97af62df98a7b47ec34e3216b7728da6f6f7ac7fec056b1eab7347956bdc517c49d29afbe06cbb84008aeb3eacef430064fd48ed1d3989c04040a28640166ea75bab8d1bab70df2f80716c8a819fdce48de553eb3678ade2a7e0c797f1f2ce87a51e95f652f81e94063735b9f47340c99743d6ee9e9e7c64e4b14132c451c3ccd58e30a4bb62fc7aa0548b7010f6b0499790ef30b82db338ad4f52f154928279c5d718b4e7049420b75ffa2fd77acc04be66b6904191b7103c1d4820b4cf02f8b1910f57997301f23cd7bb5d79b85b6c1f21fe26670424f8f682416c9dd11a1ad8bb821e8d5f12b6eae602d9971384eadd2a3b7fc7a1f0ecdf20d880e1f38e423ada6ca958b4ec0250fba0c03707d7acc9b6c3442847a686497906515dda1240b584a16eb3b9c3e57f43f345319235ba503a6fcb0baf9dd58beb76e5ab4a8f52acff3398122b73bc47fd4f7f963a22d6266510906b131b09b9f7675d1f2df7d90d3fef84e340db806a31df1de1048277be641f69c4535e42e0f8245b73cdeb1df65e9cd1e8a82fd6f4b37fc65a691e38123426d0db6d571f29976aeec46600b90b633f8b538a9cf93628499ac10d01ef14998d6b7dd261b112c2ca12f0241d0f1a7c4dfa57e7b252591d2205baf9d123080db8618d109dd80e62db4505823b76ee36e9092360fdc735cdb96e6f96009e6ce261f254fb999bcfc54d1e046fcbd8f8407f5196d7fdb04aa0da2f53f88f3cad456ad6a7cf37f3769257f4ca369afcccf30b98b6f92735ac993514d15cae3d72a722958ceb268a3d3689747e3e37e33dbd2ba2493cd3d9db3e3f4e85603b80aca5838acac81ca7b020765d298da28b3b73fd96acec7539aef5efcf2573d32450434635421708fe06ec245d910fcd4a56a23c266564fcc8c9f8de6597274d73d299f98d579eab01042f7c9dc603041d2c4e79aaacc32990c6ec565e7da6d5dce2e5eff1fe1f2937424565cde102077d8385b4b5ea0e618ab0e0f6faff0c112240549699ecef00000000000000000000000000050e121d252d353e")
	sigAt1023B := make([]byte, hex.DecodedLen(len(sigAt1023)))
	_, err = hex.Decode(sigAt1023B, sigAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.Signature, sigAt1023B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt1023B, deposits[1023].Data.Signature)
	}
}

func TestDepositsWithBalance_MatchesDeterministic(t *testing.T) {
	entries := 64
	resetCache()
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	determDeposits, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, determDepositDataRoots, err := DeterministicDepositTrie(entries)
	require.NoError(t, err)

	for i := 0; i < entries; i++ {
		if !proto.Equal(deposits[i], determDeposits[i]) {
			t.Errorf("Expected deposit %d to match", i)
		}
		if !bytes.Equal(depositDataRoots[i][:], determDepositDataRoots[i][:]) {
			t.Errorf("Expected deposit root %d to match", i)
		}
	}
}

func TestDepositsWithBalance_MatchesDeterministic_Cached(t *testing.T) {
	entries := 32
	resetCache()
	// Cache half of the deposit cache.
	_, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, _, err = DeterministicDepositTrie(entries)
	require.NoError(t, err)

	// Generate balanced deposits with half cache.
	entries = 64
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	// Get 64 standard deposits.
	determDeposits, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, determDepositDataRoots, err := DeterministicDepositTrie(entries)
	require.NoError(t, err)

	for i := 0; i < entries; i++ {
		if !proto.Equal(deposits[i], determDeposits[i]) {
			t.Errorf("Expected deposit %d to match", i)
		}
		if !bytes.Equal(depositDataRoots[i][:], determDepositDataRoots[i][:]) {
			t.Errorf("Expected deposit root %d to match", i)
		}
	}
}

func TestSetupInitialDeposits_1024Entries_PartialDeposits(t *testing.T) {
	entries := 1
	resetCache()
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance / 2
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	expectedPublicKeyAt0 := []byte("b755417ac7b0a00d7a04ccc9ba74c5bf46213704ae6c366176b5c92dd6c209331a23b29e4c22f8db4b4c8f90c69a6e6a14c0ecae5abde6f6e6f03a41154ef97d49f55ab23e1e421f7dba88182c8ee507cfa225ddf6fbb7e5d5331dbf21995313bf40d127ca8889ce06fd10b848f83bf6b0b7412ece6255b895833c17309c39af542eb6a12c61aa788dd1dd054c8c6630e80e34c211f107c7c440342f3a434698d6abbc68bb80e98694f720e996872bd049ab12d263ac63fb63ac100c5122e1b69ae2bec37850c38f9db50928facb0a7bb39a4205eb1c7f2fdabbeb32edb17eaa9fcd68f43eb56c66e829ce95bbd86545e22f138df8b48816543622bfdb0fb36079ac56cbbfeffe6b33781c410f51dbb2188d47c924e0d4c2c8b55cf37e749d28096df5cf12256b0d62324140c4bedf3fdf75360c6a00e441a77e57e5f26e9a5786adb75b10d5d8265038eca3fe6f52568ca4099deac108604f932f793eb6e8962ec4372a49e288c488f94096b2fbc32365be7c24588dbcf83a963973a3f1ebf151fe3a36dad00bff7e72af525bfac2422a0431988289f10530c8d069c7dccdb4ac5b68981f7909f15e5faab4546d53855ef12de6cdabc1006ded7779dd91f0615621b9f7b2a5945dd044504e7fdec80c62c68b16179ff628f9f6c59398d9dfa35fcc2a40022f9ed19cb726c3052076502ac5b34ae945065191a0161526e750942f4a4a7b05695fe7f3cc7f4c22a7254063f78d80f5da1d9b737a642a59ad16d955e118a1b1e68e7fc83d198780cb37a84da1095a96c1bef28e3cb8561c4eaa05647a523df7b1d39695cd5a47e51e4e75d865dadefb2933404f684422400de0158c1a8f2dabc8b87ced747de591a68bd0f9aadbf90911cdb6b08f77450454d005129c10a9be844be3ad848b0a674356c0d31b9f19acf45a9781e85bf1a6a2b88999313bfaf816637b239d4fced92293082f649dc3c48ff0443505e63dd948f53dc867fbb523faaa9b6f95e6193b18b0bf3150b35564acc654ddcc6c8122fb134c4acb45a6f583ec5f8374b5b118153271aef87b4986d76f2e6996523cfab3dea3f794fe62c1ff5736fdf9d13295c8d3b29fddc06200aae6383aa3b3e9581eb48131d27b834c0e903e9d1e553afb56199ea789fd475da516b428d655ac86662dbb26a85da97af5dbf166a31cdb6d6dc0cec8137d75ba3e892a3217beeb4e3de845f2e762ddfd7ad1c1cc846dfbf0b75590268347a6a5566599352661e25149058957b0363e82e0e6b707d72d2ecb4f7742333586aaeed28a52f905a111abcce4fdb3950b6ee09e59ef42d5e156315ef6c3a0b3de5d0643b5c5b020eeed54d2a8e619fd15e35ae182cda8415292e40e52af5a6434187af39ee73a5ddf70d3db69de5c54cc24d1e42071f39ef150803d37550a34a4de0bcbfb02e668f7323ac7293e0d743a383d9d6120df38db45b38542e0eb3fb2d73339d523cc2f2e35f6fa2de260de4c8191a242a67cc08f6ee7ed4546c8c2c8883516f1c21e5432a56850f7c1ab67fda639424d5d5ab5ae5fa6b54879ea669f9933874077936d9a6023ef21a270adfe2ccef04ee076773e0aaa09af869dde0b2db2e7a2ee9172b5b39510e6bc24e8b4efd3c80162af808bf8fbe42ef4d2a222f825f64ea313db470905f93cd3bd944773354645845880eadab41c47f2a40abc3d1e1b1095e601a11ef1a2e00edc52b500c9cec70fea2d863bc7182f276bf0ca8b9c3bbd4e8cbff8eefc62b8bef1702681967d11c3178faa42baec7752f3bc9837b9e7b2afca131ed01c8cb54465c79261d4a7ec9407c1779457f1e5af2a76d98f0e589f70fcedc1b6a612000a4224d5dc3abe7197485c5b81e6cda403b0a8e974e1ea3c0f327f55a87a7ff063b0391ecdcd57ecef81d3f66063223fcad66fdf79c9f4bb823cf52aa9f7f141bf76ba05e6a8d2e5cec872a59285a7e90dbaa2c931a26979c60f6060e2f5b458f44d16c637a7d4508ca233008232ed6aa9c0557f2ac51fe706abd45e04f5b812b19f427870343c323bb1e7a98ea7fac273444b73777956b84dbb0de64d623211598a7d1ff169c4445469a4b0e50677ed828f60ea4f028b2aed7bf5e56a6ae7607ed6c9b291a3c3d76f1ea5a0419f59cb91c89f07d9706ec46c42fabd47b280c7685355f74b58ac10599e927ff63d5015f2a8e5471e3b5afbd208fa761f8106f9293e821d483b1da1b298a386ad82459db140ea87e1a3a23a6426bd814385a28c4c3a842a44e2024e486b0b4644658d73236ceed421de204656a11182f21e94d66ea9c290249fc9e374cedd4e67b0969acfc1f4ecbdd401ec936353309134becd14db6784a51283bda7980292cde6c8cd35ba0b3a1109905ab8b8a2f90e93c6cf47dd16737894d04426c9e3b85191debeb9302511faedb31a21ab3b22a90aec1e22985757e6ffccbe751f9c6256d69bad6d6e1cfe989202e87cf2d54f1b4e4163902d6e0df22f3accac0e28cccb4c0ed17652bdce8c5aaa3160ed20ef1bd455119e00e1c3832e6c838a6b7635723c4e078b8d2df66f9c3ab7999cbb6dea42f35ab3ea13b6d0a0a673615337da54f2ab1bbfbf3b0912fcc1b73798a883281a8a831938c02e226533b38d426204ca082e9a39ed8736d620465954ffd5a5645aff6684702a08569534713ce8b9be795a979a947f67225a2dda27d20e4f906e39738a413233ac8b5c7da0cf59caa54ac89b7002a0b73997ce1879949f3f5d37a82f49047e6c6487351eaa5e7a8145120fa77c2383278ae7f7b2b169b64c8a4ac6e6e6ae8c78b5e755d42e24621ee59479c0603736647480f944c90545038ba8fb048dfd475c739fec820c792010b4e9203d1c18b908e9feb448caa815bdd8e8363ba793544ce67ec4ecdac3b0cea2acc4d51aa5fc2f38168f4c9c83386e9c5fc2e96fcab0a9827f6daf8eb1fcb8c391a7cbbbea098b6946ea5111f63f1a31455d49a45bdb48f999a3153ee37b12917e564778f7c574b3925f12a03190b21b8bb062cd7663c377a396cb99cef834eea667d19ed20d22f11e8564c3cd670fd3b020e764118cc22cabf2f967776b0406cc67f7510e10b35d7779031822b6feab45735b7121d628160783c40f3e3cc2cccebc623d77e8f4d3c9de88fe0660a137aa5f5811c873ad57115200468aaac22a768f8e227c95faa7324b1d1a81b03c81a76bf6517a9645f5f53a8f5865ea278d95d675b25c1def5d818fbdb2a7d497bc3a0645d4e362ede1b4fbe472e6f4968d92d30ed475e55205fedbdcf2ed46bc7386d05812a7cea540aa6544525ae423bfeccad82a6d1269c9c19b8c58ce6a1565d0dc54853d32962912f3c7508276e7189686ff49436dfd80c36d9a4d8b41e0845082ac538db51b5b11e2fe23756c2360f1dc4fcdbd7d2ea2e714795baad4c7aba58ac00566b52c36951be76efbf083628a20fdd828a15e0781faadf32262f09f017975dc36b9639bb705fb9e0321a05efeed7186e96d3004b7238efc015503aa15d81db812a9876870564d2a81632d30d4e09ad3b04b8cef2801c3a095dcbfe6b321f187a55a57eb42ae495d89a9fdecb91e3795c24f57f4b45d050847462505ba32e0de293f228d7452ef8cdd0495b4906047473a38a900d471930b29c1649829b030c025")
	expectedPublicKeyAt0B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt0)))
	_, err = hex.Decode(expectedPublicKeyAt0B, expectedPublicKeyAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt0 := []byte("004734bcf98f6f83c15ccd7d6bcb5a17667dc307adaccea712932231aa7079b3")
	expectedWithdrawalCredentialsAt0B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt0)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt0B, expectedWithdrawalCredentialsAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	dRootAt0 := []byte("cd1f7f070b7fd85204110bf43187fa40676cb3671f03ee934b14ac495423b034")
	dRootAt0B := make([]byte, hex.DecodedLen(len(dRootAt0)))
	_, err = hex.Decode(dRootAt0B, dRootAt0)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %#x but received %#x", dRootAt0B, depositDataRoots[0])
	}

	sigAt0 := []byte("8fc5c7096439a381aa0adf1bdf69948529054fb4238ee8a9ee8a3277c20d37a4d981195a5468e3bbfdc0d4883868115534d046565b4a732db2f6d2cc286df56765f33bfd261a55090219fe39613afef0fd5b63c4997fc464e187d3f38ecf4167a9c5f4f1770a459c91db1e4315df4c3207d6ddeb81ff36db460140afa014090b1c2c80503f04355f9fa6808078d8f039ba27c196d52abb955d6072ef5990c75068481b1f542fea6045da7dcfb9e327e8a49c13b6576f36aa7c7f75c89466bd54296b2ce2e8c6a9caf39415fd49b0a12fda8833d1e6ac673a8471897f310d789954c023dff489e1ae9ddbfde1a3d7aa0cd7f52deb6571cc5fc36e0a55e3fe53a203f22abb2b90693c6c2bc1e947e2644276dfa375d8fcb075681565777f3ab14042d1f98e1daf5eb4e1e8b0db89346191c6c48264bad999661005ff3dde7568f75a0a1b0c9b38f42cb348151a5aec096be1ab0ea0870332cd7b8469b34fbd13b0df1f93de1a246ca6b06cdbdfadb6eb48c8991b6719e6250e90b41c6cfb2c43c18a414b553dc10c5f653eea8402562928d2d2430b77980d18696442fa007bbdf13837e76067019990d2871f737c59e244d4fe72d53f1740ec04456a2b97b5055f319c4b16e36e0feb6daee3f32f28a4032e12ebc592bd69f788c5304fe3522c0855c29a17dcf1c99b5b70560941599b725842eb242c879448a963eae29c39f11b751c02cd0250f465baa0c3b7ce9ca5f9111fba1b6446720b12ad764fed7154361e56b1e1cafcaa295f87610c8fdbf57dcd20b450e51a8d76fe95405529f170f86ed5ab11427405958e864af889bbb1320cd35f82d72de0e2d4fdfad98450caf0de9a510bb2c4ef9befacf298d4071200781dbffd106debabe26e337c1e5e6e12b8c94d04054cc7fb878fbd2b80c9eb24fc8e4505c7c25890b2f94c0cc94f04f283432d40ad05993585bc8faf4d76469d2f3ed0d83d06a900e7c3dda48415c46f17c76fe85c58d65928eec67747b6008b1d0c7aa72aee920781737ee68298252569cd1f84b176caf939312ddf4cfde9ddec18ddf8dfcc062afa4458e3eefcd323116509f03ab5b285fe2f30bc1f4c9795ba62fc7f91c3f859ce3f3f48b2d2163a5a21fe056771f24e307cc9f8fe5fe46280c8bb18edded1ae11273665ea822ab4c559e1ce916273e20e648f9ff0415c0619cdc99ac5dd900278484c05f536be01025032206093b31e9ce3a88306584571f0a8bb466df1401055debd5eef749007a9bb153c41005660c721299ed952cb9488d14a591d74534c7f48e8973a2a383b9f31ee6bcb8dfe4850d94b8fa60fea21cd71a7e87e68d7ad2fbe7f8d9025874c8d7b556f5154989eb849f2155a6824d6b509934386e9933325ff039dc1cd83d7e0b5a3d6eb721ac315aec6598f38831daac540921247eba0fe0d3b34dd84a0a6c42cd1a67a3cb52233da2f9d7d18fd7a927219a992e3e04afd34807d3ad3e91a2491725beda4433ac037780a732d9bc6a8ebd95d7287441d3f4c5cc63570a708c3b5e03fdd930e5e1c1ff9399549cb6496d727d2c61c20dee7d17d531d168b7d4a07a749821e8da9530a27c2f38a1ed7018baf82586d388706c83a1c446fbef5ccc0fa2734dbbb80f569fec01bd269f1942d3a68b6984bdec99bfd0352d53671bfb61204c4b384589448d44617d169fb32f7940c3b311329e18f14c516c1c90db35e47d2204806a53aeae1c39a97b2dffd634417abf7143c45cf1607b0825b85b5ffc5bc68af407d67b6c6f819a9b9198a954301e7be3f4c62fdabc89a2d42099bcbf471cdce3fa507b3489f3e4d0f46c1a9756910b3d29a0238189dbde1b1055571a37d321d238c2261bba5e7cd13a620e0d27e81cb42f9840e377b55043ffe8f762e7d66654177659bf96f97f15a4e783254b14ed16aa2785e6eaf7700176ce4fd7b1e2930079437f6942ef0ccf2825647f00483de31835e3c4decff34d3bd7d8664cd4dfd00ce0944e6fec7859fb8294486f20ce244cba371cb79fb4b87a0c25f77d558e58485195d063a1adefd5f2c5942eb0495d04ba34f97648ae7848ca7070be46c40e518dc412c200e6042ebfcd28eb2f68a62445ff91ce54c7b8af4185eca3abc7ca9d5e2f4ec9ead8622983e4ecd2635b7f6b274670b794255e20404922828b56a9c622a1c6f25a95b51f4bfc67c28d1c995b007a3c0184130f9d5a507db7b641fa1b6b562400cfb2cdd115ac5228f8a0548b72028f33425eb900cd7d8ab5efc644bfd580b1afab55f5a9cb5ce2075daab0af161d697d41bdee536c4038a5d825f74a7e1ec8a830606dba83b7df6562a02cb195eefb34b3bfe20daeb408cd761a578226566a3f509eb063edbd186d982f7279a62214467ddea04c626784ef08be111d16986d085aec6fd8dc389f56e76fad91653396d3d089fc2a53640692f5be7797e73b10db169e9b162c8ec0c9aea4388ad7747044b298fecf3019a510758006c400e4e224be9402620d6c2a80032447a2548a6da37e358880d7bf1db938bd2b94937036c2b4c117e1bc90a41ac228fca3d9e93bb7990c44941fd569048a41507e55abb3b2e0468e9831e9341e41f1840c9de15bd42b3a1ef8bfab5f092310b49bac6400d591a79e404c501fac0ca8ab0521ae8ceebbfedd9a23a35c5d9d24fc22fffe2830047cc1fafca545cbafc738d1369a6c557a9aea3a7e8451f2e81dbe3d9a141d0b0a56fcff6785b45d827eeecaab28aab17f54e3490a74f1d8e2b57cecfecb2ca20d6acdc6a28a215bada77d95a7883530828861babb964ddf28333cb1ad770c348ba5cd92ac443f9b4715b78fc980260a4c83ccafcc5270e94940010f502e1e82c2f08ae23f4fe42d7d0edc484bc2ecda4b1d2985ff95e380a570b7171287af68244ca73fbaf9dd776561d6db4e1c2b711cc88c307f298bfdc75aec496000004f37baafb0f3ffe187b12b3f10a42207ebdf64e4ecc44366c6a9c44f25698ec60761b15df4412ca4cba268095f32430bbf36dc6bdcab183af9f202729bca415aee213678566867b0b8cd624d21bb534e510694a8905687082fcb5111660fccd9996b8388fcdbc5471967dbe919985a22a883df183aebcf5dd8b760fc86d7e7e059601968cbf5541e355b5b968840aa369766bfab314e7987f8b19ab86d35128032787218fd07c49e492d602a7685212fc976e2e96f6b38ddbfaa8cc09f32cf168d593c29f76cd1000b836b00b13574c6232f405582671721a7b54be4f6f12d1193d47df8c3bb8f7a0dd05eb7a544455c13ead778383da659df7cc91a8b8399811c4ec16c5e02d2d8d3744fc9fa318e5dc6ab28e0b0dbb366abd2656c60974cc8d02683502b92d1855a3331055a714802a0fcaefc2509dbf9677f5369154574fa54e80de129e07ff81b69af29b29e17cea812014af986e0bdcea2e4b93249fbaa21253d097ad618e29c2395030efaf652e8d7d20c8eb65e73aa0d5b9e8f8b022fd1a12d66be908e8014a3c9e0e7a221193357fdbf715d9d136a517f44487a1fea56469faee99d6864e1bd6aa1c7ede0f70f6abbb973fa5e1b691ac0719f1bcf638830adaa98fda14bf88e9a0e983881ff5a804d1cfe014191bd8aae6e7c8ad1accaa8109cb623ee6b148a59b47f7f6c80511a5c3731e2e4d3458de116fcab55da2ff024e3d4b28cd7fa525f7828659a2b97aafe4622b9efc137ad3aabe272e9d2c56697ab500e35c914754a287b964fc23c5a7e7e521d6c1139fcd6287f374bbaa3918ec6fe8041fe4252ec81ecc7421d24e6b3e214a39e056abf8e7573c15fa311ece36370d65163c0e53d5064f44ed584c0a1eb4479b8dc2711266a2286815a8bce3fc5dc8de54f6c209548624803f159011c40fa9747269ac7e93fff2708cb073b5cb36db68789266a583b4e20d899cb0df1850079b716b470f51190e75b74e3d7257a72e706441234a126a6261d1097d432fbb7fd2753646339bd0e21c3bdc4606c7a95fd7caeb0f1f14c2f07aea3610746df53201c23bcdd59edb3aa6fa4bb728a81520464c0c9ce580a96614536c54d11c7f5b87c15995ae503cba9aacc9af8101b350ff9a446ee6535ae44106c4b3c073d79e7d871f6df2e17d1fcabafda3e0a0545f095dea3a5d3827d795264c10041c613931d147ae94e2c3e463fc0cdbf59ba586f4e4be1a9414c1553bf1fb858018b1dc2bcff7f1134ec8481a4dd6814026170edc1db4f37bfda8b23ec86d07da20d48738f74f5fc02fcc0204f90dfadb3ead703276e441bd32679298acbad736b0b0baa92007107cc4eff84aaf88ef99724d55b964044957250ff936ead40041b397c35cbbbe7348ce2734deffeced7152028adefdbab00e228187ae4b3e5a16abf629204033a4b78ee6f993970372bb7b05ae28948f4f2aa4bb3672622ac4556f0979ab37c0f82a8a5dc44fe00042f710779e06135eea505a2a358bf535f6a0afbd89b90f3dd1b714a1f42e863f023b1f973e1107b3f834b7b1fe77f8652694d268bdd55d3602f71ba90e2ff188c1f647179edaf7d0778a40d83ba99b241a4055da29f74ad0f0cee60cd9433f3051cc06867ef5bb9f0b54fbd919273a20bf3b81402a1bd623dd4f2b17b0ae415616afb06200fc13241e478cc9999178c21c81bf6d93af5c43a55af032372d47e85b8888efdf239d59dde906e60bb5677dc24d7df197bc0c83cad1e769dcf6c1c9e7de6fa27f59c882d4bec1f0ad0d44935f0254381f0361a0d572cac1d2f03bd27ffd8d9bff32b2d1c5b28da36db22f0891b509b8aea8ea6ea26fbd54cd92cae8610f1cb63f946886c2e7b7ee224d5e978ce5f4b111a2e77fab1c93fdf1633c282048247f3275a895ec1741a00393664e39535165bda54c0c636457f69d2d6286b0ce17e3cccb94ebf3b91dd83c06a407b65fb3f49f87dcda29cdce8f5fa4a4ee954d3ec2616c5b1d5f7296747361af12f595025ee5192ca3b7ac84007deb18b7e0ac97c546565a7d2b694e328f4b7cb1e3f12781646085bc8a49d9beb1f1a195fddcb2931182f81b3b1eaa0f5d500dd50a7f0286675973d428bbe2c26bd61e295f6623c017cf4a422af6ae044b3fc58c103810901e03f80c86aecfb115da6253f06dede4860b0f9987498a61f8f197d2b518fb6840b62f5f1b19d707cabad62fa1b91737272695407d6be6ed9d3f0bbf24f4b2880724a33803f6111e8ab8569c6d279dc76bac76bca9d87045bca1976b43dd820b62d48455c878bea444329830f7cc32d8fd46a082bb8966c29ca38bfe6b0fabcb3b67289bf29985a330c9f5d7a89cf011b8a71fd8ba74b7f1480f2d2a623b455a57190031cb5e3d9d4564b0822956b041336b9b357fb2c876de45cb0a782670609a90bd955afb59b9917a63b2d92599b0e05ff9e1e08f2d0595dc2374f5c8ed4d93be7f3578b3ac1e7a18caf7c57c00486118095fe36060502045da0218fcec74fee9e53da42c80c8dc6aaf960a9de6c6739ebc5e583149a923ef03ea018a0a4e83b8b8c01b0ac9992fb3c88b198de3dd0e18e35a6577aea900df0c37cc003ee51838770039371574919430186befd688bcc2c401a0801b5b28db681f0116127c6296f18137f0643efaa7c07234a9dae890177dc0ec7a79e78dd3db4ea5770c0d556a098a3b5bb07ef782e17c4e1a8de70745af2cc0af5f0c0bc29a04938de14db88d52b3ff6e762473d3ed189b7d1516452993639fab1633f4df70dd568dd142b542f78f285c37bca99438d742eae55440c98c36454554033cdf78cb3025192da3fc17b6126d4015e87d535e1db58060ed05d570e151292d23c4b6ce071f0e09c9c5967f1e30ff79cd5e710e55e55926f6b798660b39de13058036cff6c1c6f39bdf38b3851b49f9ce0090e723ac0b5ed45aa40fe9f44d1566a8487edf9a3d5d53e429cef888c5e1c5aa20d42772d58e2396becc3b5937d1413027658f4c7eab48ba16980c3e58e902ee5955fdb7b31c84b73a89e0de74a21f4b2abae00b76ea6656f4b521573afdedf4194e6dfe5a8e57069fdb795483a8b008cc41d285062a45bad8cbaa038548117ba35ffc8535601a1a1607774a6736cb69136e78dc6d82ab614f272d6814f79076fc6ce3ffdb23d8fb766c65e44f937349099d5e6dd3f5a11e08556e4b277f649a53e14f6702f2dabd06b7d6c6ae0a04c1bdd6ba01845cc8d45d81e5e9f5ab112b341ce587003f455efb2dca368a6ca1e7b65ed5244838a8f4f448923da07c49856645c578060f19d810dc258d42e72c987183edfe1f646fdb662593659b1ec34325bc1da0bc8658e331637ef30bd74d6a258e5d0b72418290bad716a9c2fc4616a721a62a52e5d0a41cd0c90334a2e575291ac6245117fb19748390a5536074a6adb9df1964ea19213132374c68718586bfd3f727507accd2e3ec04353a64addb4385a2121632363d53608aa4adc90000000000000000000000000000000000000000050c0f1c23292c37")
	sigAt0B := make([]byte, hex.DecodedLen(len(sigAt0)))
	_, err = hex.Decode(sigAt0B, sigAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %#x but received %#x", sigAt0B, deposits[0].Data.Signature)
	}

	entries = 1024
	resetCache()
	balances = make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance / 2
	}
	deposits, depositTrie, err = DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err = DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)
	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	// Ensure 0  has not changed
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}
	expectedPublicKeyAt1023 := []byte("5de694585e91d95c86a104a9f66cd685c48b60fe9c79403b4979c1707238980bdf27893e8be214313fd4655ff540e206b820ab741d859d3f6182e07936aef4615b78d5d03d89be306203c3314bb2bff2845b809457653b7c9fe268a0df86bbf84ee155a2917236a445ad1b494885e1f206d845e952870524083947aaedfe7ffc21e67d2e883bb52b3f87f658c209ea70a3b78caab780491ab874d1312af2e93dd66e0006cfc930d7f4d8e3e558edf2befb9a684429b19c3b6e936372ea3ad4ca182bec8dd09f208d42b4ae336590ae4969f9aa469f89e28481796011cb97950185f8212b0c2bd9678fc5c99e7b73aabcc4632a544f12b2513101fe1288409ab4dccebe3554dd9e767ecfe8f6972075f49d78215c9bf328caa4dc80d9684906262a7b6f9cc2e542830924368dd041ec227ce353b0ae7ee20aea5df37d1a3af62e0466fcc5f94fbf9ed7acbdee421aa9e1d1f779013c8ddcf9cbae4ff46140fd94190e86ad8ac4472a646713138f851d562ecf3352e2ea818109e17651a600ee2861cee0465b0844ba126b6e7c96cbb7b09c233aaf4493df573482ca2a2e825e1683f6e31c15245db48b268c65a51fa2ef13335cda2898035439a49f1c4731ec87aae43768a6772503b239633c542665d2b1940565969b34b1f311fbb57074a4bef770244ad46f23c644babc198c34f4d3ddfd5f50ca7a567faca715b187c31f4970a871db296dc5ade768a5ad9db45104aeaa28cd278733acb06e637ac7f5fd07a381a29594e2c68f119ada586e7e1378a3f489b0cc45443a993b40202d284c993714fb4e88864b5e27153b6b93d3601d72cf161036d1c63a753ed67e20d5355222aebce82cef8fc70ab3b1044a45f68ee5c67a26920d9cda7efb1156a31192ae0b7864aecae8e2de037f9cde4fe83374422cfec1e37126d9afee8bdd3339ecc262df7825c5f66d6062865d92666194c2d26ed65d46e1cd200290b0e3bf1bce545d7af8d132304f2d985ce265ad70b8a5e5957c4fba4ee203ab5113c02485f3a78267ca611698b597fda64bb2cc7699d619ff8b4b688d23afefb8283768663aa91b73d870c01692fcd73e223960696b186facfaf353429ea4c03d8de631b46b36fa9f5748f80361aab75eef011a203784e2d73cbe6bdf53c2fa4f7ca9e76326bc2081ccfa6e3675bac97701fb79ec8c98de7002a845275fe40418d910530f714115cdfd540ef36073fc58b106d0761944e95c1400fa66abfe12d292ea1f323e770c0a0a858ab5bababe541c3466ec2f6bd65b7625f82f09ac40f780dae07be533653fc4ddbed97753af16b03c6107cfbaa6d3068e58552e7fe2b6569c33de9e60a395d4c44b6ebb7319e351cdde35475560536baec8032a7a5f5b55abac9b1b3c8d448c530fde8523b25960c21445942d84891ecfde2c39d580a5b89e78bf8d49881e9984fa7205600091d8f4c8aaf6327d03bf710c2c65d05b3a218f69b855b075a2ed6a46b806f6a38a04b5e89aed4a922b4524f182c32e3b41242034c4bfb80bf0472d2e1fd688d153d8b40a3f007b50deeebb99a1bcd568bcc6a703d0c6fff2f4072bf827c401636d7f60eddd56769b693e0ff50a3ec8be0e031f1d01f4fa1eb68f0ac9df4c7e4b1dfb56fba91b8ef8b21b706d786c8c95f447df11ee8c4f9175af2149bb968bdf7de0a6102be3d7445177e9551e20653de4d96624f521a9cb85279cd19ab46e84ec8d1abefdd2ac905aedce8d1932325402d50b4aebfdf2259a717a41f03ed76dcaf769f9a3f4550b8cd3cb96f3f7b02f64ed7fa15284afcb347eafdbdda7eea5d65f3fda3be850de0ba4896ebb02d9d30291ec75f900c1234ea07b67170132ba2d10206c849b90a8721cbba1b862488bbabde68d95ba42bc94e4c5f29ea69b770fdbbd5c45d41dfa40567d7341bbfd3397769ffb93b7c8875ecc5e238d03bd5282bc99b0a89d9315704d9e463da2766b1e635f73fd60ad9b3aeeb41cdc8c4af4016e9c581744860c5dd5d0b53422f06197773c7b1a47b67affadc0d066e51349f9c9bf3f03cb641afc4a55e8b175e8f250e15a7a6c985969d568f4f212210862e4608b73b62cc94166511621c8bb91a38a62962768e896dac201d2d6823f9526397b8d4a327a9e2cf06c0ac8ac0de9efbbef679c2c5d10283c85da324d79681c20164b60831e26f7281e28e83bb9eb09645c5b7fa76a28d80d21ee03070554539f118615c5044138528d49f83ba789c49a58c1c0515725c555256371227bd8c041a11bf46af25c8534d3e681c743070249de2649c837f7305c76fb4a6d3b0a3e76430fd34e793e662d38df96915d9c22423faa9448ae3bffb18c7e4734335d93d9abb9d0f1e40cf5249f604d2bb5c5b5277485a98cc3d8292c41094cf62e1b1322739d7482fea2a43d8003a81b3b09c9957cb3ba7caaf615deb9bad2476f8ea19c6e4440ea9dc8fdebf5f2b23f5ff34c9150fa015f3e03a50dcce811de1c007e77a18ef069b034f9119f1791b6d891e7fd715097c2898174f72f7b7c9cff784cb67fd714fc18ab38e7cf77b1635e2a0963613ba77fbbab1fea21ddb814f5a9e85cc41f33b838a8b03d27b376606a0eb691da3540aa0b981a46588ba092d7fced9dc877ddeac0e3da6335cad25270c5b59b13274bef288b8a02b02bd07d6924666d1037d7787aae2b1b8bb694136af4b4a3ddedb1bae1f75d1351dbf531770f13c93c5e852d9ff3891c7e13a8015986d220451a58b4d835a03a56632545350419d6aa97d2b91668f95dc92b0144877c9661e1974afe92c8460b1486b04ab32a4501f1287fb9cd431129864b1604fcfa692033923919af9e4fd1faf110739ef2d263c4e1adad18acf8eae4686e24c2b0e793619f50a7cf075ba3677306c5076a23f070708691fd592dab4f3aec2030d4456b11a9719fba80bcd21b9ce5b2a5e39272aa4fd1da29953ab316c8033bddea4405da663e41a4091021a47378fe2dc60915dc090e1f831421507722e138c66e026f4fb580ec9e7712ef76582c795f77182f58c1b17f995a2b26cb8f65e2bd5ec1235f2de64d1d4fa6177b763bf680aba151c5220ddf953f8022b0743908abb1dc5b656fc3f68bdc7a3dfbeaff3ce2b1ff1b0834c9696201722d6fd62ea4c39668e0d40e681fdee965a4f4e7d1b56ee60c677d8608048b68c0984337a7cc62580b95e085d1550156656cb5208daeee7d0e473a9f9fbf7fb9b7fd9ff90a4d8d11e324992909a21d8e840b6f6e262f9b1467fd4ca96636c65ab66f5da281722361b54c810eac681fc43a84cac6ee1859b302cd52ed18818ce5f500f932fff60df1d502955757601f2a6be0bf3563f25b078d44b0fb55baafe2bb3ef90c7e42b3d8011f4b813009cd44a3b7e24d25eb45fb488a7e9a34dc0975bb6871dec843403507cdc90d05d7b2a6df4b54fad28626785064820d3aaac34bb52b8610c187d3c366f9bfebdbb92d7d0c206efd7e11c507444d299eed7e9eaedde074c957c4bf488309dbe9668be43b3e73df635e253c909fb06f0f0d1817ed3c3a3a8a5263af846e4a6324973eda916007dc94f0d8639e57fe9eae342eb209ae4099a0332fb97c6f811495549586370c93fdab5e6a92cb62e2d2e599584f923668ae84df0676bb08e12f13a2af1283")
	expectedPublicKeyAt1023B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt1023)))
	_, err = hex.Decode(expectedPublicKeyAt1023B, expectedPublicKeyAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.PublicKey, expectedPublicKeyAt1023B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt1023B, deposits[1023].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt1023 := []byte("009560ec38ca371e316dafbd545bce01bc809cede91bb7d9310fb64db8dba123")
	expectedWithdrawalCredentialsAt1023B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt1023)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt1023B, expectedWithdrawalCredentialsAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt1023B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt1023B, deposits[1023].Data.WithdrawalCredentials)
	}
	dRootAt1023 := []byte("8970c47328b4352184eac9add6ce0c7e3919d6c53999edcaa1fe021b251ca0a9")
	dRootAt1023B := make([]byte, hex.DecodedLen(len(dRootAt1023)))
	_, err = hex.Decode(dRootAt1023B, dRootAt1023)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[1023][:], dRootAt1023B) {
		t.Fatalf("incorrect deposit data root, wanted %#x but received %#x", dRootAt1023B, depositDataRoots[1023])
	}
	sigAt1023 := []byte("638dd90b48a3a32bcb57f2b6e3a490221a4eb936a752f24c1517c407759abb3443bccc8a370f4583363e40465589a7840ac617dd3c4057ef740dcbfe3f3c5d6b717a79817211916c50924296bc6cf8dbc695ee9c00a73fe210c10cc59280dcc875e4efb75ff3d36226ff34701845a7d07df692f2901d902a97db402b70299aad54ba79eccccd81c6a113327ef4689a18494f0c342f4660bf8993596e0e226b3d016058494db1b899412b65edbee1ab635896deaa968a4cea1453f7d37328005bde4189841b93395e5f12e02a306f7344fd5602ff3d1c3440b26c710eb1e3e67f6373786c16684809d5b7ff9d6b2825c72de647bdd9efacaf163c8dc0b59c1f67c2767dd8351ce1a52392e86f856e19ecb63a33a1c79be4d6be572ecd306720cf87716a5a12b0aa00d3a8ca173d8ef44338e84c94c05cb46999166547adc5b957e94e5feedd035f3bc0b14c2b334e761cde6c8541ea7fa59357ee1aaf0a3c236daa1d51d0c46bf96e3874d618d5f024da81d2362b4aeb6d5fde5e8ff31ced937d93596b061c06c6eedd5c7599041885558508cc803256de5b4067a71c7b6051462e8fdf6558545fe96b101bb9012fa408d689df00e7cfadb764dc5b1111b70a6fd4329a713c6e0a116f368659494072adbde9763eb495ff9feab472c6a27255bb92b793ca99086fd9d8c304f5c0d1fb54cc6b28947427e102bc39a30a35e134e3fece3af2db62bcc58b2c1a3e2b6c7efb3a3c34939e2da80b70c43087612495ab8f9ee119aa98632dde6966e5e5cec24911eedfdb83675fb86e4ace9b1f33096e1f9dfc29587e7119a083be671f77c48c63d2a976817997ff9ef3f68434ac65b0eed6a5f9dd54bdf081c17b57caf959a533c908cc284baacc69dcb4f5c2d2af66f4b0288b880c9bcd668f96d1a2c4f043e7e4d8ede76176eb72815fbdc7d8fb0941f5448605ecee6059454ad9c06033fe9673409abeb083f48a0cd315935c0e986f1e011861a87eb03af67af501ebc22e53133c7300ddc7efc78a2a2e51724c3d7e43e60fd181f0a7e6b440fbdce5764c1b297ee61155a6071fa06cf6f261299dd419f6c796f68461cd036513192c0fbd51cc2e0f621dbd29c2ed8ac73693fbe6e3e3f1d399cf2ff60016c54bec8d409008b5cb52a0846abc327d873d4c8b6d8c65e8558e4bab8062ae63b08b6495538d848bcb2d1622efe65e1b97c4585c5a3c6cbf5e0b321290aa232aadf87a0ba40d98eaae2fac06d83206adb01ef40f18a21576ec3fa0be704a79aad10dd1cf76ef497efc360c92033b0ea5a313c03207749f0b718b2fd15c0e3bc635df13880ed45a0d8effb261d203e174ec987256de147d8471b139bca2cff3d36124e80cf4cd92f32a753d85ca9439e1f2f99e4fbe064255bc14292e2969095d92c9c7830101fcd5ff2d94ac389922c495e6063ca12daf674446bceb0c0488abf4676064fe442ad409ebdd524ef456e018e0cde1407e3b1188774fb27fd987351155d550c5b89dd74aa71e211301537689b007f3475ea888b30d30813c1fdfc1eb38a0ca17993350b20a0cab3168dceaf8acf7b56ebeeb1b16ac8069aa96535d9c2bda104c0b2ae5c008ddc07ee9737e19602bb2057e10eb3c4c39eec02419ef7bfcdfb822a5983ec2c19af592f28a8d3f052eb8835f3bf4fb83503f5f666256ad78d9f60359e6202b59ed14a8ed708bf36c12c17fd728c3cfc0d839b64b49bfbe696fb74ae874a1143aa1fb399372b4e83598ad6c793ac9a303504bcd54edc6d3160271f305f68b1e1ce57c529d7f57dd4db90fdad005b2440af7be354a916d5fc1e0e4260fe39d6cead8d2446265734e1b048e6c5aa973373957571de5a528f2a613e40d291f349bdad97d6198ecf53898f639ef40235cbe35bc6db68cb1179f99a27d6ea75ba556867bc5d51f5fc5b45dd16ff5dc7fbe59a18bfcffd478547f5ac0652a97f46d641facd8b53aadb8024d6a1bae74928c5c3ac29ad3bf9807d268342b45b7f20f9b7941f2bc5998ba944206f58238d9b35c0c6a589dd22cb13f4dfb10b3dad21fc7cf583b128becdcc94286b0d0474d084bad4f1f4e4aa8b53079d99e3ccb1ae11d88d53e33c9f1ffab969f16289268dfdf5feccd4e84e38d548c1e109f1bb2fba8b440e54a2f0850e8041d9614fa40bb3b71ef1d15544c2e786d5b522aa0606c9bfc5b7f185b2748e85be22316188bcd6ebf084b05ce2f562ae90eb2a53f87e9482fbbe58b29adc6fb07f879c8126f41230ad0d8319dcbc460854320302ca595ea545759814e95b33b186aecd0351deeed8668a818c6c5dd8c7c92feaea5990557799b313c76e86a9ee7beec21dc85a7f7bcc63a0a8aacf7f7eb7f1c2875101f3d5131853e6dda9a26a2e5d1da12c6f22aa4b7bcbe46c8fe4e605eb84bf1cb23b6b88a53202efc9f6142fe65ec9ac7cbd4ce88e4ba4ae2d4d105f45762b5e49e4ab0fbcc29b2e6b565115ca64d2d1887a034c927db1be1ded32d8e51fe3f92f8d7f041efdc55b3d1b98bcde9cd42b607d5e4134f79ed9fae1cee23d54657cddf18a6064d86ea469addccaa523ef36f181078e9f188b4d6351919b35358c731aea60194bc7b53f8518bc173a549c249f867581e37dddb960faa061d3df9778f5e0795e875aca7d69a47ceb3ee19434f6c9075703b0093bf91c7647bd2bb2cf355202190e32202459b3b5e3fdf29f3dce05083d28539edd8de06af140888b424f299f1b424f43c6588c4202247ffccb3edf40073d3e903715a2d9d5e7fb5eedfbebe49919dab4fa743f0e06586dd8caf288f7fc8409e89ba0b1f3c88ccf10b9573253ba1ef06afc28ec35c4c9ced2d36758ef1154ad5fab4e78175500fbcf122c06c4e24f83bc404b617c143bc614957cacf5475e1ff45b17495c157a8fe60a82904722eb90ce992846fff43862ed14cf75d0d7addac750923ffc2b6d74c7fa5296f9130dd628f99b90debf98c9ef750ea3688d84fc90f274537f15f46ebf12ee6381a768dd5f2fc92f417af57242f75fbbe91587fd7b295af59a928b0f8633d3961df3ef5d18e78fe60ed60216e7b943d7afbcc9eea3cbcf9143c6eb1c10a4723749006ed2eaf835144eab70379796807b736e7dcac4efb33a67f10f3388eb7bd8e93c98322991a5db65a705133b78d38a38b23ae92419851c3187b9ebda95bfd64b6b95b3bca346a26c791f76d8a70d2c9dd6a9f529ab18f0946e185951daf29f4eeb8c760644e8d1401b959f1a5061e79372a645e7c31dce11238a677e850f169d7a4dd11ab597dd31d1ddb1f55347ef994a78e6a5dee1277527ca6b9e310a4f354eecbf44b8cca6047fba7ebe19af6eec0139519cdee5f4e6c834877400121932721fa6777bd9c65f2e241d271cb71f63b521fc8271cdcf8b097f116d1cd3eb0f932276a689bc49cdcba1cee36bbe51f967e7fb70042dd668e3006b896cd842a016af989dc25411a3fa948c44e08867dea51a848c08c17003b98a7fd153d8f9d068fc7eef38f4534b7599b60c79c66c60323788b9a0d71242d4656108ee850f1c579e9e8fc0bb065cd7fa3af67a4b25b3b55621b95953f0540ad2ba02d9375b91ce8ad8163624175481207cff0b1daf6b0b6a1207700f23c699efc2170f1c31fae9396d3412a26cff4bf9e02b55f48352f0af7fe60e2fb293bb22fd5fcd38c81290e6ae803b13b74ae2b972465c6d26640b0b6d620ff4d30c58aca17275510c0a5b9100327aa588c315748a63623d12134f12323dd02cb1df436fd8a6a9751648042f5aff7bc48539da4f02e8cdf093b13b7594f0a76950f8017f0a73befdf0797f07b64d60db3cb644177619b2a76228454bbb92acd6a98c230de91109ae836c5d0811d6942a215c52c8a25403e33827152ef075dd7058ecdadbdaaa0628ab861c855d14bce5571813ab7b84ae0cb1d882a785ee8710e39e89ba990563c0235b0ae4919f005b2c5dcba998a634f33a45608050ae71db5d305b99aa33530732c3b9f18215b0de34fb026705f7966340324b2cbf64f68515b9e1c19d82670f8abbf2d6cad9d004542a9de15d5b0b8a433c9ecd8835197594aea5fa2be1646bea007f0028d7b129a9e78895db9a723969f7d0ad7956d16fb97f0871fa49da84086f5beb04e8dea577c0cfeec54b9579f273ad1dcd166d90936fdf20fd14a20e5efbf8e7097f82784ed3d9bbc9a548ff389d9dd79b602802267e81b5b534792e3c306aa46ee46a41aae90741eedef20ee0708066cc38c8e56f0ef659dacbb1865e3fbebbf2fe665e714d56dbd5740fe881fff4d2a092674e81cc173b133836ae174456d8014149c77bd37aa96d15a17309b47556ce5daf75a5b3b96418961ccb2d45c1210e413ad36b94ec5fbbcda6a2de6981d4a7531601a70ce60d086eae3b76bf053fbfb944833495c03aae3f492cc28d1a398241c3508a5e8e9cb41bb5715bdc566f9bd16fdd262c903410e9bd4dadab4a08278dae0c3b2e940306d6c48dcbdd8462c0732356e40ca810fe3d36f759bb07d2b9b5e19db5dbdb101e157d3550a7c0e93937b16cf62576adc5a3b319ffbb46063077960e39b74efc3d5b44a6d3827ac1b58d2af2c62158ce5b451315b8299659c65b230880ba5b876b2205674cef89ca395313994e179e1c90476cf17900c91853edf7d505ae25ee71289c27e6290b1946cea5caa456632b227f9e6e63215d5e8c5edc663dbd3753651251fb7aa3c5ea50301a58f11c084a8c6c654642791f8fd1c5dd933dc29c52cb1fadf0e4b017307fc3b0ec1f65ca51cc13aa1829b04b23ce04f680308c3e266bfcad795027eef020bb50aa4696f0bd3d5302be5b102e0d7950fa7f9229213ee54d382ee9b4a06dba0125b151748d530fa9cf8ae0d9b40f68c66beca4b51f70aae1296906a05ce2a90d9d2bb347c9f44f2aa7351a4a8accd753ef89d0a2b10ed030da68f85de4ffd757a44180e080c6b315ee6b4cd57588d8dd50c41d4a14479193835de9116bf20ad162e18c55df033a33f5ba149217e7bc8a7d4410f62b1f0d7281645bd048de2883ba14fb7c49d4151c2803cfb2f1c1b052f7643c8c1d78b67dab7b3c00fd1df2608ac4e1a5ff342aa6a4f57b9e05a9d281f6650aaec36ebab256c57e16c6d3896f76c70fc9f5706c6af89401731eef7048e572d50cba913c7fd3b6aa0aad4bb02682a7f64d0103d720a4bbb73eeafd661004c6484052d2ee2cfdee8094075b1e2d59fc1dd6beb3777085c90e79c057ac2491a93ccb5b2c1fb1b86352885394b40bc986a8d70c9a996e63e08c898286fb3001e951696e4a4ae5fd0dad980741b7546b544743d09e6602a922546ad16f5a8c52f07fca63857112f2ace15ce6450c159780da9eb368d32f562d6bb056850506dbeeddb94ef3655129806e948da89dfe33373ddc7283c7716b14a740dec6cc88f6d5a1d297798eae7f28123b30ca8bdbc08c85611e725570602549c3e0e7be6b8c9d7234aae96760215eb429d5611ea160ed43b3b4ab87cb100b2b1b43b89a121994a4721893041c64b927e7cb9a545da1b85330f6e9e37644ec08a3ede8fece2536b7978d2d0f9443cc98d097b02d49a2a69de05eb839f01f79714004bc8c74f4c3a5edd4947ee08c9ab00f2b8200bc30afdfe8b18dc29ca4a348c3def92a00cb1b420f4bafa803df82a40fc1df9de9888ed081d8a853cb60aa54780a544d4b16d4a798cb1373f1c0b2b9f0f5f77d1ac1242df3004d420344e11d774469feb7650b6f2467ace103367a8529325ab399914a3d087817881ac4653d87116824274893c390feb5fdfa7573b235d48bada9c5a577d88607ab65c206e41ffb32ca38715bc54cdc1afb1c8a278dfd12ebf39b726f523899e9748922a26a6714d414cfa68e0e55480982e7772ef5bbd3fd1f1144683d4b7663c537f9fa21832db17546632e4479626458cf432795d6d84b321562a2624fc407ecd503b626ddea466bd63a83354bce4de5604c655fa039c6b0e829b9f2d8445e88be5ac6a415b2d7853f872472ca3513fc25ab8c266e0fd694ccaebe48a659dc5437ee88f5f21471435567abfb1249301881866c62bc2c680fa51699fbcb245df2e8df5c01bda771f7f24ea333662bb48899d5d8aa22a38f9e18f3330c2214fd13a1f24e493a0537b2cb09461d636004582d8f9c1edf7d0680223d0edd449a9df84ba954206bb8ee0a77070d4fac4c80132f1eb51d70d93e1c4266e09360e584c12df16e1cb352e9c4e053ea68058ea82e99aac7ad33ddde14600a9b07c7dcf7c3bb36573ae4cf42355a5e4726414f1268d0710b12800b6afc290329c4fcf478659a5351ce891e800143c4204636f13e43f40f34f475ff10bccd22f0dbacc141b5f71b8d2d8e2e5e9f31c4b646899fc071134c5d9dd113e4070868e9ce6f10c372125426fbe02040b2a3848569abedce3fb5dd4dde4000000000000000000000000000000000000000000000000070d131c1e232f33")
	sigAt1023B := make([]byte, hex.DecodedLen(len(sigAt1023)))
	_, err = hex.Decode(sigAt1023B, sigAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.Signature, sigAt1023B) {
		t.Fatalf("incorrect signature, wanted %#x but received %#x", sigAt1023B, deposits[1023].Data.Signature)
	}
}

func TestDepositTrieFromDeposits(t *testing.T) {
	deposits, _, err := DeterministicDepositsAndKeys(100)
	require.NoError(t, err)
	eth1Data, err := DeterministicEth1Data(len(deposits))
	require.NoError(t, err)

	depositTrie, _, err := DepositTrieFromDeposits(deposits)
	require.NoError(t, err)

	root, err := depositTrie.HashTreeRoot()
	if err != nil {
		t.Fatal(err)
	}
	if !bytes.Equal(root[:], eth1Data.DepositRoot) {
		t.Fatal("expected deposit trie root to equal eth1data deposit root")
	}
}
